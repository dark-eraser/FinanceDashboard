diff --git a/README.md b/README.md
index 53066ee..9eca7c1 100644
--- a/README.md
+++ b/README.md
@@ -328,4 +328,4 @@ For enhanced merchant categorization:
 
 ## License
 
-MIT License (or specify your license)
+MIT License
diff --git a/faster/templates/base.html b/faster/templates/base.html
index bc61ea5..23deb06 100644
--- a/faster/templates/base.html
+++ b/faster/templates/base.html
@@ -1,114 +1,103 @@
 <!DOCTYPE html>
 <html lang="en">
-  <head>
-    <meta charset="UTF-8" />
-    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
-    <title>Finance Tracker</title>
 
-    <!-- Tailwind CSS -->
-    <script src="https://cdn.tailwindcss.com"></script>
+<head>
+  <meta charset="UTF-8" />
+  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
+  <title>Finance Tracker</title>
 
-    <!-- Bootstrap (for icons and some components) -->
-    <link
-      rel="stylesheet"
-      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
-    />
+  <!-- Tailwind CSS -->
+  <script src="https://cdn.tailwindcss.com"></script>
 
-    <!-- Chart.js -->
-    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
+  <!-- Bootstrap (for icons and some components) -->
+  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
 
-    <style>
-      /* Custom scrollbar */
-      ::-webkit-scrollbar {
-        width: 8px;
-      }
-      ::-webkit-scrollbar-track {
-        background: #f1f5f9;
-      }
-      ::-webkit-scrollbar-thumb {
-        background: #94a3b8;
-        border-radius: 4px;
-      }
-      ::-webkit-scrollbar-thumb:hover {
-        background: #64748b;
-      }
-    </style>
-  </head>
-  <body class="bg-gray-50">
-    <!-- Navigation -->
-    <nav
-      class="bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg fixed w-full z-10"
-    >
-      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
-        <div class="flex justify-between h-16">
-          <div class="flex items-center">
-            <a href="/" class="flex items-center space-x-3">
-              <i class="bi bi-wallet2 text-white text-2xl"></i>
-              <span class="text-white text-xl font-bold">Finance Tracker</span>
-            </a>
-          </div>
-          <div class="hidden md:flex items-center space-x-1">
-            <a
-              href="/"
-              class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2"
-            >
-              <i class="bi bi-house-door"></i>
-              <span>Home</span>
-            </a>
-            <a
-              href="/expenses-by-category/"
-              class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2"
-            >
-              <i class="bi bi-graph-down"></i>
-              <span>Expenses</span>
-            </a>
-            <a
-              href="/income-by-category/"
-              class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2"
-            >
-              <i class="bi bi-graph-up"></i>
-              <span>Income</span>
-            </a>
-            <a
-              href="/expenses-vs-income/"
-              class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2"
-            >
-              <i class="bi bi-bar-chart"></i>
-              <span>Analytics</span>
-            </a>
-            <a
-              href="/monthly-budget/"
-              class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2"
-            >
-              <i class="bi bi-calendar-month"></i>
-              <span>Budget</span>
-            </a>
-            <a
-              href="/settings/"
-              class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2"
-            >
-              <i class="bi bi-gear"></i>
-              <span>Settings</span>
-            </a>
-          </div>
+  <!-- Chart.js -->
+  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
+
+  <style>
+    /* Custom scrollbar */
+    ::-webkit-scrollbar {
+      width: 8px;
+    }
+
+    ::-webkit-scrollbar-track {
+      background: #f1f5f9;
+    }
+
+    ::-webkit-scrollbar-thumb {
+      background: #94a3b8;
+      border-radius: 4px;
+    }
+
+    ::-webkit-scrollbar-thumb:hover {
+      background: #64748b;
+    }
+  </style>
+</head>
+
+<body class="bg-gray-50">
+  <!-- Navigation -->
+  <nav class="bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg fixed w-full z-10">
+    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
+      <div class="flex justify-between h-16">
+        <div class="flex items-center">
+          <a href="/" class="flex items-center space-x-3">
+            <i class="bi bi-wallet2 text-white text-2xl"></i>
+            <span class="text-white text-xl font-bold">Finance Tracker</span>
+          </a>
+        </div>
+        <div class="hidden md:flex items-center space-x-1">
+          <a href="/"
+            class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
+            <i class="bi bi-house-door"></i>
+            <span>Home</span>
+          </a>
+          <a href="/expenses-by-category/"
+            class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
+            <i class="bi bi-graph-down"></i>
+            <span>Expenses</span>
+          </a>
+          <a href="/income-by-category/"
+            class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
+            <i class="bi bi-graph-up"></i>
+            <span>Income</span>
+          </a>
+          <a href="/expenses-vs-income/"
+            class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
+            <i class="bi bi-bar-chart"></i>
+            <span>Analytics</span>
+          </a>
+          <a href="/monthly-budget/"
+            class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
+            <i class="bi bi-calendar-month"></i>
+            <span>Budget</span>
+          </a>
+          <a href="/settings/"
+            class="text-white hover:bg-white/10 px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
+            <i class="bi bi-gear"></i>
+            <span>Settings</span>
+          </a>
         </div>
       </div>
-    </nav>
+    </div>
+  </nav>
 
-    <!-- Main Content -->
-    <div class="pt-16">
-      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
-        {% block content %}{% endblock %}
-      </div>
+  <!-- Main Content -->
+  <div class="pt-16">
+    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
+      {% block content %}{% endblock %}
     </div>
+  </div>
 
-    <!-- Footer -->
-    <footer class="bg-white border-t border-gray-200 mt-auto">
-      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
-        <p class="text-center text-gray-500 text-sm">
-          &copy; 2025 Finance Tracker. Built with Django & Tailwind CSS.
-        </p>
-      </div>
-    </footer>
-  </body>
-</html>
+  <!-- Footer -->
+  <footer class="bg-white border-t border-gray-200 mt-auto">
+    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
+      <p class="text-center text-gray-500 text-sm">
+        &copy; 2025 Finance Tracker. Built with Django & Tailwind CSS.
+      </p>
+    </div>
+  </footer>
+</body>
+
+</html>
\ No newline at end of file
diff --git a/faster/templates/dashboard/dashboard.html b/faster/templates/dashboard/dashboard.html
index 87440e1..36bbae5 100644
--- a/faster/templates/dashboard/dashboard.html
+++ b/faster/templates/dashboard/dashboard.html
@@ -17,24 +17,22 @@
 <!-- Summary Stats Cards -->
 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
   <!-- Total Expenses Card -->
-  <div
-    class="bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500 hover:shadow-xl transition duration-300"
-  >
+  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500 hover:shadow-xl transition duration-300">
     <div class="flex items-center justify-between">
       <div>
         <p class="text-sm font-medium text-gray-600 uppercase">Top Expense</p>
         {% if top_spending %}
-          <p class="text-3xl font-bold text-gray-900 mt-2">
-            {{ top_spending.0.total|floatformat:0|intcomma }}
-            <span class="text-base text-gray-500">
-              {% for currency, amount in top_spending.0.currencies.items %}
-                {{ currency }}{% if not forloop.last %}/{% endif %}
-              {% endfor %}
-            </span>
-          </p>
-          <p class="text-xs text-gray-500 mt-1">{{ top_spending.0.category }}</p>
+        <p class="text-3xl font-bold text-gray-900 mt-2">
+          {{ top_spending.0.total|floatformat:0|intcomma }}
+          <span class="text-base text-gray-500">
+            {% for currency, amount in top_spending.0.currencies.items %}
+            {{ currency }}{% if not forloop.last %}/{% endif %}
+            {% endfor %}
+          </span>
+        </p>
+        <p class="text-xs text-gray-500 mt-1">{{ top_spending.0.category }}</p>
         {% else %}
-          <p class="text-3xl font-bold text-gray-400 mt-2">-</p>
+        <p class="text-3xl font-bold text-gray-400 mt-2">-</p>
         {% endif %}
       </div>
       <div class="bg-red-100 rounded-full p-3">
@@ -44,24 +42,22 @@
   </div>
 
   <!-- Total Income Card -->
-  <div
-    class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500 hover:shadow-xl transition duration-300"
-  >
+  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500 hover:shadow-xl transition duration-300">
     <div class="flex items-center justify-between">
       <div>
         <p class="text-sm font-medium text-gray-600 uppercase">Top Income</p>
         {% if top_income %}
-          <p class="text-3xl font-bold text-gray-900 mt-2">
-            {{ top_income.0.total|floatformat:0|intcomma }}
-            <span class="text-base text-gray-500">
-              {% for currency, amount in top_income.0.currencies.items %}
-                {{ currency }}{% if not forloop.last %}/{% endif %}
-              {% endfor %}
-            </span>
-          </p>
-          <p class="text-xs text-gray-500 mt-1">{{ top_income.0.category }}</p>
+        <p class="text-3xl font-bold text-gray-900 mt-2">
+          {{ top_income.0.total|floatformat:0|intcomma }}
+          <span class="text-base text-gray-500">
+            {% for currency, amount in top_income.0.currencies.items %}
+            {{ currency }}{% if not forloop.last %}/{% endif %}
+            {% endfor %}
+          </span>
+        </p>
+        <p class="text-xs text-gray-500 mt-1">{{ top_income.0.category }}</p>
         {% else %}
-          <p class="text-3xl font-bold text-gray-400 mt-2">-</p>
+        <p class="text-3xl font-bold text-gray-400 mt-2">-</p>
         {% endif %}
       </div>
       <div class="bg-green-100 rounded-full p-3">
@@ -80,28 +76,21 @@
     <div class="flex items-center space-x-4">
       <!-- Chart Type Toggle -->
       <div class="flex space-x-2 bg-blue-600 rounded-lg p-1">
-        <button 
-          id="chartTypeLineBtn" 
-          class="px-3 py-1 rounded text-sm font-semibold text-white bg-blue-700 transition"
-          onclick="switchChartType('line')"
-        >
+        <button id="chartTypeLineBtn" class="px-3 py-1 rounded text-sm font-semibold text-white bg-blue-700 transition"
+          onclick="switchChartType('line')">
           <i class="bi bi-graph-up mr-1"></i>Line
         </button>
-        <button 
-          id="chartTypeBarBtn" 
+        <button id="chartTypeBarBtn"
           class="px-3 py-1 rounded text-sm font-semibold text-blue-200 hover:bg-blue-600 transition"
-          onclick="switchChartType('bar')"
-        >
+          onclick="switchChartType('bar')">
           <i class="bi bi-bar-chart mr-1"></i>Bar
         </button>
       </div>
-      
+
       <!-- Year Selector -->
-      <select 
-        id="yearSelector" 
+      <select id="yearSelector"
         class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-semibold focus:outline-none focus:ring-2 focus:ring-blue-500"
-        onchange="switchYear(this.value)"
-      >
+        onchange="switchYear(this.value)">
         <option value="">All Years</option>
         <!-- Year options will be populated by JavaScript -->
       </select>
@@ -118,183 +107,152 @@
 
 <!-- Main Content Grid -->
 <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
-    <!-- Top Spending Categories -->
-    <div
-      class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300"
-    >
-      <div class="bg-gradient-to-r from-red-500 to-pink-500 px-6 py-4">
-        <h2 class="text-xl font-bold text-white flex items-center">
-          <i class="bi bi-pie-chart-fill mr-2"></i>
-          Top Spending Categories
-        </h2>
+  <!-- Top Spending Categories -->
+  <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300">
+    <div class="bg-gradient-to-r from-red-500 to-pink-500 px-6 py-4">
+      <h2 class="text-xl font-bold text-white flex items-center">
+        <i class="bi bi-pie-chart-fill mr-2"></i>
+        Top Spending Categories
+      </h2>
+    </div>
+    <div class="p-6">
+      {% if top_spending %}
+      <div class="flex justify-center mb-6">
+        <div class="w-80 h-80">
+          <canvas id="spendingPieChart"></canvas>
+        </div>
       </div>
-      <div class="p-6">
-        {% if top_spending %}
-          <div class="flex justify-center mb-6">
-            <div class="w-80 h-80">
-              <canvas id="spendingPieChart"></canvas>
-            </div>
-          </div>
-          <div class="space-y-2">
-            {% for item in top_spending %}
-              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
-                <div class="flex items-center space-x-3">
-                  <div class="w-4 h-4 rounded-full" style="background-color: {{ item.color }}"></div>
-                  <p class="font-medium text-gray-900 text-sm">{{ item.category }}</p>
-                </div>
-                <p class="text-sm font-bold text-gray-700">
-                  {{ item.total|floatformat:2|intcomma }}
-                  <span class="text-xs text-gray-500"> 
-                    {% for currency, amount in item.currencies.items %}
-                      {{ currency }}{% if not forloop.last %}/{% endif %}
-                    {% endfor %}
-                  </span>
-                </p>
-              </div>
-            {% endfor %}
-          </div>
-        {% else %}
-          <div class="text-center py-12">
-            <i class="bi bi-inbox text-gray-300 text-5xl"></i>
-            <p class="text-gray-500 mt-4">No expense data available</p>
-            <p class="text-sm text-gray-400 mt-2">
-              Upload your bank statements to get started
-            </p>
+      <div class="space-y-2">
+        {% for item in top_spending %}
+        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
+          <div class="flex items-center space-x-3">
+            <div class="w-4 h-4 rounded-full" style="background-color: {{ item.color }}"></div>
+            <p class="font-medium text-gray-900 text-sm">{{ item.category }}</p>
           </div>
-        {% endif %}
+          <p class="text-sm font-bold text-gray-700">
+            {{ item.total|floatformat:2|intcomma }}
+            <span class="text-xs text-gray-500">
+              {% for currency, amount in item.currencies.items %}
+              {{ currency }}{% if not forloop.last %}/{% endif %}
+              {% endfor %}
+            </span>
+          </p>
+        </div>
+        {% endfor %}
+      </div>
+      {% else %}
+      <div class="text-center py-12">
+        <i class="bi bi-inbox text-gray-300 text-5xl"></i>
+        <p class="text-gray-500 mt-4">No expense data available</p>
+        <p class="text-sm text-gray-400 mt-2">
+          Upload your bank statements to get started
+        </p>
       </div>
+      {% endif %}
     </div>
+  </div>
 
-    <!-- Top Income Categories -->
-    <div
-      class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300"
-    >
-      <div class="bg-gradient-to-r from-green-500 to-emerald-500 px-6 py-4">
-        <h2 class="text-xl font-bold text-white flex items-center">
-          <i class="bi bi-pie-chart-fill mr-2"></i>
-          Top Income Categories
-        </h2>
+  <!-- Top Income Categories -->
+  <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300">
+    <div class="bg-gradient-to-r from-green-500 to-emerald-500 px-6 py-4">
+      <h2 class="text-xl font-bold text-white flex items-center">
+        <i class="bi bi-pie-chart-fill mr-2"></i>
+        Top Income Categories
+      </h2>
+    </div>
+    <div class="p-6">
+      {% if top_income %}
+      <div class="flex justify-center mb-6">
+        <div class="w-80 h-80">
+          <canvas id="incomePieChart"></canvas>
+        </div>
       </div>
-      <div class="p-6">
-        {% if top_income %}
-          <div class="flex justify-center mb-6">
-            <div class="w-80 h-80">
-              <canvas id="incomePieChart"></canvas>
-            </div>
-          </div>
-          <div class="space-y-2">
-            {% for item in top_income %}
-              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
-                <div class="flex items-center space-x-3">
-                  <div class="w-4 h-4 rounded-full" style="background-color: {{ item.color }}"></div>
-                  <p class="font-medium text-gray-900 text-sm">{{ item.category }}</p>
-                </div>
-                <p class="text-sm font-bold text-gray-700">
-                  {{ item.total|floatformat:2|intcomma }}
-                  <span class="text-xs text-gray-500">
-                    {% for currency, amount in item.currencies.items %}
-                      {{ currency }}{% if not forloop.last %}/{% endif %}
-                    {% endfor %}
-                  </span>
-                </p>
-              </div>
-            {% endfor %}
+      <div class="space-y-2">
+        {% for item in top_income %}
+        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
+          <div class="flex items-center space-x-3">
+            <div class="w-4 h-4 rounded-full" style="background-color: {{ item.color }}"></div>
+            <p class="font-medium text-gray-900 text-sm">{{ item.category }}</p>
           </div>
-        {% else %}
-          <div class="text-center py-12">
-            <i class="bi bi-inbox text-gray-300 text-5xl"></i>
-          <p class="text-gray-500 mt-4">No income data available</p>
-          <p class="text-sm text-gray-400 mt-2">
-            Upload your bank statements to get started
+          <p class="text-sm font-bold text-gray-700">
+            {{ item.total|floatformat:2|intcomma }}
+            <span class="text-xs text-gray-500">
+              {% for currency, amount in item.currencies.items %}
+              {{ currency }}{% if not forloop.last %}/{% endif %}
+              {% endfor %}
+            </span>
           </p>
         </div>
-        {% endif %}
+        {% endfor %}
       </div>
+      {% else %}
+      <div class="text-center py-12">
+        <i class="bi bi-inbox text-gray-300 text-5xl"></i>
+        <p class="text-gray-500 mt-4">No income data available</p>
+        <p class="text-sm text-gray-400 mt-2">
+          Upload your bank statements to get started
+        </p>
+      </div>
+      {% endif %}
     </div>
   </div>
+</div>
 
 
-  <!-- Quick Actions -->
-  <div
-    class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-lg p-8 text-white mb-8"
-  >
-    <div class="flex flex-col md:flex-row items-center justify-between">
-      <div class="mb-4 md:mb-0">
-        <h3 class="text-2xl font-bold mb-2">Ready to analyze more?</h3>
-        <p class="text-indigo-100">
-          Upload bank statements, manage filters, and explore detailed analytics
-        </p>
-      </div>
-      <div class="flex space-x-4">
-        <a
-          href="{% url 'settings' %}"
-          class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-semibold hover:bg-indigo-50 transition duration-200 flex items-center space-x-2"
-        >
-          <i class="bi bi-upload"></i>
-          <span>Upload Data</span>
-        </a>
-        <a
-          href="/expenses-vs-income/"
-          class="bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-800 transition duration-200 flex items-center space-x-2"
-        >
-          <i class="bi bi-graph-up"></i>
-          <span>View Analytics</span>
-        </a>
-      </div>
+<!-- Quick Actions -->
+<div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-lg p-8 text-white mb-8">
+  <div class="flex flex-col md:flex-row items-center justify-between">
+    <div class="mb-4 md:mb-0">
+      <h3 class="text-2xl font-bold mb-2">Ready to analyze more?</h3>
+      <p class="text-indigo-100">
+        Upload bank statements, manage filters, and explore detailed analytics
+      </p>
+    </div>
+    <div class="flex space-x-4">
+      <a href="{% url 'settings' %}"
+        class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-semibold hover:bg-indigo-50 transition duration-200 flex items-center space-x-2">
+        <i class="bi bi-upload"></i>
+        <span>Upload Data</span>
+      </a>
+      <a href="/expenses-vs-income/"
+        class="bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-800 transition duration-200 flex items-center space-x-2">
+        <i class="bi bi-graph-up"></i>
+        <span>View Analytics</span>
+      </a>
     </div>
   </div>
-  
+</div>
+
 <!-- Compact Time Filter (Bottom Right) -->
 <div class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-3 border border-gray-200 z-40">
   <div class="flex flex-col gap-2">
     <div class="text-xs font-semibold text-gray-600 mb-1">
       <i class="bi bi-calendar-range text-indigo-600"></i> Time Period
     </div>
-    
+
     <div class="flex flex-col gap-1">
-      <button
-        type="button"
-        onclick="setTimeFilter('all')"
-        id="filter-all"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white"
-      >
+      <button type="button" onclick="setTimeFilter('all')" id="filter-all"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white">
         All Time
       </button>
-      <button
-        type="button"
-        onclick="setTimeFilter('last_year')"
-        id="filter-last_year"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
+      <button type="button" onclick="setTimeFilter('last_year')" id="filter-last_year"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
         Last Year
       </button>
-      <button
-        type="button"
-        onclick="toggleCustomDateRange()"
-        id="filter-custom"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
+      <button type="button" onclick="toggleCustomDateRange()" id="filter-custom"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
         Custom
       </button>
     </div>
 
     <!-- Custom Date Range Inputs (Hidden by default) -->
     <div id="customDateInputs" class="hidden mt-2 space-y-2">
-      <input
-        type="date"
-        id="startDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <input
-        type="date"
-        id="endDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <button
-        type="button"
-        onclick="applyCustomDateRange()"
-        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium transition duration-200"
-      >
+      <input type="date" id="startDate"
+        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
+      <input type="date" id="endDate"
+        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
+      <button type="button" onclick="applyCustomDateRange()"
+        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium transition duration-200">
         Apply
       </button>
     </div>
@@ -302,7 +260,8 @@
 </div>
 
 <!-- Side Panel for Category Details -->
-<div id="categoryDetailPanel" class="fixed right-0 top-0 h-full w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
+<div id="categoryDetailPanel"
+  class="fixed right-0 top-0 h-full w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
   <div class="h-full flex flex-col">
     <!-- Header -->
     <div id="panelHeader" class="px-6 py-4">
@@ -314,7 +273,7 @@
       </div>
       <p id="panelAmount" class="text-2xl font-bold mt-2"></p>
     </div>
-    
+
     <!-- Content -->
     <div class="flex-1 overflow-y-auto px-6 pb-6">
       <div id="panelContent"></div>
@@ -326,571 +285,571 @@
 <div id="panelOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40" onclick="closeCategoryPanel()"></div>
 
 <script>
-window.testFunction = function() {
-  console.log('Script is loading correctly!');
-  return true;
-};
-
-function setTimeFilter(period) {
-  console.log('setTimeFilter called with period:', period);
-  
-  // Update UI
-  document.querySelectorAll('.time-filter-btn').forEach(btn => {
-    btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
-  });
-  document.getElementById('filter-' + period).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-  
-  // Hide custom inputs
-  document.getElementById('customDateInputs').classList.add('hidden');
-  
-  // Set session storage
-  sessionStorage.setItem('timeFilter', period);
-  sessionStorage.removeItem('customStartDate');
-  sessionStorage.removeItem('customEndDate');
-  
-  // Load data dynamically
-  console.log('Calling loadDashboardData with:', '?time_filter=' + period);
-  loadDashboardData('?time_filter=' + period);
-  loadMonthlyData('?time_filter=' + period);
-}
-
-function toggleCustomDateRange() {
-  const customInputs = document.getElementById('customDateInputs');
-  const isHidden = customInputs.classList.contains('hidden');
-  
-  if (isHidden) {
-    customInputs.classList.remove('hidden');
-    // Update button style
+  window.testFunction = function () {
+    console.log('Script is loading correctly!');
+    return true;
+  };
+
+  function setTimeFilter(period) {
+    console.log('setTimeFilter called with period:', period);
+
+    // Update UI
     document.querySelectorAll('.time-filter-btn').forEach(btn => {
       btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
     });
-    document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-  } else {
-    customInputs.classList.add('hidden');
+    document.getElementById('filter-' + period).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
+
+    // Hide custom inputs
+    document.getElementById('customDateInputs').classList.add('hidden');
+
+    // Set session storage
+    sessionStorage.setItem('timeFilter', period);
+    sessionStorage.removeItem('customStartDate');
+    sessionStorage.removeItem('customEndDate');
+
+    // Load data dynamically
+    console.log('Calling loadDashboardData with:', '?time_filter=' + period);
+    loadDashboardData('?time_filter=' + period);
+    loadMonthlyData('?time_filter=' + period);
   }
-}
-
-function applyCustomDateRange() {
-  const startDate = document.getElementById('startDate').value;
-  const endDate = document.getElementById('endDate').value;
-  
-  if (!startDate || !endDate) {
-    alert('Please select both start and end dates');
-    return;
+
+  function toggleCustomDateRange() {
+    const customInputs = document.getElementById('customDateInputs');
+    const isHidden = customInputs.classList.contains('hidden');
+
+    if (isHidden) {
+      customInputs.classList.remove('hidden');
+      // Update button style
+      document.querySelectorAll('.time-filter-btn').forEach(btn => {
+        btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
+      });
+      document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
+    } else {
+      customInputs.classList.add('hidden');
+    }
   }
-  
-  // Set session storage
-  sessionStorage.setItem('timeFilter', 'custom');
-  sessionStorage.setItem('customStartDate', startDate);
-  sessionStorage.setItem('customEndDate', endDate);
-  
-  // Load data dynamically
-  const queryParams = '?time_filter=custom&start_date=' + startDate + '&end_date=' + endDate;
-  loadDashboardData(queryParams);
-  loadMonthlyData(queryParams);
-}
-
-// Dynamic data loading function
-function loadDashboardData(queryParams) {
-  console.log('loadDashboardData called with queryParams:', queryParams);
-  
-  const url = '/api/dashboard-data/' + queryParams;
-  console.log('Fetching URL:', url);
-  
-  fetch(url)
-    .then(response => {
-      console.log('Response status:', response.status);
-      return response.json();
-    })
-    .then(data => {
-      console.log('Response data:', data);
-      console.log('Top spending data:', data.top_spending);
-      console.log('Top income data:', data.top_income);
-      
-      if (data.success) {
-        console.log('Updating charts and lists...');
-        updateCharts(data.top_spending, data.top_income);
-        updateCategoryLists(data);
-      } else {
-        console.error('Failed to load dashboard data:', data.error);
-        alert('Failed to load data. Please try again.');
-      }
-    })
-    .catch(error => {
-      console.error('Error loading dashboard data:', error);
-      alert('Network error. Please check your connection and try again.');
-    });
-}
-
-// Update charts with new data
-function updateCharts(spendingData, incomeData) {
-  console.log('updateCharts called with spending data length:', spendingData ? spendingData.length : 'null');
-  console.log('updateCharts called with income data length:', incomeData ? incomeData.length : 'null');
-  
-  // Destroy existing charts
-  if (window.spendingChart) {
-    window.spendingChart.destroy();
-    console.log('Destroyed existing spending chart');
+
+  function applyCustomDateRange() {
+    const startDate = document.getElementById('startDate').value;
+    const endDate = document.getElementById('endDate').value;
+
+    if (!startDate || !endDate) {
+      alert('Please select both start and end dates');
+      return;
+    }
+
+    // Set session storage
+    sessionStorage.setItem('timeFilter', 'custom');
+    sessionStorage.setItem('customStartDate', startDate);
+    sessionStorage.setItem('customEndDate', endDate);
+
+    // Load data dynamically
+    const queryParams = '?time_filter=custom&start_date=' + startDate + '&end_date=' + endDate;
+    loadDashboardData(queryParams);
+    loadMonthlyData(queryParams);
   }
-  if (window.incomeChart) {
-    window.incomeChart.destroy();
-    console.log('Destroyed existing income chart');
+
+  // Dynamic data loading function
+  function loadDashboardData(queryParams) {
+    console.log('loadDashboardData called with queryParams:', queryParams);
+
+    const url = '/api/dashboard-data/' + queryParams;
+    console.log('Fetching URL:', url);
+
+    fetch(url)
+      .then(response => {
+        console.log('Response status:', response.status);
+        return response.json();
+      })
+      .then(data => {
+        console.log('Response data:', data);
+        console.log('Top spending data:', data.top_spending);
+        console.log('Top income data:', data.top_income);
+
+        if (data.success) {
+          console.log('Updating charts and lists...');
+          updateCharts(data.top_spending, data.top_income);
+          updateCategoryLists(data);
+        } else {
+          console.error('Failed to load dashboard data:', data.error);
+          alert('Failed to load data. Please try again.');
+        }
+      })
+      .catch(error => {
+        console.error('Error loading dashboard data:', error);
+        alert('Network error. Please check your connection and try again.');
+      });
   }
-  
-  // Small delay to ensure DOM is updated
-  setTimeout(() => {
-    console.log('Creating charts after DOM update delay...');
-    
-    // Recreate spending chart
-    if (spendingData && spendingData.length > 0) {
-      console.log('Looking for spending canvas...');
-      const spendingCanvas = document.getElementById('spendingPieChart');
-      console.log('Spending canvas found:', spendingCanvas);
-      if (spendingCanvas) {
-        console.log('Creating spending chart with data:', spendingData);
-        const spendingCtx = spendingCanvas.getContext('2d');
-        window.spendingChart = new Chart(spendingCtx, {
-          type: 'pie',
-          data: {
-            labels: spendingData.map(item => item.category),
-            datasets: [{
-              data: spendingData.map(item => Math.abs(item.total)),
-              backgroundColor: spendingData.map(item => item.color),
-              borderWidth: 2,
-              borderColor: '#ffffff'
-            }]
-          },
-          options: {
-            responsive: true,
-            maintainAspectRatio: false,
-            plugins: {
-              legend: { display: false },
-              tooltip: {
-                callbacks: {
-                  label: function(context) {
-                    const value = context.raw;
-                    return context.label + ': ' + value.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' CHF';
+
+  // Update charts with new data
+  function updateCharts(spendingData, incomeData) {
+    console.log('updateCharts called with spending data length:', spendingData ? spendingData.length : 'null');
+    console.log('updateCharts called with income data length:', incomeData ? incomeData.length : 'null');
+
+    // Destroy existing charts
+    if (window.spendingChart) {
+      window.spendingChart.destroy();
+      console.log('Destroyed existing spending chart');
+    }
+    if (window.incomeChart) {
+      window.incomeChart.destroy();
+      console.log('Destroyed existing income chart');
+    }
+
+    // Small delay to ensure DOM is updated
+    setTimeout(() => {
+      console.log('Creating charts after DOM update delay...');
+
+      // Recreate spending chart
+      if (spendingData && spendingData.length > 0) {
+        console.log('Looking for spending canvas...');
+        const spendingCanvas = document.getElementById('spendingPieChart');
+        console.log('Spending canvas found:', spendingCanvas);
+        if (spendingCanvas) {
+          console.log('Creating spending chart with data:', spendingData);
+          const spendingCtx = spendingCanvas.getContext('2d');
+          window.spendingChart = new Chart(spendingCtx, {
+            type: 'pie',
+            data: {
+              labels: spendingData.map(item => item.category),
+              datasets: [{
+                data: spendingData.map(item => Math.abs(item.total)),
+                backgroundColor: spendingData.map(item => item.color),
+                borderWidth: 2,
+                borderColor: '#ffffff'
+              }]
+            },
+            options: {
+              responsive: true,
+              maintainAspectRatio: false,
+              plugins: {
+                legend: { display: false },
+                tooltip: {
+                  callbacks: {
+                    label: function (context) {
+                      const value = context.raw;
+                      return context.label + ': ' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' CHF';
+                    }
                   }
                 }
               }
             }
-          }
-        });
-        console.log('Spending chart created successfully');
-      } else {
-        console.log('Spending canvas not found!');
+          });
+          console.log('Spending chart created successfully');
+        } else {
+          console.log('Spending canvas not found!');
+        }
       }
-    }
-    
-    // Recreate income chart
-    if (incomeData && incomeData.length > 0) {
-      console.log('Looking for income canvas...');
-      const incomeCanvas = document.getElementById('incomePieChart');
-      console.log('Income canvas found:', incomeCanvas);
-      if (incomeCanvas) {
-        console.log('Creating income chart with data:', incomeData);
-        const incomeCtx = incomeCanvas.getContext('2d');
-        window.incomeChart = new Chart(incomeCtx, {
-          type: 'pie',
-          data: {
-            labels: incomeData.map(item => item.category),
-            datasets: [{
-              data: incomeData.map(item => Math.abs(item.total)),
-              backgroundColor: incomeData.map(item => item.color),
-              borderWidth: 2,
-              borderColor: '#ffffff'
-            }]
-          },
-          options: {
-            responsive: true,
-            maintainAspectRatio: false,
-            plugins: {
-              legend: { display: false },
-              tooltip: {
-                callbacks: {
-                  label: function(context) {
-                    const value = context.raw;
-                    return context.label + ': ' + value.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' CHF';
+
+      // Recreate income chart
+      if (incomeData && incomeData.length > 0) {
+        console.log('Looking for income canvas...');
+        const incomeCanvas = document.getElementById('incomePieChart');
+        console.log('Income canvas found:', incomeCanvas);
+        if (incomeCanvas) {
+          console.log('Creating income chart with data:', incomeData);
+          const incomeCtx = incomeCanvas.getContext('2d');
+          window.incomeChart = new Chart(incomeCtx, {
+            type: 'pie',
+            data: {
+              labels: incomeData.map(item => item.category),
+              datasets: [{
+                data: incomeData.map(item => Math.abs(item.total)),
+                backgroundColor: incomeData.map(item => item.color),
+                borderWidth: 2,
+                borderColor: '#ffffff'
+              }]
+            },
+            options: {
+              responsive: true,
+              maintainAspectRatio: false,
+              plugins: {
+                legend: { display: false },
+                tooltip: {
+                  callbacks: {
+                    label: function (context) {
+                      const value = context.raw;
+                      return context.label + ': ' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' CHF';
+                    }
                   }
                 }
               }
             }
-          }
-        });
-        console.log('Income chart created successfully');
-      } else {
-        console.log('Income canvas not found!');
+          });
+          console.log('Income chart created successfully');
+        } else {
+          console.log('Income canvas not found!');
+        }
       }
-    }
-  }, 100); // 100ms delay to allow DOM update
-}
-
-// Update category lists in the UI
-function updateCategoryLists(data) {
-  console.log('updateCategoryLists called');
-  
-  // Update spending categories list
-  if (data.top_spending) {
-    console.log('Updating spending section with', data.top_spending.length, 'items');
-    updateCategorySection('spending', data.top_spending);
-  }
-  
-  // Update income categories list
-  if (data.top_income) {
-    console.log('Updating income section with', data.top_income.length, 'items');
-    updateCategorySection('income', data.top_income);
-  }
-}
-
-function updateCategorySection(type, categories) {
-  console.log('updateCategorySection called for type:', type, 'with', categories.length, 'categories');
-  
-  const sectionClass = type === 'spending' ? '.from-red-500' : '.from-green-500';
-  console.log('Looking for section with class:', sectionClass);
-  
-  const gradientElement = document.querySelector(sectionClass);
-  console.log('Gradient element found:', gradientElement);
-  
-  const section = gradientElement ? gradientElement.closest('.bg-white') : null;
-  console.log('Section found:', section);
-  
-  if (!section) {
-    console.log('No section found for type:', type);
-    return;
+    }, 100); // 100ms delay to allow DOM update
   }
-  
-  const contentDiv = section.querySelector('.p-6');
-  console.log('Content div found:', contentDiv);
-  
-  if (!contentDiv) {
-    console.log('No content div found');
-    return;
+
+  // Update category lists in the UI
+  function updateCategoryLists(data) {
+    console.log('updateCategoryLists called');
+
+    // Update spending categories list
+    if (data.top_spending) {
+      console.log('Updating spending section with', data.top_spending.length, 'items');
+      updateCategorySection('spending', data.top_spending);
+    }
+
+    // Update income categories list
+    if (data.top_income) {
+      console.log('Updating income section with', data.top_income.length, 'items');
+      updateCategorySection('income', data.top_income);
+    }
   }
-  
-  if (categories.length === 0) {
-    console.log('No categories, showing empty state');
-    // Show empty state
-    contentDiv.innerHTML = '<div class="text-center py-12"><i class="bi bi-inbox text-gray-300 text-5xl"></i><p class="text-gray-500 mt-4">No ' + type + ' data available</p><p class="text-sm text-gray-400 mt-2">Upload your bank statements to get started</p></div>';
-    return;
+
+  function updateCategorySection(type, categories) {
+    console.log('updateCategorySection called for type:', type, 'with', categories.length, 'categories');
+
+    const sectionClass = type === 'spending' ? '.from-red-500' : '.from-green-500';
+    console.log('Looking for section with class:', sectionClass);
+
+    const gradientElement = document.querySelector(sectionClass);
+    console.log('Gradient element found:', gradientElement);
+
+    const section = gradientElement ? gradientElement.closest('.bg-white') : null;
+    console.log('Section found:', section);
+
+    if (!section) {
+      console.log('No section found for type:', type);
+      return;
+    }
+
+    const contentDiv = section.querySelector('.p-6');
+    console.log('Content div found:', contentDiv);
+
+    if (!contentDiv) {
+      console.log('No content div found');
+      return;
+    }
+
+    if (categories.length === 0) {
+      console.log('No categories, showing empty state');
+      // Show empty state
+      contentDiv.innerHTML = '<div class="text-center py-12"><i class="bi bi-inbox text-gray-300 text-5xl"></i><p class="text-gray-500 mt-4">No ' + type + ' data available</p><p class="text-sm text-gray-400 mt-2">Upload your bank statements to get started</p></div>';
+      return;
+    }
+
+    console.log('Building HTML for', categories.length, 'categories');
+
+    // Build the new HTML
+    const chartCanvasId = type === 'spending' ? 'spendingPieChart' : 'incomePieChart';
+    let html = '<div class="flex justify-center mb-6"><div class="w-80 h-80"><canvas id="' + chartCanvasId + '"></canvas></div></div><div class="space-y-2">';
+
+    categories.forEach((item, index) => {
+      console.log('Processing category', index, ':', item.category, item.total);
+      const currencyList = Object.keys(item.currencies || {}).join('/') || 'CHF';
+      html += '<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"><div class="flex items-center space-x-3"><div class="w-4 h-4 rounded-full" style="background-color: ' + item.color + '"></div><p class="font-medium text-gray-900 text-sm">' + item.category + '</p></div><p class="text-sm font-bold text-gray-700">' + item.total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '<span class="text-xs text-gray-500">' + currencyList + '</span></p></div>';
+    });
+
+    html += '</div>';
+
+    console.log('Setting innerHTML for', type, 'section');
+    console.log('HTML length:', html.length);
+    contentDiv.innerHTML = html;
+    console.log('innerHTML set successfully for', type);
   }
-  
-  console.log('Building HTML for', categories.length, 'categories');
-  
-  // Build the new HTML
-  const chartCanvasId = type === 'spending' ? 'spendingPieChart' : 'incomePieChart';
-  let html = '<div class="flex justify-center mb-6"><div class="w-80 h-80"><canvas id="' + chartCanvasId + '"></canvas></div></div><div class="space-y-2">';
-  
-  categories.forEach((item, index) => {
-    console.log('Processing category', index, ':', item.category, item.total);
-    const currencyList = Object.keys(item.currencies || {}).join('/') || 'CHF';
-    html += '<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"><div class="flex items-center space-x-3"><div class="w-4 h-4 rounded-full" style="background-color: ' + item.color + '"></div><p class="font-medium text-gray-900 text-sm">' + item.category + '</p></div><p class="text-sm font-bold text-gray-700">' + item.total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '<span class="text-xs text-gray-500">' + currencyList + '</span></p></div>';
-  });
-  
-  html += '</div>';
-  
-  console.log('Setting innerHTML for', type, 'section');
-  console.log('HTML length:', html.length);
-  contentDiv.innerHTML = html;
-  console.log('innerHTML set successfully for', type);
-}
-
-// Global variables for monthly chart
-let originalMonthlyData = {};
-let currentChartType = 'line';
-let selectedYear = '';
-
-// Populate year selector
-function populateYearSelector() {
-  const years = new Set();
-  if (originalMonthlyData.labels) {
-    originalMonthlyData.labels.forEach(label => {
-      const year = label.split('-')[0];
-      if (year) years.add(year);
+
+  // Global variables for monthly chart
+  let originalMonthlyData = {};
+  let currentChartType = 'line';
+  let selectedYear = '';
+
+  // Populate year selector
+  function populateYearSelector() {
+    const years = new Set();
+    if (originalMonthlyData.labels) {
+      originalMonthlyData.labels.forEach(label => {
+        const year = label.split('-')[0];
+        if (year) years.add(year);
+      });
+    }
+
+    const yearSelect = document.getElementById('yearSelector');
+    const sortedYears = Array.from(years).sort().reverse();
+
+    sortedYears.forEach(year => {
+      const option = document.createElement('option');
+      option.value = year;
+      option.textContent = year;
+      yearSelect.appendChild(option);
     });
   }
-  
-  const yearSelect = document.getElementById('yearSelector');
-  const sortedYears = Array.from(years).sort().reverse();
-  
-  sortedYears.forEach(year => {
-    const option = document.createElement('option');
-    option.value = year;
-    option.textContent = year;
-    yearSelect.appendChild(option);
-  });
-}
-
-// Filter chart data by year
-function filterDataByYear(year) {
-  if (!year) {
-    return {
-      labels: originalMonthlyData.labels,
-      expenses: originalMonthlyData.expenses,
-      income: originalMonthlyData.income
+
+  // Filter chart data by year
+  function filterDataByYear(year) {
+    if (!year) {
+      return {
+        labels: originalMonthlyData.labels,
+        expenses: originalMonthlyData.expenses,
+        income: originalMonthlyData.income
+      };
+    }
+
+    const filtered = {
+      labels: [],
+      expenses: [],
+      income: []
     };
+
+    originalMonthlyData.labels.forEach((label, index) => {
+      if (label.startsWith(year)) {
+        filtered.labels.push(label);
+        filtered.expenses.push(originalMonthlyData.expenses[index]);
+        filtered.income.push(originalMonthlyData.income[index]);
+      }
+    });
+
+    return filtered;
   }
-  
-  const filtered = {
-    labels: [],
-    expenses: [],
-    income: []
-  };
-  
-  originalMonthlyData.labels.forEach((label, index) => {
-    if (label.startsWith(year)) {
-      filtered.labels.push(label);
-      filtered.expenses.push(originalMonthlyData.expenses[index]);
-      filtered.income.push(originalMonthlyData.income[index]);
+
+  // Switch chart type
+  function switchChartType(type) {
+    currentChartType = type;
+
+    // Update button styling
+    const lineBtn = document.getElementById('chartTypeLineBtn');
+    const barBtn = document.getElementById('chartTypeBarBtn');
+
+    if (type === 'line') {
+      lineBtn.classList.add('bg-blue-700');
+      lineBtn.classList.remove('text-blue-200', 'hover:bg-blue-600');
+      barBtn.classList.remove('bg-blue-700');
+      barBtn.classList.add('text-blue-200', 'hover:bg-blue-600');
+    } else {
+      barBtn.classList.add('bg-blue-700');
+      barBtn.classList.remove('text-blue-200', 'hover:bg-blue-600');
+      lineBtn.classList.remove('bg-blue-700');
+      lineBtn.classList.add('text-blue-200', 'hover:bg-blue-600');
     }
-  });
-  
-  return filtered;
-}
-
-// Switch chart type
-function switchChartType(type) {
-  currentChartType = type;
-  
-  // Update button styling
-  const lineBtn = document.getElementById('chartTypeLineBtn');
-  const barBtn = document.getElementById('chartTypeBarBtn');
-  
-  if (type === 'line') {
-    lineBtn.classList.add('bg-blue-700');
-    lineBtn.classList.remove('text-blue-200', 'hover:bg-blue-600');
-    barBtn.classList.remove('bg-blue-700');
-    barBtn.classList.add('text-blue-200', 'hover:bg-blue-600');
-  } else {
-    barBtn.classList.add('bg-blue-700');
-    barBtn.classList.remove('text-blue-200', 'hover:bg-blue-600');
-    lineBtn.classList.remove('bg-blue-700');
-    lineBtn.classList.add('text-blue-200', 'hover:bg-blue-600');
-  }
-  
-  updateMonthlyChart();
-}
-
-// Switch year
-function switchYear(year) {
-  selectedYear = year;
-  updateMonthlyChart();
-}
-
-// Update monthly chart based on current type and year
-function updateMonthlyChart() {
-  const filteredData = filterDataByYear(selectedYear);
-  
-  if (window.monthlyChart && typeof window.monthlyChart.destroy === 'function') {
-    window.monthlyChart.destroy();
+
+    updateMonthlyChart();
   }
-  
-  const monthlyCtx = document.getElementById('monthlyChart');
-  if (!monthlyCtx) {
-    console.error('Monthly chart canvas element not found');
-    return;
+
+  // Switch year
+  function switchYear(year) {
+    selectedYear = year;
+    updateMonthlyChart();
   }
-  
-  console.log('Creating chart with type:', currentChartType, 'year:', selectedYear, 'data points:', filteredData.labels.length);
-  
-  const chartConfig = {
-    type: currentChartType,
-    data: {
-      labels: filteredData.labels,
-      datasets: [
-        {
-          label: 'Expenses',
-          data: filteredData.expenses,
-          borderColor: 'rgb(239, 68, 68)',
-          backgroundColor: currentChartType === 'line' ? 'rgba(239, 68, 68, 0.1)' : 'rgb(239, 68, 68)',
-          borderWidth: currentChartType === 'line' ? 3 : 0,
-          fill: currentChartType === 'line',
-          tension: 0.4,
-          pointRadius: currentChartType === 'line' ? 5 : 0,
-          pointBackgroundColor: 'rgb(239, 68, 68)',
-          pointBorderColor: '#fff',
-          pointBorderWidth: 2,
-          pointHoverRadius: 7
-        },
-        {
-          label: 'Income',
-          data: filteredData.income,
-          borderColor: 'rgb(34, 197, 94)',
-          backgroundColor: currentChartType === 'line' ? 'rgba(34, 197, 94, 0.1)' : 'rgb(34, 197, 94)',
-          borderWidth: currentChartType === 'line' ? 3 : 0,
-          fill: currentChartType === 'line',
-          tension: 0.4,
-          pointRadius: currentChartType === 'line' ? 5 : 0,
-          pointBackgroundColor: 'rgb(34, 197, 94)',
-          pointBorderColor: '#fff',
-          pointBorderWidth: 2,
-          pointHoverRadius: 7
-        }
-      ]
-    },
-    options: {
-      responsive: true,
-      maintainAspectRatio: false,
-      interaction: {
-        mode: 'index',
-        intersect: false
-      },
-      plugins: {
-        legend: {
-          display: true,
-          position: 'top',
-          labels: {
-            usePointStyle: true,
-            padding: 15,
-            font: { size: 12, weight: 'bold' }
+
+  // Update monthly chart based on current type and year
+  function updateMonthlyChart() {
+    const filteredData = filterDataByYear(selectedYear);
+
+    if (window.monthlyChart && typeof window.monthlyChart.destroy === 'function') {
+      window.monthlyChart.destroy();
+    }
+
+    const monthlyCtx = document.getElementById('monthlyChart');
+    if (!monthlyCtx) {
+      console.error('Monthly chart canvas element not found');
+      return;
+    }
+
+    console.log('Creating chart with type:', currentChartType, 'year:', selectedYear, 'data points:', filteredData.labels.length);
+
+    const chartConfig = {
+      type: currentChartType,
+      data: {
+        labels: filteredData.labels,
+        datasets: [
+          {
+            label: 'Expenses',
+            data: filteredData.expenses,
+            borderColor: 'rgb(239, 68, 68)',
+            backgroundColor: currentChartType === 'line' ? 'rgba(239, 68, 68, 0.1)' : 'rgb(239, 68, 68)',
+            borderWidth: currentChartType === 'line' ? 3 : 0,
+            fill: currentChartType === 'line',
+            tension: 0.4,
+            pointRadius: currentChartType === 'line' ? 5 : 0,
+            pointBackgroundColor: 'rgb(239, 68, 68)',
+            pointBorderColor: '#fff',
+            pointBorderWidth: 2,
+            pointHoverRadius: 7
+          },
+          {
+            label: 'Income',
+            data: filteredData.income,
+            borderColor: 'rgb(34, 197, 94)',
+            backgroundColor: currentChartType === 'line' ? 'rgba(34, 197, 94, 0.1)' : 'rgb(34, 197, 94)',
+            borderWidth: currentChartType === 'line' ? 3 : 0,
+            fill: currentChartType === 'line',
+            tension: 0.4,
+            pointRadius: currentChartType === 'line' ? 5 : 0,
+            pointBackgroundColor: 'rgb(34, 197, 94)',
+            pointBorderColor: '#fff',
+            pointBorderWidth: 2,
+            pointHoverRadius: 7
           }
+        ]
+      },
+      options: {
+        responsive: true,
+        maintainAspectRatio: false,
+        interaction: {
+          mode: 'index',
+          intersect: false
         },
-        tooltip: {
-          backgroundColor: 'rgba(0, 0, 0, 0.8)',
-          padding: 12,
-          titleFont: { size: 14, weight: 'bold' },
-          bodyFont: { size: 13 },
-          callbacks: {
-            label: function (context) {
-              return context.dataset.label + ': CHF ' + context.parsed.y.toFixed(2);
+        plugins: {
+          legend: {
+            display: true,
+            position: 'top',
+            labels: {
+              usePointStyle: true,
+              padding: 15,
+              font: { size: 12, weight: 'bold' }
             }
-          }
-        }
-      },
-      scales: {
-        y: {
-          beginAtZero: true,
-          grid: {
-            color: 'rgba(0, 0, 0, 0.05)'
           },
-          ticks: {
-            callback: function (value) {
-              return 'CHF ' + value.toFixed(0);
+          tooltip: {
+            backgroundColor: 'rgba(0, 0, 0, 0.8)',
+            padding: 12,
+            titleFont: { size: 14, weight: 'bold' },
+            bodyFont: { size: 13 },
+            callbacks: {
+              label: function (context) {
+                return context.dataset.label + ': CHF ' + context.parsed.y.toFixed(2);
+              }
             }
           }
         },
-        x: {
-          grid: {
-            display: false
+        scales: {
+          y: {
+            beginAtZero: true,
+            grid: {
+              color: 'rgba(0, 0, 0, 0.05)'
+            },
+            ticks: {
+              callback: function (value) {
+                return 'CHF ' + value.toFixed(0);
+              }
+            }
+          },
+          x: {
+            grid: {
+              display: false
+            }
           }
         }
       }
+    };
+
+    window.monthlyChart = new Chart(monthlyCtx, chartConfig);
+  }
+
+  // Initialize the charts when page loads
+  document.addEventListener('DOMContentLoaded', function () {
+    // Initialize spending chart
+    const spendingCtx = document.getElementById('spendingPieChart');
+    if (spendingCtx) {
+      const topSpendingData = JSON.parse('{{ top_spending_json|escapejs }}');
+
+      window.spendingChart = new Chart(spendingCtx, {
+        type: 'doughnut',
+        data: {
+          labels: topSpendingData.map(item => item.category),
+          datasets: [{
+            data: topSpendingData.map(item => item.total),
+            backgroundColor: topSpendingData.map(item => item.color),
+            borderWidth: 2,
+            borderColor: '#fff'
+          }]
+        },
+        options: {
+          responsive: true,
+          maintainAspectRatio: true,
+          plugins: {
+            legend: { display: false }
+          }
+        }
+      });
     }
-  };
-  
-  window.monthlyChart = new Chart(monthlyCtx, chartConfig);
-}
-
-// Initialize the charts when page loads
-document.addEventListener('DOMContentLoaded', function() {
-  // Initialize spending chart
-  const spendingCtx = document.getElementById('spendingPieChart');
-  if (spendingCtx) {
-    const topSpendingData = JSON.parse('{{ top_spending_json|escapejs }}');
-    
-    window.spendingChart = new Chart(spendingCtx, {
-      type: 'doughnut',
-      data: {
-        labels: topSpendingData.map(item => item.category),
-        datasets: [{
-          data: topSpendingData.map(item => item.total),
-          backgroundColor: topSpendingData.map(item => item.color),
-          borderWidth: 2,
-          borderColor: '#fff'
-        }]
-      },
-      options: {
-        responsive: true,
-        maintainAspectRatio: true,
-        plugins: {
-          legend: { display: false }
+
+    // Initialize income chart
+    const incomeCtx = document.getElementById('incomePieChart');
+    if (incomeCtx) {
+      const topIncomeData = JSON.parse('{{ top_income_json|escapejs }}');
+
+      window.incomeChart = new Chart(incomeCtx, {
+        type: 'doughnut',
+        data: {
+          labels: topIncomeData.map(item => item.category),
+          datasets: [{
+            data: topIncomeData.map(item => item.total),
+            backgroundColor: topIncomeData.map(item => item.color),
+            borderWidth: 2,
+            borderColor: '#fff'
+          }]
+        },
+        options: {
+          responsive: true,
+          maintainAspectRatio: true,
+          plugins: {
+            legend: { display: false }
+          }
         }
-      }
+      });
+    }
+
+    // Store original monthly data for filtering (update global variable)
+    originalMonthlyData = JSON.parse('{{ monthly_chart_data|escapejs }}');
+
+    console.log('Monthly data loaded:', originalMonthlyData);
+    // Convert Python list to JSON array for logging
+    var excludedCatsStr = '{{ excluded_categories | escapejs }}';
+    var excludedCats = [];
+    try {
+      // Parse the Python list representation to JavaScript array
+      excludedCats = JSON.parse(excludedCatsStr.replace(/'/g, '"'));
+    } catch (e) {
+      console.warn('Could not parse excluded categories:', excludedCatsStr);
+    }
+    console.log('Excluded categories from server:', excludedCats);
+
+    // Validate data
+    if (!originalMonthlyData || !originalMonthlyData.labels || originalMonthlyData.labels.length === 0) {
+      console.error('No chart data available', originalMonthlyData);
+    }
+
+    // Initialize time filter from URL or session storage
+    const urlParams = new URLSearchParams(window.location.search);
+    const urlTimeFilter = urlParams.get('time_filter');
+    const urlStartDate = urlParams.get('start_date');
+    const urlEndDate = urlParams.get('end_date');
+
+    let activeFilter = urlTimeFilter || sessionStorage.getItem('timeFilter') || 'all';
+
+    // Populate year selector and initialize chart on page load
+    populateYearSelector();
+    updateMonthlyChart();
+
+    // Update button styles
+    document.querySelectorAll('.time-filter-btn').forEach(btn => {
+      btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
     });
-  }
-  
-  // Initialize income chart
-  const incomeCtx = document.getElementById('incomePieChart');
-  if (incomeCtx) {
-    const topIncomeData = JSON.parse('{{ top_income_json|escapejs }}');
-    
-    window.incomeChart = new Chart(incomeCtx, {
-      type: 'doughnut',
-      data: {
-        labels: topIncomeData.map(item => item.category),
-        datasets: [{
-          data: topIncomeData.map(item => item.total),
-          backgroundColor: topIncomeData.map(item => item.color),
-          borderWidth: 2,
-          borderColor: '#fff'
-        }]
-      },
-      options: {
-        responsive: true,
-        maintainAspectRatio: true,
-        plugins: {
-          legend: { display: false }
-        }
+
+    if (activeFilter === 'custom') {
+      const startDate = urlStartDate || sessionStorage.getItem('customStartDate');
+      const endDate = urlEndDate || sessionStorage.getItem('customEndDate');
+      if (startDate && endDate) {
+        document.getElementById('startDate').value = startDate;
+        document.getElementById('endDate').value = endDate;
+        document.getElementById('customDateInputs').classList.remove('hidden');
+        document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
+
+        // Save to session storage
+        sessionStorage.setItem('customStartDate', startDate);
+        sessionStorage.setItem('customEndDate', endDate);
       }
-    });
-  }
+    } else {
+      document.getElementById('filter-' + activeFilter).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
+    }
 
-  // Store original monthly data for filtering (update global variable)
-  originalMonthlyData = JSON.parse('{{ monthly_chart_data|escapejs }}');
-  
-  console.log('Monthly data loaded:', originalMonthlyData);
-  // Convert Python list to JSON array for logging
-  var excludedCatsStr = '{{ excluded_categories | escapejs }}';
-  var excludedCats = [];
-  try {
-    // Parse the Python list representation to JavaScript array
-    excludedCats = JSON.parse(excludedCatsStr.replace(/'/g, '"'));
-  } catch (e) {
-    console.warn('Could not parse excluded categories:', excludedCatsStr);
-  }
-  console.log('Excluded categories from server:', excludedCats);
-  
-  // Validate data
-  if (!originalMonthlyData || !originalMonthlyData.labels || originalMonthlyData.labels.length === 0) {
-    console.error('No chart data available', originalMonthlyData);
-  }
-  
-  // Initialize time filter from URL or session storage
-  const urlParams = new URLSearchParams(window.location.search);
-  const urlTimeFilter = urlParams.get('time_filter');
-  const urlStartDate = urlParams.get('start_date');
-  const urlEndDate = urlParams.get('end_date');
-  
-  let activeFilter = urlTimeFilter || sessionStorage.getItem('timeFilter') || 'all';
-  
-  // Populate year selector and initialize chart on page load
-  populateYearSelector();
-  updateMonthlyChart();
-  
-  // Update button styles
-  document.querySelectorAll('.time-filter-btn').forEach(btn => {
-    btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
+    // Save active filter to session
+    sessionStorage.setItem('timeFilter', activeFilter);
   });
-  
-  if (activeFilter === 'custom') {
-    const startDate = urlStartDate || sessionStorage.getItem('customStartDate');
-    const endDate = urlEndDate || sessionStorage.getItem('customEndDate');
-    if (startDate && endDate) {
-      document.getElementById('startDate').value = startDate;
-      document.getElementById('endDate').value = endDate;
-      document.getElementById('customDateInputs').classList.remove('hidden');
-      document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-      
-      // Save to session storage
-      sessionStorage.setItem('customStartDate', startDate);
-      sessionStorage.setItem('customEndDate', endDate);
-    }
-  } else {
-    document.getElementById('filter-' + activeFilter).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-  }
-  
-  // Save active filter to session
-  sessionStorage.setItem('timeFilter', activeFilter);
-});
 
   function closeCategoryPanel() {
     document.getElementById('categoryDetailPanel').classList.add('translate-x-full');
@@ -901,29 +860,29 @@ document.addEventListener('DOMContentLoaded', function() {
     const panel = document.getElementById('categoryDetailPanel');
     const overlay = document.getElementById('panelOverlay');
     const header = document.getElementById('panelHeader');
-    
+
     // Set header color based on type
     if (type === 'spending') {
       header.className = 'px-6 py-4 bg-gradient-to-r from-red-500 to-pink-600 text-white';
     } else {
       header.className = 'px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white';
     }
-    
+
     // Update panel content
     document.getElementById('panelTitle').textContent = category;
     document.getElementById('panelAmount').textContent = `${amount.toLocaleString()} ${currency}`;
-    
+
     // Show loading state
     document.getElementById('panelContent').innerHTML = `
       <div class="flex justify-center items-center py-8">
         <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
       </div>
     `;
-    
+
     // Show panel
     panel.classList.remove('translate-x-full');
     overlay.classList.remove('hidden');
-    
+
     // Fetch transactions for this category
     fetch(`/api/transactions/?category=${encodeURIComponent(category)}`)
       .then(response => response.json())
@@ -933,7 +892,7 @@ document.addEventListener('DOMContentLoaded', function() {
           <h4 class="font-semibold text-gray-900 mb-3">Recent Transactions</h4>
           <div class="space-y-2">
         `;
-        
+
         if (transactions.length === 0) {
           html += '<p class="text-gray-500 text-sm">No transactions found</p>';
         } else {
@@ -952,12 +911,12 @@ document.addEventListener('DOMContentLoaded', function() {
               </div>
             `;
           });
-          
+
           if (transactions.length > 20) {
             html += `<p class="text-xs text-gray-500 mt-3">Showing 20 of ${transactions.length} transactions</p>`;
           }
         }
-        
+
         html += '</div>';
         document.getElementById('panelContent').innerHTML = html;
       })
@@ -972,10 +931,10 @@ document.addEventListener('DOMContentLoaded', function() {
   // Dynamic data loading function
   function loadDashboardData(queryParams) {
     console.log('loadDashboardData called with queryParams:', queryParams);
-    
+
     const url = '/api/dashboard-data/' + queryParams;
     console.log('Fetching URL:', url);
-    
+
     fetch(url)
       .then(response => {
         console.log('Response status:', response.status);
@@ -1000,10 +959,10 @@ document.addEventListener('DOMContentLoaded', function() {
   // Load monthly expenses vs income data
   function loadMonthlyData(queryParams) {
     console.log('loadMonthlyData called with queryParams:', queryParams);
-    
+
     const url = '/api/dashboard-monthly-data/' + queryParams;
     console.log('Fetching monthly URL:', url);
-    
+
     fetch(url)
       .then(response => {
         console.log('Monthly response status:', response.status);
@@ -1039,19 +998,19 @@ document.addEventListener('DOMContentLoaded', function() {
       const spendingLabels = data.top_spending.map(item => item.category);
       const spendingAmounts = data.top_spending.map(item => item.total);
       const spendingColors = data.top_spending.map(item => item.color);
-      
+
       window.spendingChart.data.labels = spendingLabels;
       window.spendingChart.data.datasets[0].data = spendingAmounts;
       window.spendingChart.data.datasets[0].backgroundColor = spendingColors;
       window.spendingChart.update('active');
     }
-    
+
     // Update income chart
     if (window.incomeChart && data.top_income) {
       const incomeLabels = data.top_income.map(item => item.category);
       const incomeAmounts = data.top_income.map(item => item.total);
       const incomeColors = data.top_income.map(item => item.color);
-      
+
       window.incomeChart.data.labels = incomeLabels;
       window.incomeChart.data.datasets[0].data = incomeAmounts;
       window.incomeChart.data.datasets[0].backgroundColor = incomeColors;
@@ -1065,7 +1024,7 @@ document.addEventListener('DOMContentLoaded', function() {
     if (data.top_spending) {
       updateCategorySection('spending', data.top_spending);
     }
-    
+
     // Update income categories list
     if (data.top_income) {
       updateCategorySection('income', data.top_income);
@@ -1075,12 +1034,12 @@ document.addEventListener('DOMContentLoaded', function() {
   function updateCategorySection(type, categories) {
     const sectionClass = type === 'spending' ? '.bg-gradient-to-r.from-red-500' : '.bg-gradient-to-r.from-green-500';
     const section = document.querySelector(sectionClass)?.closest('.bg-white.rounded-xl');
-    
+
     if (!section) return;
-    
+
     const contentDiv = section.querySelector('.p-6');
     if (!contentDiv) return;
-    
+
     if (categories.length === 0) {
       // Show empty state
       contentDiv.innerHTML = `
@@ -1092,7 +1051,7 @@ document.addEventListener('DOMContentLoaded', function() {
       `;
       return;
     }
-    
+
     // Build the new HTML
     const chartCanvasId = type === 'spending' ? 'spendingPieChart' : 'incomePieChart';
     let html = `
@@ -1103,7 +1062,7 @@ document.addEventListener('DOMContentLoaded', function() {
       </div>
       <div class="space-y-2">
     `;
-    
+
     categories.forEach(item => {
       const currencyList = Object.keys(item.currencies).join('/');
       html += `
@@ -1113,22 +1072,22 @@ document.addEventListener('DOMContentLoaded', function() {
             <p class="font-medium text-gray-900 text-sm">${item.category}</p>
           </div>
           <p class="text-sm font-bold text-gray-700">
-            ${item.total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
+            ${item.total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
             <span class="text-xs text-gray-500">${currencyList}</span>
           </p>
         </div>
       `;
     });
-    
+
     html += '</div>';
     contentDiv.innerHTML = html;
   }
 
   // Event listeners
-  document.addEventListener('DOMContentLoaded', function() {
+  document.addEventListener('DOMContentLoaded', function () {
     console.log('Dashboard loaded');
   });
 
 </script>
 
-{% endblock %}
+{% endblock %}
\ No newline at end of file
diff --git a/faster/templates/dashboard/expenses_by_category.html b/faster/templates/dashboard/expenses_by_category.html
index 0ea1e73..fd575c0 100644
--- a/faster/templates/dashboard/expenses_by_category.html
+++ b/faster/templates/dashboard/expenses_by_category.html
@@ -2,62 +2,59 @@
 
 <!-- Header -->
 <div class="mb-8">
-  <h1 class="text-4xl font-bold text-gray-900 mb-2">
+  <h1 class="text-4xl font-bold  mb-2" style="color: var(--text-primary);">
     <i class="bi bi-bar-chart-fill text-red-600"></i>
     Expenses by Category
   </h1>
-  <p class="text-gray-600">View your expenses broken down by category</p>
+  <p class="" style="color: var(--text-secondary);">View your expenses broken down by category</p>
 </div>
 
 <script>
-function setTimeFilter(period) {
+  function setTimeFilter(period) {
     // Update UI
     document.querySelectorAll('.time-filter-btn').forEach(btn => {
       btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
     });
     document.getElementById('filter-' + period).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-    
+
     // Hide custom inputs
     document.getElementById('customDateInputs').classList.add('hidden');
-    
+
     // Set session storage
     sessionStorage.setItem('timeFilter', period);
     sessionStorage.removeItem('customStartDate');
     sessionStorage.removeItem('customEndDate');
-    
+
     // Load data dynamically instead of page reload
     loadExpensesData('?time_filter=' + period);
   }
 </script>
 
 <!-- Active Filters Banner -->
-<div
-  class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-indigo-500 p-4 mb-6 rounded-lg shadow-sm"
->
+<div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-indigo-500 p-4 mb-6 rounded-lg shadow-sm">
   <div class="flex items-center justify-between">
     <div class="flex items-center">
       <i class="bi bi-funnel-fill text-indigo-600 text-xl mr-3"></i>
       <div>
         <p class="font-semibold text-gray-800">Active Filters</p>
-        <p class="text-sm text-gray-600">
+        <p class="text-sm " style="color: var(--text-secondary);">
           {% if selected_file_ids %}
-            {{ selected_file_ids|length }} file(s) selected
+          {{ selected_file_ids|length }} file(s) selected
           {% else %}
-            All files
+          All files
           {% endif %}
           |
           {% if selected_currencies %}
-            {{ selected_currencies|join:", " }}
+          {{ selected_currencies|join:", " }}
           {% else %}
-            All currencies
+          All currencies
           {% endif %}
         </p>
       </div>
     </div>
-    <a
-      href="{% url 'settings' %}"
-      class="bg-white hover:bg-gray-50 text-indigo-700 px-4 py-2 rounded-lg font-semibold transition duration-200 flex items-center space-x-2 shadow-sm border border-indigo-200"
-    >
+    <a href="{% url 'settings' %}" class="bg-white hover:style=" background-color: var(--bg-secondary);" text-indigo-700
+      px-4 py-2 rounded-lg font-semibold transition duration-200 flex items-center space-x-2 shadow-sm border
+      border-indigo-200">
       <i class="bi bi-gear-fill"></i>
       <span>Change Filters</span>
     </a>
@@ -67,13 +64,9 @@ function setTimeFilter(period) {
 <!-- Chart and Category Filter Section -->
 <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
   <!-- Chart -->
-  <div
-    class="lg:col-span-2 bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition duration-300"
-  >
-    <div
-      class="bg-gradient-to-r from-red-500 to-pink-600 px-4 py-3 -mx-6 -mt-6 mb-6 rounded-t-xl"
-    >
-      <h2 class="text-xl font-bold text-white flex items-center">
+  <div class="lg:col-span-2 bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition duration-300">
+    <div class="bg-gradient-to-r from-red-500 to-pink-600 px-4 py-3 -mx-6 -mt-6 mb-6 rounded-t-xl">
+      <h2 class="chart-title">
         <i class="bi bi-graph-up mr-2"></i>
         Spending Overview
       </h2>
@@ -84,33 +77,22 @@ function setTimeFilter(period) {
   </div>
 
   <!-- Category Filters -->
-  <div
-    class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300"
-  >
-    <div class="bg-gradient-to-r from-green-500 to-emerald-600 px-6 py-4">
-      <h2 class="text-xl font-bold text-white flex items-center">
+  <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300">
+    <div class="chart-header">
+      <h2 class="chart-title">
         <i class="bi bi-tags-fill mr-2"></i>
         Show Categories
       </h2>
     </div>
     <div class="p-6 max-h-[400px] overflow-y-auto" id="category-checkboxes">
       {% for category, total in filtered_category_totals.items %}
-      <label
-        class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition duration-200 mb-2"
-      >
-        <input
-          class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 category-filter"
-          type="checkbox"
-          value="{{ category }}"
-          id="cat-{{ forloop.counter }}"
-          checked
-        />
-        <span class="ml-3 text-sm font-medium text-gray-900"
-          >{{ category }}</span
-        >
-        <span class="ml-auto text-xs font-semibold text-gray-600"
-          >{{ total|floatformat:2 }}</span
-        >
+      <label class="flex items-center p-3 style=" background-color: var(--bg-secondary);" rounded-lg hover:bg-gray-100
+        cursor-pointer transition duration-200 mb-2">
+        <input class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 category-filter"
+          type="checkbox" value="{{ category }}" id="cat-{{ forloop.counter }}" checked />
+        <span class="ml-3 text-sm font-medium " style="color: var(--text-primary);">{{ category }}</span>
+        <span class="ml-auto text-xs font-semibold " style="color: var(--text-secondary);">{{ total|floatformat:2
+          }}</span>
       </label>
       {% endfor %}
     </div>
@@ -118,12 +100,10 @@ function setTimeFilter(period) {
 </div>
 
 <!-- Category Totals Table -->
-<div class="bg-white rounded-xl shadow-md overflow-hidden mb-6">
-  <button
-    onclick="toggleSection('totals')"
-    class="w-full bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-amber-600 hover:to-orange-600 transition duration-200"
-  >
-    <h2 class="text-xl font-bold text-white flex items-center">
+<div class="chart-container">
+  <button onclick="toggleSection('totals')"
+    class="w-full bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-amber-600 hover:to-orange-600 transition duration-200">
+    <h2 class="chart-title">
       <i class="bi bi-list-ul mr-2"></i>
       Category Totals
     </h2>
@@ -131,40 +111,30 @@ function setTimeFilter(period) {
   </button>
   <div id="totals-content" class="p-6">
     <div class="overflow-x-auto">
-      <table
-        class="min-w-full divide-y divide-gray-200"
-        id="category-totals-table"
-      >
+      <table class="min-w-full divide-y divide-gray-200" id="category-totals-table">
         <thead>
-          <tr class="bg-gray-50">
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+          <tr class="style=" background-color: var(--bg-secondary);"">
+            <th class="px-6 py-3 text-left text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Category
             </th>
-            <th
-              class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-right text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Total Amount
             </th>
           </tr>
         </thead>
         <tbody class="bg-white divide-y divide-gray-200">
           {% for category, total in filtered_category_totals.items %}
-          <tr
-            data-category="{{ category }}"
-            class="hover:bg-gray-50 transition duration-200"
-          >
+          <tr data-category="{{ category }}" class="hover:style=" background-color: var(--bg-secondary);" transition
+            duration-200">
             <td class="px-6 py-4 whitespace-nowrap">
               <span
-                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-800"
-              >
+                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-800">
                 {{ category }}
               </span>
             </td>
-            <td
-              class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-gray-900"
-            >
+            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold " style="color: var(--text-primary);">
               {{ total|floatformat:2 }} CHF
             </td>
           </tr>
@@ -176,83 +146,65 @@ function setTimeFilter(period) {
 </div>
 
 <!-- Transactions Table -->
-<div class="bg-white rounded-xl shadow-md overflow-hidden">
-  <button
-    onclick="toggleSection('transactions')"
-    class="w-full bg-gradient-to-r from-purple-500 to-pink-600 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-purple-600 hover:to-pink-700 transition duration-200"
-  >
-    <h2 class="text-xl font-bold text-white flex items-center">
+<div class="chart-container">
+  <button onclick="toggleSection('transactions')"
+    class="w-full bg-gradient-to-r from-purple-500 to-pink-600 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-purple-600 hover:to-pink-700 transition duration-200">
+    <h2 class="chart-title">
       <i class="bi bi-receipt mr-2"></i>
       Transaction Details
     </h2>
-    <i
-      class="bi bi-chevron-right text-white text-xl"
-      id="transactions-icon"
-    ></i>
+    <i class="bi bi-chevron-right text-white text-xl" id="transactions-icon"></i>
   </button>
   <div id="transactions-content" class="p-6 hidden">
     <div class="overflow-x-auto">
-      <table
-        class="min-w-full divide-y divide-gray-200"
-        id="transactions-table"
-      >
+      <table class="min-w-full divide-y divide-gray-200" id="transactions-table">
         <thead>
-          <tr class="bg-gray-50">
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+          <tr class="style=" background-color: var(--bg-secondary);"">
+            <th class="px-6 py-3 text-left text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Date
             </th>
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-left text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Description
             </th>
-            <th
-              class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-right text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Amount
             </th>
-            <th
-              class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-center text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Currency
             </th>
-            <th
-              class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-center text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Category
             </th>
           </tr>
         </thead>
         <tbody class="bg-white divide-y divide-gray-200">
           {% for tx in transactions %} {% if tx.Category != 'Uncounted' %}
-          <tr
-            data-category="{{ tx.Category }}"
-            class="hover:bg-gray-50 transition duration-200"
-          >
-            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
+          <tr data-category="{{ tx.Category }}" class="hover:style=" background-color: var(--bg-secondary);" transition
+            duration-200">
+            <td class="px-6 py-4 whitespace-nowrap text-sm " style="color: var(--text-muted);">
               {{ tx.Date }}
             </td>
-            <td class="px-6 py-4 text-sm text-gray-900">
+            <td class="px-6 py-4 text-sm " style="color: var(--text-primary);">
               {{ tx.Booking_text }}
             </td>
-            <td
-              class="px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-gray-900"
-            >
+            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-semibold "
+              style="color: var(--text-primary);">
               {{ tx.Amount|floatformat:2 }}
             </td>
             <td class="px-6 py-4 whitespace-nowrap text-center">
               <span
-                class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800"
-                >{{ tx.Currency }}</span
-              >
+                class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800">{{
+                tx.Currency }}</span>
             </td>
             <td class="px-6 py-4 whitespace-nowrap text-center">
               <span
-                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800"
-                >{{ tx.Category }}</span
-              >
+                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800">{{
+                tx.Category }}</span>
             </td>
           </tr>
           {% endif %} {% endfor %}
@@ -269,7 +221,7 @@ function setTimeFilter(period) {
   function toggleCustomDateRange() {
     const customInputs = document.getElementById('customDateInputs');
     const isHidden = customInputs.classList.contains('hidden');
-    
+
     if (isHidden) {
       customInputs.classList.remove('hidden');
       // Update button style
@@ -285,17 +237,17 @@ function setTimeFilter(period) {
   function applyCustomDateRange() {
     const startDate = document.getElementById('startDate').value;
     const endDate = document.getElementById('endDate').value;
-    
+
     if (!startDate || !endDate) {
       alert('Please select both start and end dates');
       return;
     }
-    
+
     // Set session storage
     sessionStorage.setItem('timeFilter', 'custom');
     sessionStorage.setItem('customStartDate', startDate);
     sessionStorage.setItem('customEndDate', endDate);
-    
+
     // Load data dynamically with custom dates
     loadExpensesData('?time_filter=custom&start_date=' + startDate + '&end_date=' + endDate);
   }
@@ -303,10 +255,10 @@ function setTimeFilter(period) {
   // Dynamic data loading function
   function loadExpensesData(queryParams) {
     console.log('loadExpensesData called with:', queryParams);
-    
+
     const url = '/api/expenses-by-category-data/' + queryParams;
     console.log('Fetching URL:', url);
-    
+
     fetch(url)
       .then(response => {
         console.log('Response status:', response.status);
@@ -343,20 +295,20 @@ function setTimeFilter(period) {
   }
 
   // Initialize filter on page load
-  document.addEventListener('DOMContentLoaded', function() {
+  document.addEventListener('DOMContentLoaded', function () {
     // Check URL parameters first
     const urlParams = new URLSearchParams(window.location.search);
     const urlTimeFilter = urlParams.get('time_filter');
     const urlStartDate = urlParams.get('start_date');
     const urlEndDate = urlParams.get('end_date');
-    
+
     let activeFilter = urlTimeFilter || sessionStorage.getItem('timeFilter') || 'all';
-    
+
     // Update button styles
     document.querySelectorAll('.time-filter-btn').forEach(btn => {
       btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
     });
-    
+
     if (activeFilter === 'custom') {
       const startDate = urlStartDate || sessionStorage.getItem('customStartDate');
       const endDate = urlEndDate || sessionStorage.getItem('customEndDate');
@@ -365,7 +317,7 @@ function setTimeFilter(period) {
         document.getElementById('endDate').value = endDate;
         document.getElementById('customDateInputs').classList.remove('hidden');
         document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-        
+
         // Save to session storage
         sessionStorage.setItem('customStartDate', startDate);
         sessionStorage.setItem('customEndDate', endDate);
@@ -373,7 +325,7 @@ function setTimeFilter(period) {
     } else {
       document.getElementById('filter-' + activeFilter).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
     }
-    
+
     // Save active filter to session
     sessionStorage.setItem('timeFilter', activeFilter);
   });
@@ -518,58 +470,37 @@ function setTimeFilter(period) {
 <!-- Compact Time Filter (Bottom Right) -->
 <div class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-3 border border-gray-200 z-40">
   <div class="flex flex-col gap-2">
-    <div class="text-xs font-semibold text-gray-600 mb-1">
+    <div class="text-xs font-semibold  mb-1" style="color: var(--text-secondary);">
       <i class="bi bi-calendar-range text-indigo-600"></i> Time Period
     </div>
-    
+
     <div class="flex flex-col gap-1">
-      <button
-        type="button"
-        onclick="setTimeFilter('all')"
-        id="filter-all"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white"
-      >
+      <button type="button" onclick="setTimeFilter('all')" id="filter-all"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white">
         All Time
       </button>
-      <button
-        type="button"
-        onclick="setTimeFilter('last_year')"
-        id="filter-last_year"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
+      <button type="button" onclick="setTimeFilter('last_year')" id="filter-last_year"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
         Last Year
       </button>
-      <button
-        type="button"
-        onclick="toggleCustomDateRange()"
-        id="filter-custom"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
+      <button type="button" onclick="toggleCustomDateRange()" id="filter-custom"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
         Custom
       </button>
     </div>
 
     <!-- Custom Date Range Inputs (Hidden by default) -->
     <div id="customDateInputs" class="hidden mt-2 space-y-2">
-      <input
-        type="date"
-        id="startDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <input
-        type="date"
-        id="endDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <button
-        type="button"
-        onclick="applyCustomDateRange()"
-        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium transition duration-200"
-      >
+      <input type="date" id="startDate"
+        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
+      <input type="date" id="endDate"
+        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
+      <button type="button" onclick="applyCustomDateRange()"
+        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium transition duration-200">
         Apply
       </button>
     </div>
   </div>
 </div>
 
-{% endblock %}
+{% endblock %}
\ No newline at end of file
diff --git a/faster/templates/dashboard/expenses_vs_income.html b/faster/templates/dashboard/expenses_vs_income.html
index 99a632f..c80d75e 100644
--- a/faster/templates/dashboard/expenses_vs_income.html
+++ b/faster/templates/dashboard/expenses_vs_income.html
@@ -1,324 +1,293 @@
-{% extends "base.html" %} {% block content %}
+{% extends "base.html" %}
+{% load humanize %}
+
+{% block content %}
+<!-- Plotly.js -->
+<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
 
 <!-- Header -->
 <div class="mb-8">
   <h1 class="text-4xl font-bold text-gray-900 mb-2">
-    <i class="bi bi-graph-up-arrow text-green-600"></i>
-    Expenses vs Income
+    <i class="bi bi-graph-up-arrow text-indigo-600"></i>
+    Analytics Dashboard
   </h1>
-  <p class="text-gray-600">Compare your expenses and income over time</p>
+  <p class="text-gray-600">Deep dive into your cash flow, spending habits, and recurring expenses.</p>
 </div>
 
-<script>
-function setTimeFilter(period) {
-    // Update UI
-    document.querySelectorAll('.time-filter-btn').forEach(btn => {
-      btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
-    });
-    document.getElementById('filter-' + period).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-    
-    // Hide custom inputs
-    document.getElementById('customDateInputs').classList.add('hidden');
-    
-    // Set session storage
-    sessionStorage.setItem('timeFilter', period);
-    sessionStorage.removeItem('customStartDate');
-    sessionStorage.removeItem('customEndDate');
-    
-    // Load data dynamically instead of page reload
-    loadExpensesVsIncomeData('?time_filter=' + period);
-  }
-</script>
-
 <!-- Active Filters Banner -->
-<div
-  class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-indigo-500 p-4 mb-6 rounded-lg shadow-sm"
->
-  <div class="flex items-center justify-between">
-    <div class="flex items-center">
-      <i class="bi bi-funnel-fill text-indigo-600 text-xl mr-3"></i>
-      <div>
-        <p class="font-semibold text-gray-800">Active Filters</p>
-        <p class="text-sm text-gray-600">
-          {% if selected_file_ids %}
-            {{ selected_file_ids|length }} file(s) selected
-          {% else %}
-            All files
-          {% endif %}
-          |
-          {% if selected_currencies %}
-            {{ selected_currencies|join:", " }}
-          {% else %}
-            All currencies
-          {% endif %}
-        </p>
-      </div>
+<div class="bg-white border-l-4 border-indigo-500 p-4 mb-8 rounded-lg shadow-sm flex items-center justify-between">
+  <div class="flex items-center">
+    <i class="bi bi-funnel-fill text-indigo-600 text-xl mr-3"></i>
+    <div>
+      <p class="font-semibold text-gray-800">Active Filters</p>
+      <p class="text-sm text-gray-600">
+        {% if selected_file_ids %}
+        {{ selected_file_ids|length }} file(s) selected
+        {% else %}
+        All files
+        {% endif %}
+        |
+        {% if selected_currencies %}
+        {{ selected_currencies|join:", " }}
+        {% else %}
+        All currencies
+        {% endif %}
+      </p>
     </div>
-    <a
-      href="{% url 'settings' %}"
-      class="bg-white hover:bg-gray-50 text-indigo-700 px-4 py-2 rounded-lg font-semibold transition duration-200 flex items-center space-x-2 shadow-sm border border-indigo-200"
-    >
-      <i class="bi bi-gear-fill"></i>
-      <span>Change Filters</span>
-    </a>
   </div>
+  <a href="{% url 'settings' %}" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm">
+    Change Filters &rarr;
+  </a>
 </div>
 
-<!-- Chart and Category Filter Section -->
-<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
-  <!-- Chart -->
-  <div
-    class="lg:col-span-2 bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition duration-300"
-  >
-    <div
-      class="bg-gradient-to-r from-emerald-500 to-teal-600 px-4 py-3 -mx-6 -mt-6 mb-6 rounded-t-xl"
-    >
+<!-- Main Grid -->
+<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
+
+  <!-- Sankey Diagram (Cash Flow) -->
+  <div class="lg:col-span-2 bg-white rounded-xl shadow-md overflow-hidden">
+    <div class="bg-gradient-to-r from-emerald-500 to-teal-600 px-6 py-4">
       <h2 class="text-xl font-bold text-white flex items-center">
-        <i class="bi bi-bar-chart-line-fill mr-2"></i>
-        Income vs Expenses Comparison
+        <i class="bi bi-diagram-3-fill mr-2"></i>
+        Cash Flow Visualization
       </h2>
     </div>
-    <div class="relative" style="height: 400px">
-      <canvas id="incomeExpenseChart"></canvas>
+    <div class="p-4">
+      <div id="sankey-chart" class="w-full h-[500px]"></div>
+      <p class="text-xs text-gray-500 text-center mt-2">
+        Visualizes the flow from Income Sources &rarr; Budget &rarr; Expenses & Savings
+      </p>
     </div>
   </div>
 
-  <!-- Category Filters -->
-  <div
-    class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300"
-  >
-    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4">
+  <!-- Subscription Tracker -->
+  <div class="bg-white rounded-xl shadow-md overflow-hidden flex flex-col">
+    <div class="bg-gradient-to-r from-purple-500 to-indigo-600 px-6 py-4">
       <h2 class="text-xl font-bold text-white flex items-center">
-        <i class="bi bi-tags-fill mr-2"></i>
-        Show Categories
+        <i class="bi bi-arrow-repeat mr-2"></i>
+        Recurring Expenses
       </h2>
     </div>
-    <div class="p-6 max-h-[400px] overflow-y-auto" id="category-checkboxes">
-      {% for category, total in filtered_category_totals.items %}
-      <label
-        class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition duration-200 mb-2"
-      >
-        <input
-          class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 category-filter"
-          type="checkbox"
-          value="{{ category }}"
-          id="cat-{{ forloop.counter }}"
-          checked
-        />
-        <span class="ml-3 text-sm font-medium text-gray-900"
-          >{{ category }}</span
-        >
-        <span
-          class="ml-auto text-xs font-semibold {% if total < 0 %}text-red-600{% else %}text-green-600{% endif %}"
-        >
-          {{ total|floatformat:2 }}
-        </span>
-      </label>
-      {% endfor %}
+    <div class="p-0 flex-1 overflow-y-auto max-h-[500px]">
+      {% if subscriptions %}
+      <div class="divide-y divide-gray-100">
+        {% for sub in subscriptions %}
+        <div class="p-4 hover:bg-gray-50 transition">
+          <div class="flex justify-between items-start">
+            <div>
+              <h3 class="font-semibold text-gray-800 text-sm">{{ sub.name|truncatechars:25 }}</h3>
+              <p class="text-xs text-gray-500">{{ sub.count }} payments detected</p>
+            </div>
+            <div class="text-right">
+              <p class="font-bold text-gray-900">CHF {{ sub.avg_amount|floatformat:2 }}</p>
+              <p class="text-xs text-gray-400">/ month (est)</p>
+            </div>
+          </div>
+        </div>
+        {% endfor %}
+      </div>
+      {% else %}
+      <div class="p-8 text-center text-gray-500">
+        <i class="bi bi-search text-3xl mb-2 block"></i>
+        No recurring subscriptions detected in this period.
+      </div>
+      {% endif %}
+    </div>
+    <div class="bg-gray-50 p-3 text-center border-t border-gray-100">
+      <p class="text-xs text-gray-500">Based on repeated transactions with similar amounts</p>
     </div>
   </div>
 </div>
 
-<!-- Transactions Table -->
-<div class="bg-white rounded-xl shadow-md overflow-hidden">
-  <button
-    onclick="toggleSection('transactions')"
-    class="w-full bg-gradient-to-r from-purple-500 to-pink-600 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-purple-600 hover:to-pink-700 transition duration-200"
-  >
+<!-- Spending Heatmap -->
+<div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
+  <div class="bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4">
     <h2 class="text-xl font-bold text-white flex items-center">
-      <i class="bi bi-receipt mr-2"></i>
-      All Transactions
+      <i class="bi bi-calendar-week-fill mr-2"></i>
+      Daily Spending Intensity
+    </h2>
+  </div>
+  <div class="p-6">
+    <div id="heatmap-chart" class="w-full h-[250px]"></div>
+  </div>
+</div>
+
+<!-- Transactions Table (Collapsible) -->
+<div class="bg-white rounded-xl shadow-md overflow-hidden mb-24">
+  <button onclick="toggleSection('transactions')"
+    class="w-full bg-gray-100 hover:bg-gray-200 px-6 py-4 flex items-center justify-between transition duration-200">
+    <h2 class="text-lg font-bold text-gray-700 flex items-center">
+      <i class="bi bi-list-ul mr-2"></i>
+      Detailed Transactions List
     </h2>
-    <i class="bi bi-chevron-down text-white text-xl" id="transactions-icon"></i>
+    <i class="bi bi-chevron-right text-gray-600 text-xl" id="transactions-icon"></i>
   </button>
-  <div id="transactions-content" class="p-6">
+  <div id="transactions-content" class="hidden p-0">
     <div class="overflow-x-auto">
-      <table
-        class="min-w-full divide-y divide-gray-200"
-        id="transactions-table"
-      >
-        <thead>
-          <tr class="bg-gray-50">
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
-              Date
-            </th>
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
-              Description
-            </th>
-            <th
-              class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
-              Amount
-            </th>
-            <th
-              class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
-              Currency
-            </th>
-            <th
-              class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
-              Category
-            </th>
+      <table class="min-w-full divide-y divide-gray-200">
+        <thead class="bg-gray-50">
+          <tr>
+            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
+            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
+            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
+            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
           </tr>
         </thead>
         <tbody class="bg-white divide-y divide-gray-200">
-          {% for tx in transactions %} {% if tx.Category != 'Uncounted' %}
-          <tr
-            data-category="{{ tx.Category }}"
-            class="hover:bg-gray-50 transition duration-200"
-          >
-            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
-              {{ tx.Date }}
-            </td>
-            <td class="px-6 py-4 text-sm text-gray-900">
-              {{ tx.Booking_text }}
-            </td>
+          {% for tx in transactions %}
+          <tr class="hover:bg-gray-50">
+            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ tx.Date }}</td>
+            <td class="px-6 py-4 text-sm text-gray-900">{{ tx.Booking_text|truncatechars:50 }}</td>
             <td
-              class="px-6 py-4 whitespace-nowrap text-right text-sm font-semibold {% if tx.Amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
-            >
+              class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold {% if tx.Amount < 0 %}text-red-600{% else %}text-green-600{% endif %}">
               {{ tx.Amount|floatformat:2 }}
             </td>
             <td class="px-6 py-4 whitespace-nowrap text-center">
-              <span
-                class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800"
-                >{{ tx.Currency }}</span
-              >
-            </td>
-            <td class="px-6 py-4 whitespace-nowrap text-center">
-              <span
-                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold {% if tx.Amount < 0 %}bg-red-100 text-red-800{% else %}bg-green-100 text-green-800{% endif %}"
-              >
+              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                 {{ tx.Category }}
               </span>
             </td>
           </tr>
-          {% endif %} {% endfor %}
+          {% endfor %}
         </tbody>
       </table>
     </div>
   </div>
 </div>
 
-<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
+<!-- Time Filter (Fixed Bottom Right) -->
+<div class="fixed bottom-4 right-4 bg-white rounded-lg shadow-xl p-3 border border-gray-200 z-50">
+  <div class="flex flex-col gap-2">
+    <div class="text-xs font-semibold text-gray-600 mb-1">
+      <i class="bi bi-calendar-range text-indigo-600"></i> Time Period
+    </div>
+    <div class="flex flex-col gap-1">
+      <button onclick="setTimeFilter('all')" id="filter-all"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition bg-indigo-600 text-white">All
+        Time</button>
+      <button onclick="setTimeFilter('last_year')" id="filter-last_year"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition bg-gray-200 text-gray-700 hover:bg-gray-300">Last
+        Year</button>
+      <button onclick="toggleCustomDateRange()" id="filter-custom"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition bg-gray-200 text-gray-700 hover:bg-gray-300">Custom</button>
+    </div>
+    <!-- Custom Date Inputs -->
+    <div id="customDateInputs" class="hidden mt-2 space-y-2">
+      <input type="date" id="startDate" class="w-full border border-gray-300 rounded px-2 py-1 text-xs">
+      <input type="date" id="endDate" class="w-full border border-gray-300 rounded px-2 py-1 text-xs">
+      <button onclick="applyCustomDateRange()"
+        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium">Apply</button>
+    </div>
+  </div>
+</div>
+
 <script>
-  // Time Filter Functions are defined at the top of the page
+  // --- Data Injection ---
+  const sankeyData = JSON.parse('{{ sankey_data|safe }}');
+  const heatmapDataRaw = JSON.parse('{{ heatmap_data|safe }}');
 
-  function toggleCustomDateRange() {
-    const customInputs = document.getElementById('customDateInputs');
-    const isHidden = customInputs.classList.contains('hidden');
-    
-    if (isHidden) {
-      customInputs.classList.remove('hidden');
-      // Update button style
-      document.querySelectorAll('.time-filter-btn').forEach(btn => {
-        btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
-      });
-      document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-    } else {
-      customInputs.classList.add('hidden');
-    }
-  }
+  // --- Sankey Chart Initialization ---
+  function initSankey() {
+    const data = {
+      type: "sankey",
+      orientation: "h",
+      node: {
+        pad: 15,
+        thickness: 20,
+        line: { color: "black", width: 0.5 },
+        label: sankeyData.label,
+        color: "rgba(79, 70, 229, 0.8)" // Default node color
+      },
+      link: {
+        source: sankeyData.source,
+        target: sankeyData.target,
+        value: sankeyData.value,
+        color: sankeyData.color
+      }
+    };
 
-  function applyCustomDateRange() {
-    const startDate = document.getElementById('startDate').value;
-    const endDate = document.getElementById('endDate').value;
-    
-    if (!startDate || !endDate) {
-      alert('Please select both start and end dates');
-      return;
-    }
-    
-    // Set session storage
-    sessionStorage.setItem('timeFilter', 'custom');
-    sessionStorage.setItem('customStartDate', startDate);
-    sessionStorage.setItem('customEndDate', endDate);
-    
-    // Load data dynamically with custom dates
-    loadExpensesVsIncomeData('?time_filter=custom&start_date=' + startDate + '&end_date=' + endDate);
-  }
+    const layout = {
+      font: { size: 12, family: "Inter, sans-serif" },
+      margin: { l: 10, r: 10, t: 10, b: 10 },
+      paper_bgcolor: "rgba(0,0,0,0)",
+      plot_bgcolor: "rgba(0,0,0,0)"
+    };
 
-  // Dynamic data loading function
-  function loadExpensesVsIncomeData(queryParams) {
-    console.log('loadExpensesVsIncomeData called with:', queryParams);
-    
-    const url = '/api/expenses-vs-income-data/' + queryParams;
-    console.log('Fetching URL:', url);
-    
-    fetch(url)
-      .then(response => {
-        console.log('Response status:', response.status);
-        return response.json();
-      })
-      .then(data => {
-        console.log('Response data:', data);
-        if (data.success) {
-          updateExpensesVsIncomeChart(data);
-        } else {
-          console.error('Failed to load expenses vs income data:', data.error);
-          alert('Failed to load data. Please try again.');
-        }
-      })
-      .catch(error => {
-        console.error('Error loading expenses vs income data:', error);
-        alert('Network error. Please check your connection and try again.');
-      });
+    Plotly.newPlot('sankey-chart', [data], layout, { displayModeBar: false, responsive: true });
   }
 
-  function updateExpensesVsIncomeChart(data) {
-    if (window.expensesVsIncomeChart && data.chart_data) {
-      window.expensesVsIncomeChart.data.labels = data.chart_data.labels;
-      window.expensesVsIncomeChart.data.datasets[0].data = data.chart_data.expenses;
-      window.expensesVsIncomeChart.data.datasets[1].data = data.chart_data.income;
-      window.expensesVsIncomeChart.update('active');
-    }
-  }
+  // --- Heatmap Initialization ---
+  function initHeatmap() {
+    // Prepare data for Plotly Heatmap (Calendar view approximation)
+    // Since true calendar heatmaps are complex in Plotly, we'll use a standard heatmap
+    // X-axis: Week of Year, Y-axis: Day of Week
 
-  // Initialize filter on page load
-  document.addEventListener('DOMContentLoaded', function() {
-    // Check URL parameters first
-    const urlParams = new URLSearchParams(window.location.search);
-    const urlTimeFilter = urlParams.get('time_filter');
-    const urlStartDate = urlParams.get('start_date');
-    const urlEndDate = urlParams.get('end_date');
-    
-    let activeFilter = urlTimeFilter || sessionStorage.getItem('timeFilter') || 'all';
-    
-    // Update button styles
-    document.querySelectorAll('.time-filter-btn').forEach(btn => {
-      btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
+    const dates = Object.keys(heatmapDataRaw).sort();
+    const zValues = [];
+    const xValues = []; // Week numbers
+    const yValues = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
+
+    // Initialize matrix
+    // We need to map dates to (week, day) coordinates
+    // This is a simplified approach; for a perfect calendar we might need a library like Cal-Heatmap
+    // But let's try a simple scatter plot with color scale first, it might look better and be easier
+
+    const xDates = [];
+    const yDay = []; // Just 1 for 1D strip? No, let's do a bar chart over time?
+    // The user asked for a heatmap.
+    // Let's do a standard heatmap: Month on X, Day of Month on Y?
+
+    // Better approach for "Spending Intensity":
+    // X: Date, Y: "Spending", Color: Amount? No that's a bar chart.
+    // Heatmap: X = Month, Y = Day of Month (1-31), Color = Amount.
+
+    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
+    const days = Array.from({ length: 31 }, (_, i) => i + 1);
+
+    const zMatrix = Array(31).fill().map(() => Array(12).fill(0)); // 31 rows (days), 12 cols (months)
+    // Note: This aggregates all years if multiple years selected.
+
+    dates.forEach(dateStr => {
+      const date = new Date(dateStr);
+      const month = date.getMonth(); // 0-11
+      const day = date.getDate() - 1; // 0-30
+      zMatrix[day][month] += heatmapDataRaw[dateStr];
     });
-    
-    if (activeFilter === 'custom') {
-      const startDate = urlStartDate || sessionStorage.getItem('customStartDate');
-      const endDate = urlEndDate || sessionStorage.getItem('customEndDate');
-      if (startDate && endDate) {
-        document.getElementById('startDate').value = startDate;
-        document.getElementById('endDate').value = endDate;
-        document.getElementById('customDateInputs').classList.remove('hidden');
-        document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-        
-        // Save to session storage
-        sessionStorage.setItem('customStartDate', startDate);
-        sessionStorage.setItem('customEndDate', endDate);
-      }
-    } else {
-      document.getElementById('filter-' + activeFilter).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-    }
-    
-    // Save active filter to session
-    sessionStorage.setItem('timeFilter', activeFilter);
+
+    const data = [{
+      z: zMatrix,
+      x: months,
+      y: days,
+      type: 'heatmap',
+      colorscale: 'Reds',
+      hoverongaps: false,
+      hovertemplate: 'Month: %{x}<br>Day: %{y}<br>Total: CHF %{z:,.2f}<extra></extra>'
+    }];
+
+    const layout = {
+      margin: { l: 50, r: 20, t: 20, b: 50 },
+      yaxis: { title: 'Day of Month', dtick: 2 },
+      xaxis: { title: 'Month' },
+      paper_bgcolor: "rgba(0,0,0,0)",
+      plot_bgcolor: "rgba(0,0,0,0)"
+    };
+
+    Plotly.newPlot('heatmap-chart', data, layout, { displayModeBar: false, responsive: true });
+  }
+
+  // --- Initialization ---
+  document.addEventListener('DOMContentLoaded', function () {
+    initSankey();
+    initHeatmap();
+
+    // Initialize Time Filter UI
+    const activeFilter = sessionStorage.getItem('timeFilter') || 'all';
+    updateTimeFilterUI(activeFilter);
   });
 
-  // Toggle sections
+  // --- Helper Functions ---
   function toggleSection(section) {
     const content = document.getElementById(section + "-content");
     const icon = document.getElementById(section + "-icon");
-
     if (content.classList.contains("hidden")) {
       content.classList.remove("hidden");
       icon.classList.remove("bi-chevron-right");
@@ -330,146 +299,53 @@ function setTimeFilter(period) {
     }
   }
 
-  // Filter table by selected categories
-  document.querySelectorAll(".category-filter").forEach(function (checkbox) {
-    checkbox.addEventListener("change", function () {
-      const checkedCategories = Array.from(
-        document.querySelectorAll(".category-filter:checked")
-      ).map((cb) => cb.value);
-
-      // Update table
-      document
-        .querySelectorAll("#transactions-table tbody tr")
-        .forEach(function (row) {
-          row.style.display = checkedCategories.includes(
-            row.getAttribute("data-category")
-          )
-            ? ""
-            : "none";
-        });
+  function setTimeFilter(period) {
+    sessionStorage.setItem('timeFilter', period);
+    sessionStorage.removeItem('customStartDate');
+    sessionStorage.removeItem('customEndDate');
+    window.location.href = '?time_filter=' + period;
+  }
+
+  function updateTimeFilterUI(filter) {
+    document.querySelectorAll('.time-filter-btn').forEach(btn => {
+      btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition bg-gray-200 text-gray-700 hover:bg-gray-300';
     });
-  });
 
-  // Chart.js setup
-  const chartData = JSON.parse("{{ chart_data|safe|escapejs }}");
-  const ctx = document.getElementById("incomeExpenseChart").getContext("2d");
-
-  window.expensesVsIncomeChart = new Chart(ctx, {
-    type: "bar",
-    data: {
-      labels: chartData.labels,
-      datasets: [
-        {
-          label: "Amount",
-          data: chartData.amounts,
-          backgroundColor: [
-            "rgba(239, 68, 68, 0.7)", // Red for expenses
-            "rgba(34, 197, 94, 0.7)", // Green for income
-          ],
-          borderColor: ["rgba(239, 68, 68, 1)", "rgba(34, 197, 94, 1)"],
-          borderWidth: 2,
-          borderRadius: 8,
-        },
-      ],
-    },
-    options: {
-      responsive: true,
-      maintainAspectRatio: false,
-      plugins: {
-        legend: { display: false },
-        tooltip: {
-          backgroundColor: "rgba(0, 0, 0, 0.8)",
-          padding: 12,
-          titleFont: { size: 14, weight: "bold" },
-          bodyFont: { size: 13 },
-          callbacks: {
-            label: function (context) {
-              return (
-                context.label +
-                ": " +
-                Math.abs(context.parsed.y).toFixed(2) +
-                " CHF"
-              );
-            },
-          },
-        },
-      },
-      scales: {
-        y: {
-          grid: {
-            color: "rgba(0, 0, 0, 0.05)",
-          },
-          ticks: {
-            callback: function (value) {
-              return value.toFixed(0) + " CHF";
-            },
-          },
-        },
-        x: {
-          grid: {
-            display: false,
-          },
-        },
-      },
-    },
-  });
-</script>
+    if (filter === 'custom') {
+      document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition bg-indigo-600 text-white';
+      document.getElementById('customDateInputs').classList.remove('hidden');
 
-<!-- Compact Time Filter (Bottom Right) -->
-<div class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-3 border border-gray-200 z-40">
-  <div class="flex flex-col gap-2">
-    <div class="text-xs font-semibold text-gray-600 mb-1">
-      <i class="bi bi-calendar-range text-indigo-600"></i> Time Period
-    </div>
-    
-    <div class="flex flex-col gap-1">
-      <button
-        type="button"
-        onclick="setTimeFilter('all')"
-        id="filter-all"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white"
-      >
-        All Time
-      </button>
-      <button
-        type="button"
-        onclick="setTimeFilter('last_year')"
-        id="filter-last_year"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
-        Last Year
-      </button>
-      <button
-        type="button"
-        onclick="toggleCustomDateRange()"
-        id="filter-custom"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
-        Custom
-      </button>
-    </div>
+      const start = sessionStorage.getItem('customStartDate');
+      const end = sessionStorage.getItem('customEndDate');
+      if (start) document.getElementById('startDate').value = start;
+      if (end) document.getElementById('endDate').value = end;
+    } else {
+      const btn = document.getElementById('filter-' + filter);
+      if (btn) btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition bg-indigo-600 text-white';
+    }
+  }
 
-    <!-- Custom Date Range Inputs (Hidden by default) -->
-    <div id="customDateInputs" class="hidden mt-2 space-y-2">
-      <input
-        type="date"
-        id="startDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <input
-        type="date"
-        id="endDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <button
-        type="button"
-        onclick="applyCustomDateRange()"
-        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium transition duration-200"
-      >
-        Apply
-      </button>
-    </div>
-  </div>
-</div>
+  function toggleCustomDateRange() {
+    const inputs = document.getElementById('customDateInputs');
+    if (inputs.classList.contains('hidden')) {
+      inputs.classList.remove('hidden');
+      updateTimeFilterUI('custom'); // Visually select custom
+    } else {
+      inputs.classList.add('hidden');
+    }
+  }
 
-{% endblock %}
+  function applyCustomDateRange() {
+    const start = document.getElementById('startDate').value;
+    const end = document.getElementById('endDate').value;
+    if (!start || !end) {
+      alert('Please select both dates');
+      return;
+    }
+    sessionStorage.setItem('timeFilter', 'custom');
+    sessionStorage.setItem('customStartDate', start);
+    sessionStorage.setItem('customEndDate', end);
+    window.location.href = `?time_filter=custom&start_date=${start}&end_date=${end}`;
+  }
+</script>
+{% endblock %}
\ No newline at end of file
diff --git a/faster/templates/dashboard/income_by_category.html b/faster/templates/dashboard/income_by_category.html
index 9af4d9f..c597970 100644
--- a/faster/templates/dashboard/income_by_category.html
+++ b/faster/templates/dashboard/income_by_category.html
@@ -2,62 +2,58 @@
 
 <!-- Header -->
 <div class="mb-8">
-  <h1 class="text-4xl font-bold text-gray-900 mb-2">
+  <h1 class="text-4xl font-bold  mb-2" style="color: var(--text-primary);">
     <i class="bi bi-cash-stack text-green-600"></i>
     Income by Category
   </h1>
-  <p class="text-gray-600">Track your income sources and analyze earning patterns</p>
+  <p class="" style="color: var(--text-secondary);">Track your income sources and analyze earning patterns</p>
 </div>
 
 <script>
-function setTimeFilter(period) {
+  function setTimeFilter(period) {
     // Update UI
     document.querySelectorAll('.time-filter-btn').forEach(btn => {
       btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
     });
     document.getElementById('filter-' + period).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-    
+
     // Hide custom inputs
     document.getElementById('customDateInputs').classList.add('hidden');
-    
+
     // Set session storage
     sessionStorage.setItem('timeFilter', period);
     sessionStorage.removeItem('customStartDate');
     sessionStorage.removeItem('customEndDate');
-    
+
     // Load data dynamically instead of page reload
     loadIncomeData('?time_filter=' + period);
   }
 </script>
 
 <!-- Active Filters Banner -->
-<div
-  class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-indigo-500 p-4 mb-6 rounded-lg shadow-sm"
->
+<div class="chart-header">
   <div class="flex items-center justify-between">
     <div class="flex items-center">
       <i class="bi bi-funnel-fill text-indigo-600 text-xl mr-3"></i>
       <div>
         <p class="font-semibold text-gray-800">Active Filters</p>
-        <p class="text-sm text-gray-600">
+        <p class="text-sm " style="color: var(--text-secondary);">
           {% if selected_file_ids %}
-            {{ selected_file_ids|length }} file(s) selected
+          {{ selected_file_ids|length }} file(s) selected
           {% else %}
-            All files
+          All files
           {% endif %}
           |
           {% if selected_currencies %}
-            {{ selected_currencies|join:", " }}
+          {{ selected_currencies|join:", " }}
           {% else %}
-            All currencies
+          All currencies
           {% endif %}
         </p>
       </div>
     </div>
-    <a
-      href="{% url 'settings' %}"
-      class="bg-white hover:bg-gray-50 text-indigo-700 px-4 py-2 rounded-lg font-semibold transition duration-200 flex items-center space-x-2 shadow-sm border border-indigo-200"
-    >
+    <a href="{% url 'settings' %}"
+      class="bg-white hover:bg-gray-100 text-indigo-700 px-4 py-2 rounded-lg font-semibold transition duration-200 flex items-center space-x-2 shadow-sm border border-indigo-200">
       <i class="bi bi-gear-fill"></i>
       <span>Change Filters</span>
     </a>
@@ -67,13 +63,9 @@ function setTimeFilter(period) {
 <!-- Chart and Category Filter Section -->
 <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
   <!-- Chart -->
-  <div
-    class="lg:col-span-2 bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition duration-300"
-  >
-    <div
-      class="bg-gradient-to-r from-green-500 to-emerald-600 px-4 py-3 -mx-6 -mt-6 mb-6 rounded-t-xl"
-    >
-      <h2 class="text-xl font-bold text-white flex items-center">
+  <div class="chart-container">
+    <div class="chart-header">
+      <h2 class="chart-title">
         <i class="bi bi-graph-up mr-2"></i>
         Income Overview
       </h2>
@@ -84,33 +76,21 @@ function setTimeFilter(period) {
   </div>
 
   <!-- Category Filters -->
-  <div
-    class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300"
-  >
-    <div class="bg-gradient-to-r from-teal-500 to-cyan-600 px-6 py-4">
-      <h2 class="text-xl font-bold text-white flex items-center">
+  <div class="chart-container">
+    <div class="chart-header">
+      <h2 class="chart-title">
         <i class="bi bi-tags-fill mr-2"></i>
         Show Categories
       </h2>
     </div>
     <div class="p-6 max-h-[400px] overflow-y-auto" id="category-checkboxes">
       {% for category, total in filtered_category_totals.items %}
-      <label
-        class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition duration-200 mb-2"
-      >
-        <input
-          class="w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 rounded focus:ring-teal-500 category-filter"
-          type="checkbox"
-          value="{{ category }}"
-          id="cat-{{ forloop.counter }}"
-          checked
-        />
-        <span class="ml-3 text-sm font-medium text-gray-900"
-          >{{ category }}</span
-        >
-        <span class="ml-auto text-xs font-semibold text-green-600"
-          >{{ total|floatformat:2 }}</span
-        >
+      <label class="flex items-center p-3  rounded-lg hover:bg-gray-100 cursor-pointer transition duration-200 mb-2"
+        style="background-color: var(--bg-secondary);">
+        <input class="w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 rounded focus:ring-teal-500 category-filter"
+          type="checkbox" value="{{ category }}" id="cat-{{ forloop.counter }}" checked />
+        <span class="ml-3 text-sm font-medium " style="color: var(--text-primary);">{{ category }}</span>
+        <span class="ml-auto text-xs font-semibold text-green-600">{{ total|floatformat:2 }}</span>
       </label>
       {% endfor %}
     </div>
@@ -118,12 +98,10 @@ function setTimeFilter(period) {
 </div>
 
 <!-- Category Totals Table -->
-<div class="bg-white rounded-xl shadow-md overflow-hidden mb-6">
-  <button
-    onclick="toggleSection('totals')"
-    class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-emerald-600 hover:to-teal-600 transition duration-200"
-  >
-    <h2 class="text-xl font-bold text-white flex items-center">
+<div class="chart-container">
+  <button onclick="toggleSection('totals')"
+    class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-emerald-600 hover:to-teal-600 transition duration-200">
+    <h2 class="chart-title">
       <i class="bi bi-list-ul mr-2"></i>
       Category Totals
     </h2>
@@ -131,40 +109,30 @@ function setTimeFilter(period) {
   </button>
   <div id="totals-content" class="p-6">
     <div class="overflow-x-auto">
-      <table
-        class="min-w-full divide-y divide-gray-200"
-        id="category-totals-table"
-      >
+      <table class="min-w-full divide-y divide-gray-200" id="category-totals-table">
         <thead>
-          <tr class="bg-gray-50">
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+          <tr style="background-color: var(--bg-secondary);">
+            <th class="px-6 py-3 text-left text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Category
             </th>
-            <th
-              class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-right text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Total Amount
             </th>
           </tr>
         </thead>
         <tbody class="bg-white divide-y divide-gray-200">
           {% for category, total in filtered_category_totals.items %}
-          <tr
-            data-category="{{ category }}"
-            class="hover:bg-gray-50 transition duration-200"
-          >
+          <tr data-category="{{ category }}" class="hover:bg-opacity-10"
+            style="background-color: var(--bg-secondary); transition duration-200">
             <td class="px-6 py-4 whitespace-nowrap">
               <span
-                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800"
-              >
+                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                 {{ category }}
               </span>
             </td>
-            <td
-              class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-green-600"
-            >
+            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-green-600">
               {{ total|floatformat:2 }} CHF
             </td>
           </tr>
@@ -176,83 +144,64 @@ function setTimeFilter(period) {
 </div>
 
 <!-- Transactions Table -->
-<div class="bg-white rounded-xl shadow-md overflow-hidden">
-  <button
-    onclick="toggleSection('transactions')"
-    class="w-full bg-gradient-to-r from-teal-500 to-cyan-600 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-teal-600 hover:to-cyan-700 transition duration-200"
-  >
-    <h2 class="text-xl font-bold text-white flex items-center">
+<div class="chart-container">
+  <button onclick="toggleSection('transactions')"
+    class="w-full bg-gradient-to-r from-teal-500 to-cyan-600 px-6 py-4 flex items-center justify-between cursor-pointer hover:from-teal-600 hover:to-cyan-700 transition duration-200">
+    <h2 class="chart-title">
       <i class="bi bi-receipt mr-2"></i>
       Transaction Details
     </h2>
-    <i
-      class="bi bi-chevron-right text-white text-xl"
-      id="transactions-icon"
-    ></i>
+    <i class="bi bi-chevron-right text-white text-xl" id="transactions-icon"></i>
   </button>
   <div id="transactions-content" class="p-6 hidden">
     <div class="overflow-x-auto">
-      <table
-        class="min-w-full divide-y divide-gray-200"
-        id="transactions-table"
-      >
+      <table class="min-w-full divide-y divide-gray-200" id="transactions-table">
         <thead>
-          <tr class="bg-gray-50">
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+          <tr style="background-color: var(--bg-secondary);">
+            <th class="px-6 py-3 text-left text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Date
             </th>
-            <th
-              class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-left text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Description
             </th>
-            <th
-              class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-right text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Amount
             </th>
-            <th
-              class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-center text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Currency
             </th>
-            <th
-              class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"
-            >
+            <th class="px-6 py-3 text-center text-xs font-semibold  uppercase tracking-wider"
+              style="color: var(--text-secondary);">
               Category
             </th>
           </tr>
         </thead>
         <tbody class="bg-white divide-y divide-gray-200">
           {% for tx in transactions %} {% if tx.Category != 'Uncounted' %}
-          <tr
-            data-category="{{ tx.Category }}"
-            class="hover:bg-gray-50 transition duration-200"
-          >
-            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
+          <tr data-category="{{ tx.Category }}" class="hover:bg-opacity-10"
+            style="background-color: var(--bg-secondary); transition duration-200">
+            <td class="px-6 py-4 whitespace-nowrap text-sm " style="color: var(--text-muted);">
               {{ tx.Date }}
             </td>
-            <td class="px-6 py-4 text-sm text-gray-900">
+            <td class="px-6 py-4 text-sm " style="color: var(--text-primary);">
               {{ tx.Booking_text }}
             </td>
-            <td
-              class="px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-green-600"
-            >
+            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-green-600">
               {{ tx.Amount|floatformat:2 }}
             </td>
             <td class="px-6 py-4 whitespace-nowrap text-center">
               <span
-                class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800"
-                >{{ tx.Currency }}</span
-              >
+                class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800">{{
+                tx.Currency }}</span>
             </td>
             <td class="px-6 py-4 whitespace-nowrap text-center">
               <span
-                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800"
-                >{{ tx.Category }}</span
-              >
+                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">{{
+                tx.Category }}</span>
             </td>
           </tr>
           {% endif %} {% endfor %}
@@ -269,7 +218,7 @@ function setTimeFilter(period) {
   function toggleCustomDateRange() {
     const customInputs = document.getElementById('customDateInputs');
     const isHidden = customInputs.classList.contains('hidden');
-    
+
     if (isHidden) {
       customInputs.classList.remove('hidden');
       // Update button style
@@ -285,17 +234,17 @@ function setTimeFilter(period) {
   function applyCustomDateRange() {
     const startDate = document.getElementById('startDate').value;
     const endDate = document.getElementById('endDate').value;
-    
+
     if (!startDate || !endDate) {
       alert('Please select both start and end dates');
       return;
     }
-    
+
     // Set session storage
     sessionStorage.setItem('timeFilter', 'custom');
     sessionStorage.setItem('customStartDate', startDate);
     sessionStorage.setItem('customEndDate', endDate);
-    
+
     // Load data dynamically with custom dates
     loadIncomeData('?time_filter=custom&start_date=' + startDate + '&end_date=' + endDate);
   }
@@ -303,10 +252,10 @@ function setTimeFilter(period) {
   // Dynamic data loading function
   function loadIncomeData(queryParams) {
     console.log('loadIncomeData called with:', queryParams);
-    
+
     const url = '/api/income-by-category-data/' + queryParams;
     console.log('Fetching URL:', url);
-    
+
     fetch(url)
       .then(response => {
         console.log('Response status:', response.status);
@@ -336,20 +285,20 @@ function setTimeFilter(period) {
   }
 
   // Initialize filter on page load
-  document.addEventListener('DOMContentLoaded', function() {
+  document.addEventListener('DOMContentLoaded', function () {
     // Check URL parameters first
     const urlParams = new URLSearchParams(window.location.search);
     const urlTimeFilter = urlParams.get('time_filter');
     const urlStartDate = urlParams.get('start_date');
     const urlEndDate = urlParams.get('end_date');
-    
+
     let activeFilter = urlTimeFilter || sessionStorage.getItem('timeFilter') || 'all';
-    
+
     // Update button styles
     document.querySelectorAll('.time-filter-btn').forEach(btn => {
       btn.className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
     });
-    
+
     if (activeFilter === 'custom') {
       const startDate = urlStartDate || sessionStorage.getItem('customStartDate');
       const endDate = urlEndDate || sessionStorage.getItem('customEndDate');
@@ -358,7 +307,7 @@ function setTimeFilter(period) {
         document.getElementById('endDate').value = endDate;
         document.getElementById('customDateInputs').classList.remove('hidden');
         document.getElementById('filter-custom').className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
-        
+
         // Save to session storage
         sessionStorage.setItem('customStartDate', startDate);
         sessionStorage.setItem('customEndDate', endDate);
@@ -366,7 +315,7 @@ function setTimeFilter(period) {
     } else {
       document.getElementById('filter-' + activeFilter).className = 'time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white';
     }
-    
+
     // Save active filter to session
     sessionStorage.setItem('timeFilter', activeFilter);
   });
@@ -519,58 +468,37 @@ function setTimeFilter(period) {
 <!-- Compact Time Filter (Bottom Right) -->
 <div class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-3 border border-gray-200 z-40">
   <div class="flex flex-col gap-2">
-    <div class="text-xs font-semibold text-gray-600 mb-1">
+    <div class="text-xs font-semibold  mb-1" style="color: var(--text-secondary);">
       <i class="bi bi-calendar-range text-indigo-600"></i> Time Period
     </div>
-    
+
     <div class="flex flex-col gap-1">
-      <button
-        type="button"
-        onclick="setTimeFilter('all')"
-        id="filter-all"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white"
-      >
+      <button type="button" onclick="setTimeFilter('all')" id="filter-all"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-indigo-600 text-white">
         All Time
       </button>
-      <button
-        type="button"
-        onclick="setTimeFilter('last_year')"
-        id="filter-last_year"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
+      <button type="button" onclick="setTimeFilter('last_year')" id="filter-last_year"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
         Last Year
       </button>
-      <button
-        type="button"
-        onclick="toggleCustomDateRange()"
-        id="filter-custom"
-        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300"
-      >
+      <button type="button" onclick="toggleCustomDateRange()" id="filter-custom"
+        class="time-filter-btn px-3 py-1.5 rounded text-xs font-medium transition duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
         Custom
       </button>
     </div>
 
     <!-- Custom Date Range Inputs (Hidden by default) -->
     <div id="customDateInputs" class="hidden mt-2 space-y-2">
-      <input
-        type="date"
-        id="startDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <input
-        type="date"
-        id="endDate"
-        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
-      />
-      <button
-        type="button"
-        onclick="applyCustomDateRange()"
-        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium transition duration-200"
-      >
+      <input type="date" id="startDate"
+        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
+      <input type="date" id="endDate"
+        class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
+      <button type="button" onclick="applyCustomDateRange()"
+        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded text-xs font-medium transition duration-200">
         Apply
       </button>
     </div>
   </div>
 </div>
 
-{% endblock %}
+{% endblock %}
\ No newline at end of file
diff --git a/faster/templates/dashboard/monthly_budget.html b/faster/templates/dashboard/monthly_budget.html
index f00649c..0af6be3 100644
--- a/faster/templates/dashboard/monthly_budget.html
+++ b/faster/templates/dashboard/monthly_budget.html
@@ -4,21 +4,21 @@
 {% block content %}
 <!-- Hero Section -->
 <div class="mb-8">
-  <h1 class="text-4xl font-bold text-gray-900 mb-2">
+  <h1 class="text-4xl font-bold  mb-2" style="color: var(--text-primary);">
     <i class="bi bi-calendar-month text-indigo-600"></i>
     Monthly Budget & Trends
   </h1>
-  <p class="text-gray-600">
+  <p class="" style="color: var(--text-secondary);">
     Analyze your spending patterns across categories with historical averages
   </p>
 </div>
 
 <!-- Comparison with Toggle Buttons -->
-<div class="mb-8 bg-white rounded-xl shadow-md p-6">
+<div class="chart-container">
   <div class="flex flex-col gap-4">
     <div>
-      <h3 class="text-lg font-semibold text-gray-900">Compare Against Average</h3>
-      <p class="text-sm text-gray-600 mt-1">Select which month to analyze</p>
+      <h3 class="text-lg font-semibold " style="color: var(--text-primary);">Compare Against Average</h3>
+      <p class="text-sm  mt-1" style="color: var(--text-secondary);">Select which month to analyze</p>
     </div>
     
     <!-- Toggle Buttons -->
@@ -42,14 +42,14 @@
 <!-- Current Month Overview -->
 <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
   <!-- Month Spending Card (Dynamic) -->
-  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500 hover:shadow-xl transition duration-300">
+  <div class="chart-container">
     <div class="flex items-center justify-between">
       <div>
-        <p class="text-sm font-medium text-gray-600 uppercase month-label">This Month's Spending</p>
-        <p class="text-3xl font-bold text-gray-900 mt-2">
-          <span class="month-amount">{{ current_month_total|floatformat:0|intcomma }}</span> <span class="text-xl font-semibold text-gray-500">{{ primary_currency }}</span>
+        <p class="text-sm font-medium  uppercase month-label" style="color: var(--text-secondary);">This Month's Spending</p>
+        <p class="text-3xl font-bold  mt-2" style="color: var(--text-primary);">
+          <span class="month-amount">{{ current_month_total|floatformat:0|intcomma }}</span> <span class="text-xl font-semibold " style="color: var(--text-muted);">{{ primary_currency }}</span>
         </p>
-        <p class="text-xs text-gray-500 mt-1 month-date">{{ current_month }}</p>
+        <p class="text-xs  mt-1 month-date" style="color: var(--text-muted);">{{ current_month }}</p>
       </div>
       <div class="bg-red-100 rounded-full p-3">
         <i class="bi bi-calendar-fill text-red-600 text-2xl"></i>
@@ -58,14 +58,14 @@
   </div>
 
   <!-- Average Monthly Spending -->
-  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500 hover:shadow-xl transition duration-300">
+  <div class="chart-container">
     <div class="flex items-center justify-between">
       <div>
-        <p class="text-sm font-medium text-gray-600 uppercase">Average / Month</p>
-        <p class="text-3xl font-bold text-gray-900 mt-2">
-          {{ average_spending|floatformat:0|intcomma }} <span class="text-xl font-semibold text-gray-500">{{ primary_currency }}</span>
+        <p class="text-sm font-medium  uppercase" style="color: var(--text-secondary);">Average / Month</p>
+        <p class="text-3xl font-bold  mt-2" style="color: var(--text-primary);">
+          {{ average_spending|floatformat:0|intcomma }} <span class="text-xl font-semibold " style="color: var(--text-muted);">{{ primary_currency }}</span>
         </p>
-        <p class="text-xs text-gray-500 mt-1">Across all categories</p>
+        <p class="text-xs  mt-1" style="color: var(--text-muted);">Across all categories</p>
       </div>
       <div class="bg-orange-100 rounded-full p-3">
         <i class="bi bi-graph-up text-orange-600 text-2xl"></i>
@@ -74,14 +74,14 @@
   </div>
 
   <!-- Difference Card (Dynamic) -->
-  <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500 hover:shadow-xl transition duration-300">
+  <div class="chart-container">
     <div class="flex items-center justify-between">
       <div>
-        <p class="text-sm font-medium text-gray-600 uppercase">Difference from Average</p>
+        <p class="text-sm font-medium  uppercase" style="color: var(--text-secondary);">Difference from Average</p>
         <p class="text-3xl font-bold mt-2">
-          <span class="difference-amount text-gray-900">{{ current_month_total|floatformat:0|intcomma }}</span> <span class="text-xl font-semibold text-gray-500">{{ primary_currency }}</span>
+          <span class="difference-amount " style="color: var(--text-primary);">{{ current_month_total|floatformat:0|intcomma }}</span> <span class="text-xl font-semibold " style="color: var(--text-muted);">{{ primary_currency }}</span>
         </p>
-        <p class="text-xs text-gray-500 mt-1 difference-label">Over budget</p>
+        <p class="text-xs  mt-1 difference-label" style="color: var(--text-muted);">Over budget</p>
       </div>
       <div class="difference-icon bg-purple-100 rounded-full p-3">
         <i class="bi bi-arrow-up text-purple-600 text-2xl"></i>
@@ -93,9 +93,9 @@
 <!-- Average Spending by Category Chart -->
 <div class="grid grid-cols-1 lg:grid-cols-1 gap-6 mb-8">
   <!-- Bar Chart -->
-  <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300">
-    <div class="bg-gradient-to-r from-indigo-500 to-blue-500 px-6 py-4">
-      <h2 class="text-xl font-bold text-white flex items-center">
+  <div class="chart-container">
+    <div class="chart-header">
+      <h2 class="chart-title">
         <i class="bi bi-bar-chart-fill mr-2"></i>
         Average Spending by Category
       </h2>
@@ -110,9 +110,9 @@
   </div>
 
 <!-- Detailed Category Statistics Table -->
-<div class="bg-white rounded-xl shadow-md overflow-hidden">
-  <div class="bg-gradient-to-r from-green-500 to-emerald-500 px-6 py-4">
-    <h2 class="text-xl font-bold text-white flex items-center">
+<div class="chart-container">
+  <div class="chart-header">
+    <h2 class="chart-title">
       <i class="bi bi-table mr-2"></i>
       Category Spending Analysis
     </h2>
@@ -120,16 +120,16 @@
   </div>
   <div class="overflow-x-auto">
     <table class="w-full">
-      <thead class="bg-gray-50 border-b border-gray-200">
+      <thead style="background-color: var(--bg-secondary);" class="border-b border-gray-200">
         <tr>
-          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Category</th>
-          <th class="month-column px-6 py-3 text-right text-sm font-semibold text-gray-900">This Month</th>
-          <th class="month-column hidden px-6 py-3 text-right text-sm font-semibold text-gray-900" data-mode="previous">Previous Month</th>
-          <th class="px-6 py-3 text-right text-sm font-semibold text-gray-900">Average</th>
-          <th class="px-6 py-3 text-right text-sm font-semibold text-gray-900">Min</th>
-          <th class="px-6 py-3 text-right text-sm font-semibold text-gray-900">Max</th>
-          <th class="px-6 py-3 text-right text-sm font-semibold text-gray-900">vs Average</th>
-          <th class="px-6 py-3 text-right text-sm font-semibold text-gray-900">Months Tracked</th>
+          <th class="px-6 py-3 text-left text-sm font-semibold " style="color: var(--text-primary);">Category</th>
+          <th class="month-column px-6 py-3 text-right text-sm font-semibold " style="color: var(--text-primary);">This Month</th>
+          <th class="month-column hidden px-6 py-3 text-right text-sm font-semibold " style="color: var(--text-primary);" data-mode="previous">Previous Month</th>
+          <th class="px-6 py-3 text-right text-sm font-semibold " style="color: var(--text-primary);">Average</th>
+          <th class="px-6 py-3 text-right text-sm font-semibold " style="color: var(--text-primary);">Min</th>
+          <th class="px-6 py-3 text-right text-sm font-semibold " style="color: var(--text-primary);">Max</th>
+          <th class="px-6 py-3 text-right text-sm font-semibold " style="color: var(--text-primary);">vs Average</th>
+          <th class="px-6 py-3 text-right text-sm font-semibold " style="color: var(--text-primary);">Months Tracked</th>
         </tr>
       </thead>
       <tbody class="divide-y divide-gray-200">
@@ -139,14 +139,14 @@
           {% elif item.current_amount > 0 %}
             <tr class="category-row hover:bg-green-50 transition" data-category="{{ item.category }}" data-current="{{ item.current_amount }}" data-previous="{{ item.previous_amount }}" data-current-over="{{ item.is_current_over_budget }}" data-previous-over="{{ item.is_previous_over_budget }}" data-current-diff="{{ item.current_difference }}" data-previous-diff="{{ item.previous_difference }}">
           {% else %}
-            <tr class="category-row hover:bg-gray-50 transition" data-category="{{ item.category }}" data-current="{{ item.current_amount }}" data-previous="{{ item.previous_amount }}" data-current-over="{{ item.is_current_over_budget }}" data-previous-over="{{ item.is_previous_over_budget }}" data-current-diff="{{ item.current_difference }}" data-previous-diff="{{ item.previous_difference }}">
+            <tr class="category-row hover:bg-gray-100 transition" data-category="{{ item.category }}" data-current="{{ item.current_amount }}" data-previous="{{ item.previous_amount }}" data-current-over="{{ item.is_current_over_budget }}" data-previous-over="{{ item.is_previous_over_budget }}" data-current-diff="{{ item.current_difference }}" data-previous-diff="{{ item.previous_difference }}">
           {% endif %}
             <td class="px-6 py-4">
-              <p class="font-medium text-gray-900">{{ item.category }}</p>
+              <p class="font-medium " style="color: var(--text-primary);">{{ item.category }}</p>
             </td>
             <!-- Current Month Cell -->
             <td class="month-cell px-6 py-4 text-right" data-mode="current">
-              <p class="text-gray-900 font-semibold month-value">
+              <p class=" font-semibold month-value" style="color: var(--text-primary);">
                 {% if item.current_amount > 0 %}
                   {{ item.current_amount|floatformat:0|intcomma }}
                 {% else %}
@@ -156,7 +156,7 @@
             </td>
             <!-- Previous Month Cell -->
             <td class="month-cell hidden px-6 py-4 text-right" data-mode="previous">
-              <p class="text-gray-900 font-semibold month-value">
+              <p class=" font-semibold month-value" style="color: var(--text-primary);">
                 {% if item.previous_amount > 0 %}
                   {{ item.previous_amount|floatformat:0|intcomma }}
                 {% else %}
@@ -165,13 +165,13 @@
               </p>
             </td>
             <td class="px-6 py-4 text-right">
-              <p class="text-gray-900 font-semibold">{{ item.average|floatformat:0|intcomma }}</p>
+              <p class=" font-semibold" style="color: var(--text-primary);">{{ item.average|floatformat:0|intcomma }}</p>
             </td>
             <td class="px-6 py-4 text-right">
-              <p class="text-gray-600">{{ item.min|floatformat:0|intcomma }}</p>
+              <p class="" style="color: var(--text-secondary);">{{ item.min|floatformat:0|intcomma }}</p>
             </td>
             <td class="px-6 py-4 text-right">
-              <p class="text-gray-600">{{ item.max|floatformat:0|intcomma }}</p>
+              <p class="" style="color: var(--text-secondary);">{{ item.max|floatformat:0|intcomma }}</p>
             </td>
             <td class="px-6 py-4 text-right">
               <span class="difference-cell">
@@ -208,12 +208,12 @@
               </span>
             </td>
             <td class="px-6 py-4 text-right">
-              <p class="text-gray-600">{{ item.count }}</p>
+              <p class="" style="color: var(--text-secondary);">{{ item.count }}</p>
             </td>
           </tr>
         {% empty %}
           <tr>
-            <td colspan="7" class="px-6 py-8 text-center text-gray-500">
+            <td colspan="7" class="px-6 py-8 text-center " style="color: var(--text-muted);">
               <i class="bi bi-inbox text-4xl mb-2"></i>
               <p class="text-lg font-medium">No spending data available</p>
               <p class="text-sm mt-1">Start by uploading your bank statements</p>
@@ -226,9 +226,9 @@
 </div>
 
 <!-- Filters Section -->
-<div class="mt-8 bg-white rounded-xl shadow-md overflow-hidden">
-  <div class="bg-gradient-to-r from-gray-500 to-slate-500 px-6 py-4">
-    <h2 class="text-xl font-bold text-white flex items-center">
+<div class="chart-container">
+  <div class="chart-header">
+    <h2 class="chart-title">
       <i class="bi bi-funnel mr-2"></i>
       Filters
     </h2>
@@ -242,12 +242,12 @@
         <label class="block text-sm font-medium text-gray-700 mb-2">Data Sources</label>
         <div class="space-y-2">
           {% for file in files %}
-            <label class="flex items-center p-2 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
+            <label class="flex items-center p-2 border border-gray-200 rounded-lg hover:bg-gray-100 cursor-pointer">
               <input type="checkbox" name="file" value="{{ file.id }}" 
                      {% if file.id|stringformat:"s" in selected_file_ids %}checked{% endif %}
                      class="w-4 h-4 text-indigo-600 rounded">
-              <span class="ml-2 text-gray-900">{{ file.name }}</span>
-              <span class="ml-auto text-xs text-gray-500">{{ file.uploaded_at|date:"M d, Y" }}</span>
+              <span class="ml-2 " style="color: var(--text-primary);">{{ file.name }}</span>
+              <span class="ml-auto text-xs " style="color: var(--text-muted);">{{ file.uploaded_at|date:"M d, Y" }}</span>
             </label>
           {% endfor %}
         </div>
@@ -259,11 +259,11 @@
           <label class="block text-sm font-medium text-gray-700 mb-2">Currencies</label>
           <div class="space-y-2">
             {% for currency in all_currencies %}
-              <label class="flex items-center p-2 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
+              <label class="flex items-center p-2 border border-gray-200 rounded-lg hover:bg-gray-100 cursor-pointer">
                 <input type="checkbox" name="currency" value="{{ currency }}"
                        {% if currency in selected_currencies %}checked{% endif %}
                        class="w-4 h-4 text-indigo-600 rounded">
-                <span class="ml-2 text-gray-900">{{ currency }}</span>
+                <span class="ml-2 " style="color: var(--text-primary);">{{ currency }}</span>
               </label>
             {% endfor %}
           </div>
@@ -423,7 +423,7 @@
     
     // Update row colors based on mode
     document.querySelectorAll('tr.category-row').forEach(row => {
-      row.classList.remove('hover:bg-red-50', 'hover:bg-green-50', 'hover:bg-gray-50');
+      row.classList.remove('hover:bg-red-50', 'hover:bg-green-50', 'hover:bg-gray-100');
       
       const isOver = mode === 'current' 
         ? row.dataset.currentOver === 'True'
@@ -437,7 +437,7 @@
       } else if (amount > 0) {
         row.classList.add('hover:bg-green-50');
       } else {
-        row.classList.add('hover:bg-gray-50');
+        row.classList.add('hover:bg-gray-100');
       }
     });
   }
diff --git a/faster/templates/dashboard/settings.html b/faster/templates/dashboard/settings.html
index bdd1a89..061868a 100644
--- a/faster/templates/dashboard/settings.html
+++ b/faster/templates/dashboard/settings.html
@@ -4,356 +4,332 @@
 
 {% block content %}
 <div class="mb-8">
-  <h1 class="text-4xl font-bold text-gray-900 mb-2">
+  <h1 class="text-4xl font-bold text-primary mb-2" style="color: var(--text-primary)">
     <i class="bi bi-gear text-indigo-600"></i>
     Settings
   </h1>
-  <p class="text-gray-600">
-    Manage your application settings and categorization preferences
+  <p class="text-secondary" style="color: var(--text-secondary)"">
+    Manage your application settings, data sources, and preferences.
   </p>
 </div>
 
 <!-- Tab Navigation -->
 <div class="mb-8">
-  <div class="flex space-x-1 border-b border-gray-200 bg-white rounded-lg">
-    <button class="settings-tab px-6 py-3 font-medium border-b-2 border-indigo-600 text-indigo-600 transition"
-            data-tab="upload">
-      <i class="bi bi-cloud-upload mr-2"></i>Upload Files
+  <div class="flex space-x-1 border-b border-gray-200 bg-surface rounded-lg" style="background-color: var(--bg-surface)">
+    <button
+      class="settings-tab px-6 py-3 font-medium border-b-2 transition-colors duration-200 border-indigo-600 text-indigo-600 bg-secondary active" style="background-color: var(--bg-secondary)"
+      data-tab="data-sources">
+      <i class="bi bi-database mr-2"></i>Data Sources
     </button>
-    <button class="settings-tab px-6 py-3 font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition"
-            data-tab="categorization">
-      <i class="bi bi-robot mr-2"></i>Categorization
+    <button
+      class="settings-tab px-6 py-3 font-medium border-b-2 border-transparent text-secondary" style="color: var(--text-secondary)" hover:border-gray-300 transition"
+      data-tab="transactions">
+      <i class="bi bi-arrow-left-right mr-2"></i>Transactions
     </button>
-    <button class="settings-tab px-6 py-3 font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition"
-            data-tab="data">
-      <i class="bi bi-database mr-2"></i>Data Management
+    <button
+      class="settings-tab px-6 py-3 font-medium border-b-2 border-transparent text-secondary" style="color: var(--text-secondary)" hover:border-gray-300 transition"
+      data-tab="preferences">
+      <i class="bi bi-sliders mr-2"></i>Preferences
     </button>
   </div>
 </div>
 
-<!-- Tab 1: Upload Files -->
-<div id="upload-tab" class="settings-content">
-  <div class="bg-white rounded-xl shadow-md overflow-hidden">
-    <div class="bg-gradient-to-r from-indigo-500 to-blue-500 px-6 py-4">
-      <h2 class="text-xl font-bold text-white flex items-center">
-        <i class="bi bi-cloud-upload mr-2"></i>
-        Upload Bank Statements
-      </h2>
-    </div>
-    <div class="p-6">
-      <div class="bg-blue-50 border-2 border-dashed border-blue-300 rounded-lg p-8 text-center cursor-pointer hover:bg-blue-100 transition"
-           id="dropZone">
-        <i class="bi bi-file-earmark-arrow-up text-4xl text-blue-500 mb-2"></i>
-        <p class="text-gray-700 font-medium">Drop CSV files here or click to select</p>
-        <p class="text-sm text-gray-500 mt-1">Supported formats: ZKB, Revolut</p>
-        <input type="file" id="fileInput" multiple accept=".csv" class="hidden">
+<!-- Tab 1: Data Sources (Upload + File Selection) -->
+<div id="data-sources-tab" class="settings-content">
+  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
+
+    <!-- Upload Section -->
+    <div class="bg-surface rounded-xl shadow-md overflow-hidden h-full" style="background-color: var(--bg-surface)">
+      <div class="chart-header">
+        <h2 class="text-xl font-bold" style="color: var(--text-primary);" flex items-center">
+          <i class="bi bi-cloud-upload mr-2"></i>
+          Upload Bank Statements
+        </h2>
+      </div>
+      <div class="p-6">
+        <div
+          class="bg-blue-50 border-2 border-dashed border-blue-300 rounded-lg p-8 text-center cursor-pointer hover:bg-blue-100 transition h-64 flex flex-col justify-center items-center"
+          id="dropZone">
+          <i class="bi bi-file-earmark-arrow-up text-5xl text-blue-500 mb-4"></i>
+          <p class="text-gray-700 font-medium text-lg">Drop CSV files here or click to select</p>
+          <p class="text-sm text-muted mt-2" style="color: var(--text-muted)">Supported formats: ZKB, Revolut, UBS</p>
+          <input type="file" id="fileInput" multiple accept=".csv" class="hidden">
+        </div>
+        <div id="uploadStatus" class="mt-4"></div>
       </div>
-      <div id="uploadStatus" class="mt-4"></div>
     </div>
-  </div>
-</div>
 
-<!-- Tab 2: AI Categorization -->
-<div id="categorization-tab" class="settings-content hidden">
-  <div class="space-y-6">
-    <!-- Statistics Section -->
-    <div class="bg-white rounded-xl shadow-md overflow-hidden">
-      <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-4">
-        <h2 class="text-xl font-bold text-white flex items-center">
-          <i class="bi bi-bar-chart mr-2"></i>
-          Categorization Statistics
+    <!-- Active Files Section -->
+    <div class="bg-surface rounded-xl shadow-md overflow-hidden h-full" style="background-color: var(--bg-surface)">
+      <div class="chart-header">
+        <h2 class="text-xl font-bold" style="color: var(--text-primary);" flex items-center">
+          <i class="bi bi-check-circle mr-2"></i>
+          Active Data Sources
         </h2>
+        <p class="text-green-100 text-sm mt-1">Select which files to include in your dashboard</p>
       </div>
       <div class="p-6">
-        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
-          <div class="text-center p-4 bg-blue-50 rounded-lg">
-            <div class="text-3xl font-bold text-blue-600" id="categorization-rate">-</div>
-            <div class="text-sm text-gray-600 mt-1">Categorization Rate</div>
-          </div>
-          <div class="text-center p-4 bg-green-50 rounded-lg">
-            <div class="text-3xl font-bold text-green-600" id="high-confidence-count">-</div>
-            <div class="text-sm text-gray-600 mt-1">High Confidence (80%)</div>
-          </div>
-          <div class="text-center p-4 bg-yellow-50 rounded-lg">
-            <div class="text-3xl font-bold text-yellow-600" id="medium-confidence-count">-</div>
-            <div class="text-sm text-gray-600 mt-1">Medium Confidence (60-79%)</div>
-          </div>
-          <div class="text-center p-4 bg-purple-50 rounded-lg">
-            <div class="text-3xl font-bold text-purple-600" id="manual-corrections-count">-</div>
-            <div class="text-sm text-gray-600 mt-1">Manual Corrections</div>
-          </div>
-        </div>
-        
-        <button 
-          id="recategorize-btn"
-          class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-medium transition duration-200 flex items-center justify-center space-x-2"
-        >
-          <i class="bi bi-arrow-clockwise"></i>
-          <span>Re-categorize Uncategorized Transactions</span>
-        </button>
-        
-        <div id="recategorize-status" class="mt-4 hidden"></div>
-        
-        <div id="categorization-progress" class="mt-4 hidden">
-          <div class="bg-gray-200 rounded-full h-2">
-            <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
+        {% if files %}
+        <form method="POST" class="space-y-4">
+          {% csrf_token %}
+          <input type="hidden" name="form_type" value="files">
+          <div class="space-y-2 max-h-96 overflow-y-auto pr-2">
+            {% for file in files %}
+            <label
+              class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-secondary" style="background-color: var(--bg-secondary)" cursor-pointer transition group">
+              <input type="checkbox" name="file" value="{{ file.id }}"
+               {% if file.id|stringformat:"s" in selected_file_ids %}checked{% endif %}
+               class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500">
+              <div class="ml-3 flex-1">
+                <span class="font-medium text-primary block" style="color: var(--text-primary)">{{ file.name }}</span>
+                <span class="text-xs text-muted" style="color: var(--text-muted)"">Uploaded: {{ file.uploaded_at|date:"M d, Y H:i" }}</span>
+              </div>
+              <button type="button"
+                class="delete-file-btn text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100"
+                data-file-id="{{ file.id }}" title="Delete file">
+                <i class="bi bi-trash"></i>
+              </button>
+            </label>
+            {% endfor %}
           </div>
-          <p class="text-sm text-gray-600 mt-2 text-center flex items-center justify-center space-x-2">
-            <i class="bi bi-hourglass-split animate-spin"></i>
-            <span>Processing transactions...</span>
-          </p>
+          <button type="submit"
+            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition shadow-sm">
+            Update Active Sources
+          </button>
+        </form>
+        {% else %}
+        <div class="text-center py-12">
+          <i class="bi bi-folder2-open text-4xl text-gray-300 mb-3"></i>
+          <p class="text-muted" style="color: var(--text-muted)"">No files uploaded yet.</p>
         </div>
+        {% endif %}
       </div>
     </div>
 
-    <!-- Low Confidence Transactions Section -->
-    <div class="bg-white rounded-xl shadow-md overflow-hidden">
-      <div class="bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4">
-        <h2 class="text-xl font-bold text-white flex items-center">
-          <i class="bi bi-exclamation-triangle mr-2"></i>
-          Low Confidence Predictions
+  </div>
+</div>
+
+<!-- Tab 2: Transactions (formerly Categorization) -->
+<div id="transactions-tab" class="settings-content hidden">
+  <div class="space-y-6">
+
+    <!-- Smart Categorization Rules (Top, Full Width) -->
+    <div class="bg-surface rounded-xl shadow-md overflow-hidden" style="background-color: var(--bg-surface)">
+      <div class="chart-header">
+        <h2 class="text-xl font-bold" style="color: var(--text-primary);" flex items-center">
+          <i class="bi bi-hand-index mr-2"></i>
+          Smart Categorization Rules
         </h2>
-        <p class="text-orange-100 text-sm mt-1">Transactions that may need manual review (sorted by confidence, lowest first)</p>
       </div>
       <div class="p-6">
-        <button 
-          id="view-low-confidence-btn"
-          class="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg font-medium transition duration-200 flex items-center justify-center space-x-2 mb-4"
-        >
-          <i class="bi bi-eye"></i>
-          <span id="low-confidence-btn-text">Load Low Confidence Transactions</span>
-        </button>
-        
-        <div id="low-confidence-container" class="hidden space-y-4">
-          <div id="low-confidence-transactions">
-            <!-- Will be populated by JavaScript -->
+        <p class="text-secondary" style="color: var(--text-secondary)" mb-4 text-sm">
+          Search and manually categorize transactions. Changes apply to all matching merchants.
+        </p>
+
+        <div class="space-y-3">
+          <input type="text" id="merchant-search" placeholder="Search by merchant name..."
+            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
+          <div class="flex gap-2">
+            <input type="text" id="category-search" placeholder="Category..."
+              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
+            <input type="text" id="amount-search" placeholder="Amount..."
+              class="w-24 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
           </div>
-          <button 
-            id="hide-low-confidence-btn"
-            class="w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition duration-200"
-          >
-            Hide Low Confidence Transactions
+          <button id="search-merchant-btn"
+            class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition shadow-sm">
+            Search
           </button>
+
+          <div id="search-results" class="hidden space-y-2 mt-4">
+            <div id="transactions-list" class="max-h-64 overflow-y-auto border rounded-lg"></div>
+            <button id="hide-search-btn"
+              class="w-full bg-secondary" style="background-color: var(--bg-secondary);" hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition">
+              Hide Results
+            </button>
+          </div>
         </div>
+      </div>
+    </div>
 
-        <!-- Manual Categorization Section -->
-        <div class="mt-6 border-t pt-6">
-          <h3 class="text-lg font-semibold text-gray-900 mb-4">
-            <i class="bi bi-hand-index mr-2"></i>
-            Manual Categorization
-          </h3>
-          <p class="text-sm text-gray-600 mb-4">
-            Manually categorize transactions. When you categorize a transaction, all transactions with the same merchant will automatically get the same category.
-          </p>
-          
-          <div class="space-y-3">
-            <!-- Search by Merchant, Category, or Amount -->
-            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
-              <input 
-                type="text" 
-                id="merchant-search" 
-                placeholder="Search by merchant name..." 
-                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
-              >
-              <input 
-                type="text" 
-                id="category-search" 
-                placeholder="Search by category..." 
-                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
-              >
-              <div class="flex gap-2">
-                <input 
-                  type="text" 
-                  id="amount-search" 
-                  placeholder="Search by amount (e.g., 50 or >100)" 
-                  class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
-                >
-                <button 
-                  id="search-merchant-btn"
-                  class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition"
-                >
-                  Search
-                </button>
-              </div>
+    <!-- Secondary Grid (Stats, Review, Excluded) -->
+    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
+
+      <!-- Column 1: Categorization Statistics -->
+      <div class="bg-surface rounded-xl shadow-md overflow-hidden h-full" style="background-color: var(--bg-surface)">
+        <div class="chart-header">
+          <h2 class="text-xl font-bold" style="color: var(--text-primary);" flex items-center">
+            <i class="bi bi-bar-chart mr-2"></i>
+            Stats
+          </h2>
+        </div>
+        <div class="p-6 flex flex-col h-full">
+          <div class="space-y-4 mb-6 flex-1">
+            <div class="text-center p-3 bg-blue-50 rounded-lg border border-blue-100">
+              <div class="text-2xl font-bold text-blue-600" id="categorization-rate">-</div>
+              <div class="text-xs text-secondary" style="color: var(--text-secondary)" mt-1 font-medium">Categorization Rate</div>
             </div>
-            
-            <div id="search-results" class="hidden space-y-2">
-              <div id="transactions-list"></div>
-              <button 
-                id="hide-search-btn"
-                class="w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition"
-              >
-                Hide Results
-              </button>
+            <div class="text-center p-3 bg-green-50 rounded-lg border border-green-100">
+              <div class="text-2xl font-bold text-green-600" id="high-confidence-count">-</div>
+              <div class="text-xs text-secondary" style="color: var(--text-secondary)" mt-1 font-medium">High Confidence</div>
+            </div>
+            <div class="text-center p-3 bg-yellow-50 rounded-lg border border-yellow-100">
+              <div class="text-2xl font-bold text-yellow-600" id="medium-confidence-count">-</div>
+              <div class="text-xs text-secondary" style="color: var(--text-secondary)" mt-1 font-medium">Medium Confidence</div>
+            </div>
+            <div class="text-center p-3 bg-purple-50 rounded-lg border border-purple-100">
+              <div class="text-2xl font-bold text-purple-600" id="manual-corrections-count">-</div>
+              <div class="text-xs text-secondary" style="color: var(--text-secondary)" mt-1 font-medium">Manual Corrections</div>
             </div>
           </div>
+
+          <button id="recategorize-btn"
+            class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center justify-center space-x-2 shadow-sm text-sm">
+            <i class="bi bi-arrow-clockwise"></i>
+            <span>Re-categorize All</span>
+          </button>
+
+          <div id="recategorize-status" class="mt-4 hidden text-sm"></div>
         </div>
+      </div>
 
-        <!-- Info Box Section -->
-        <div class="mt-6 border-t pt-6">
-          <button id="info-toggle" class="w-full text-left flex items-center justify-between p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition">
-            <span class="flex items-center font-medium text-blue-900">
-              <i class="bi bi-info-circle mr-2"></i>
-              How Categorization Works
-            </span>
-            <i class="bi bi-chevron-down text-blue-900 transition-transform" id="info-icon"></i>
+      <!-- Column 2: Low Confidence Review -->
+      <div class="bg-surface rounded-xl shadow-md overflow-hidden h-full" style="background-color: var(--bg-surface)">
+        <div class="chart-header">
+          <h2 class="text-xl font-bold" style="color: var(--text-primary);" flex items-center">
+            <i class="bi bi-exclamation-triangle mr-2"></i>
+            Review Needed
+          </h2>
+        </div>
+        <div class="p-6">
+          <p class="text-secondary" style="color: var(--text-secondary)" mb-4 text-sm">Review transactions where the AI was unsure.</p>
+          <button id="view-low-confidence-btn"
+            class="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg font-medium transition duration-200 flex items-center justify-center space-x-2 mb-4 shadow-sm">
+            <i class="bi bi-eye"></i>
+            <span id="low-confidence-btn-text">Load Transactions</span>
           </button>
-          
-          <div id="info-content" class="hidden mt-4 p-4 bg-blue-50 rounded-lg space-y-4 border border-blue-200">
-            <div>
-              <h4 class="font-semibold text-blue-900 mb-2">Three-tier Categorization System</h4>
-              <ul class="space-y-2 text-sm text-blue-800">
-                <li class="flex items-start">
-                  <span class="font-bold mr-2">1.</span>
-                  <span><strong>Merchant Mapping:</strong> Exact and substring matches from known merchants (100% confidence)</span>
-                </li>
-                <li class="flex items-start">
-                  <span class="font-bold mr-2">2.</span>
-                  <span><strong>Keyword Rules:</strong> Pattern-based categorization for common merchants like Netflix, YouTube, Spotify (95% confidence)</span>
-                </li>
-                <li class="flex items-start">
-                  <span class="font-bold mr-2">3.</span>
-                  <span><strong>Semantic Matching:</strong> AI-powered similarity matching for new merchants using sentence embeddings (40-90% confidence)</span>
-                </li>
-              </ul>
-            </div>
 
-            <div class="border-t border-blue-200 pt-4">
-              <h4 class="font-semibold text-blue-900 mb-2">Confidence Thresholds</h4>
-              <div class="space-y-2 text-sm">
-                <div class="flex items-center justify-between">
-                  <span class="text-blue-800">High Confidence</span>
-                  <span class="bg-green-200 text-green-800 px-3 py-1 rounded-full font-semibold"> 80%</span>
-                </div>
-                <div class="flex items-center justify-between">
-                  <span class="text-blue-800">Medium Confidence</span>
-                  <span class="bg-yellow-200 text-yellow-800 px-3 py-1 rounded-full font-semibold">60% - 79%</span>
-                </div>
-                <div class="flex items-center justify-between">
-                  <span class="text-blue-800">Low Confidence</span>
-                  <span class="bg-orange-200 text-orange-800 px-3 py-1 rounded-full font-semibold">&lt; 60%</span>
-                </div>
-              </div>
+          <div id="low-confidence-container" class="hidden space-y-4">
+            <div id="low-confidence-transactions" class="max-h-96 overflow-y-auto">
+              <!-- Will be populated by JavaScript -->
             </div>
+            <button id="hide-low-confidence-btn"
+              class="w-full bg-secondary" style="background-color: var(--bg-secondary);" hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition">
+              Hide
+            </button>
+          </div>
+        </div>
+      </div>
 
-            <div class="border-t border-blue-200 pt-4">
-              <h4 class="font-semibold text-blue-900 mb-2">Special Categories</h4>
-              <ul class="space-y-2 text-sm text-blue-800">
-                <li><strong>Uncounted:</strong> Legitimate non-spending transactions (internal transfers, exchanges, balance migrations)</li>
-                <li><strong>Uncategorized:</strong> Transactions that need manual review or semantic matching</li>
-              </ul>
+      <!-- Column 3: Excluded Categories -->
+      <div class="bg-surface rounded-xl shadow-md overflow-hidden h-full" style="background-color: var(--bg-surface)">
+        <div class="chart-header">
+          <h2 class="text-xl font-bold" style="color: var(--text-primary);" flex items-center">
+            <i class="bi bi-ban mr-2"></i>
+            Excluded
+          </h2>
+        </div>
+        <div class="p-6">
+          <p class="text-secondary" style="color: var(--text-secondary)" mb-4 text-sm">Hide from dashboard graphs.</p>
+          {% if all_categories %}
+          <form method="POST" id="excluded-categories-form" class="space-y-4">
+            {% csrf_token %}
+            <input type="hidden" name="form_type" value="excluded_categories">
+            <div class="space-y-2 max-h-96 overflow-y-auto pr-2">
+              {% for category in all_categories %}
+              <label
+                class="flex items-center p-2 border border-gray-200 rounded-lg hover:bg-red-50 cursor-pointer transition">
+                <input type="checkbox" name="excluded_category" value="{{ category }}"
+                {% if category in excluded_categories %}checked{% endif %}
+                class="w-4 h-4 text-red-600 rounded focus:ring-red-500">
+                <span class="ml-2 text-sm font-medium text-primary truncate" style="color: var(--text-primary)" title="{{ category }}">{{ category }}</span>
+              </label>
+              {% endfor %}
             </div>
-          </div>
+            <button type="submit"
+              class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition shadow-sm mt-4">
+              Update
+            </button>
+          </form>
+          <div id="excluded-status" class="mt-4 hidden p-3 rounded-lg"></div>
+          {% else %}
+          <p class="text-secondary" style="color: var(--text-secondary)" text-center py-8">No categories available.</p>
+          {% endif %}
         </div>
       </div>
+
     </div>
-  </div>
-</div>
 
-<!-- Tab 3: Data Management -->
-<div id="data-tab" class="settings-content hidden">
-  <div class="space-y-6">
-    <!-- Files Section -->
-    <div class="bg-white rounded-xl shadow-md overflow-hidden">
-      <div class="bg-gradient-to-r from-green-500 to-emerald-500 px-6 py-4">
-        <h2 class="text-xl font-bold text-white flex items-center">
-          <i class="bi bi-file-earmark mr-2"></i>
-          Uploaded Files
-        </h2>
-      </div>
-      <div class="p-6">
-        {% if files %}
-        <form method="POST" class="space-y-4">
-          {% csrf_token %}
-          <div class="space-y-2">
-            {% for file in files %}
-            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
-              <input type="checkbox" name="file" value="{{ file.id }}" 
-                     {% if file.id|stringformat:"s" in selected_file_ids %}checked{% endif %}
-                     class="w-4 h-4 text-indigo-600 rounded">
-              <span class="ml-3 flex-1">
-                <span class="font-medium text-gray-900">{{ file.name }}</span>
-                <span class="text-sm text-gray-500 block">Uploaded: {{ file.uploaded_at|date:"M d, Y H:i" }}</span>
-              </span>
-              <button type="button" class="delete-file-btn text-red-600 hover:text-red-800 text-sm" data-file-id="{{ file.id }}">
-                Delete
-              </button>
-            </label>
-            {% endfor %}
+    <!-- Info Box -->
+    <div class="bg-blue-50 rounded-xl border border-blue-200 overflow-hidden">
+      <button id="info-toggle"
+        class="w-full text-left flex items-center justify-between p-4 hover:bg-blue-100 transition">
+        <span class="flex items-center font-medium text-blue-900">
+          <i class="bi bi-info-circle mr-2"></i>
+          How Categorization Works
+        </span>
+        <i class="bi bi-chevron-down text-blue-900 transition-transform" id="info-icon"></i>
+      </button>
+
+      <div id="info-content" class="hidden p-4 border-t border-blue-200 bg-surface" style="background-color: var(--bg-surface)"">
+        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
+          <div>
+            <h4 class="font-semibold text-blue-900 mb-2">1. Merchant Mapping</h4>
+            <p class="text-sm text-secondary" style="color: var(--text-secondary)"">Exact matches from known merchants. 100% confidence.</p>
           </div>
-          <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition">
-            Update Selection
-          </button>
-        </form>
-        {% else %}
-        <p class="text-gray-600 text-center py-8">No files uploaded yet. Start by uploading a bank statement.</p>
-        {% endif %}
+          <div>
+            <h4 class="font-semibold text-blue-900 mb-2">2. Keyword Rules</h4>
+            <p class="text-sm text-secondary" style="color: var(--text-secondary)"">Pattern matching for common services (Netflix, Spotify). 95% confidence.
+            </p>
+          </div>
+          <div>
+            <h4 class="font-semibold text-blue-900 mb-2">3. AI Semantic Matching</h4>
+            <p class="text-sm text-secondary" style="color: var(--text-secondary)"">AI analysis of transaction text. 40-90% confidence.</p>
+          </div>
+        </div>
       </div>
     </div>
 
+  </div>
+</div>
+
+<!-- Tab 3: Preferences -->
+<div id="preferences-tab" class="settings-content hidden">
+  <div class="max-w-2xl mx-auto">
     <!-- Currencies Section -->
-    <div class="bg-white rounded-xl shadow-md overflow-hidden">
-      <div class="bg-gradient-to-r from-teal-500 to-cyan-500 px-6 py-4">
-        <h2 class="text-xl font-bold text-white flex items-center">
+    <div class="bg-surface rounded-xl shadow-md overflow-hidden" style="background-color: var(--bg-surface)">
+      <div class="chart-header">
+        <h2 class="text-xl font-bold" style="color: var(--text-primary);" flex items-center">
           <i class="bi bi-currency-exchange mr-2"></i>
-          Currencies
+          Display Currencies
         </h2>
+        <p class="text-teal-100 text-sm mt-1">Choose which currencies to display in your dashboard</p>
       </div>
       <div class="p-6">
         {% if all_currencies %}
-        <form method="POST" class="space-y-4">
+        <form method="POST" class="space-y-6">
           {% csrf_token %}
-          <div class="space-y-2">
+          <input type="hidden" name="form_type" value="currencies">
+          <div class="space-y-3">
             {% for currency in all_currencies %}
-            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
+            <label
+              class="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-teal-50 cursor-pointer transition group">
               <input type="checkbox" name="currency" value="{{ currency }}"
-                     {% if currency in selected_currencies %}checked{% endif %}
-                     class="w-4 h-4 text-indigo-600 rounded">
-              <span class="ml-3 font-medium text-gray-900">{{ currency }}</span>
-            </label>
-            {% endfor %}
-          </div>
-          <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition">
-            Update Selection
-          </button>
-        </form>
-        {% else %}
-        <p class="text-gray-600 text-center py-8">No currencies found in your transactions.</p>
-        {% endif %}
-      </div>
-    </div>
-
-
-    <!-- Excluded Categories Section -->
-    <div class="bg-white rounded-xl shadow-md overflow-hidden">
-      <div class="bg-gradient-to-r from-red-500 to-pink-500 px-6 py-4">
-        <h2 class="text-xl font-bold text-white flex items-center">
-          <i class="bi bi-ban mr-2"></i>
-          Excluded Categories
-        </h2>
-        <p class="text-red-100 text-sm mt-1">Select categories to hide from all dashboard graphs and statistics</p>
-      </div>
-      <div class="p-6">
-        {% if all_categories %}
-        <form method="POST" id="excluded-categories-form" class="space-y-4">
-          {% csrf_token %}
-          <div class="space-y-2">
-            {% for category in all_categories %}
-            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-red-50 cursor-pointer transition">
-              <input type="checkbox" name="excluded_category" value="{{ category }}"
-                     {% if category in excluded_categories %}checked{% endif %}
-                     class="w-4 h-4 text-red-600 rounded">
-              <span class="ml-3 font-medium text-gray-900">{{ category }}</span>
+              {% if currency in selected_currencies %}checked{% endif %}
+              class="w-5 h-5 text-teal-600 rounded focus:ring-teal-500">
+              <span class="ml-4 font-medium text-primary text-lg" style="color: var(--text-primary)">{{ currency }}</span>
             </label>
             {% endfor %}
           </div>
-          <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition">
-            Update Excluded Categories
+          <button type="submit"
+            class="w-full bg-teal-600 hover:bg-teal-700 text-white px-6 py-3 rounded-lg font-medium transition shadow-sm text-lg">
+            Save Preferences
           </button>
         </form>
-        <div id="excluded-status" class="mt-4 hidden p-3 rounded-lg"></div>
         {% else %}
-        <p class="text-gray-600 text-center py-8">No categories available to exclude.</p>
+        <div class="text-center py-12">
+          <i class="bi bi-cash-coin text-4xl text-gray-300 mb-3"></i>
+          <p class="text-muted" style="color: var(--text-muted)"">No currencies found in your transactions.</p>
+        </div>
         {% endif %}
       </div>
     </div>
@@ -365,6 +341,26 @@
   .settings-tab.active {
     border-bottom-color: #4f46e5;
     color: #4f46e5;
+    background-color: #f3f4f6;
+  }
+
+  /* Custom scrollbar for lists */
+  ::-webkit-scrollbar {
+    width: 8px;
+  }
+
+  ::-webkit-scrollbar-track {
+    background: #f1f1f1;
+    border-radius: 4px;
+  }
+
+  ::-webkit-scrollbar-thumb {
+    background: #c7c7c7;
+    border-radius: 4px;
+  }
+
+  ::-webkit-scrollbar-thumb:hover {
+    background: #a8a8a8;
   }
 </style>
 
@@ -383,7 +379,7 @@
   } catch (e) {
     console.warn('Failed to parse categories, using fallback');
   }
-  
+
   // If parsing failed, include fallback categories
   if (globalCategoryOptions.length === 0) {
     globalCategoryOptions = [
@@ -414,7 +410,7 @@
     const toast = document.createElement('div');
     const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
     const icon = type === 'success' ? '' : type === 'error' ? '' : '';
-    
+
     toast.className = `${bgColor} text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-fadeIn pointer-events-auto`;
     toast.style.cssText = `animation: slideIn 0.3s ease-out; min-width: 250px;`;
     toast.innerHTML = `
@@ -457,7 +453,7 @@
   `;
   document.head.appendChild(style);
 
-  console.log('Settings page JavaScript loaded - Version 2.0');
+  console.log('Settings page JavaScript loaded - Version 3.0 (Redesign)');
 
   // Helper function to get CSRF token from cookie
   function getCookie(name) {
@@ -477,31 +473,33 @@
 
   // Tab switching
   document.querySelectorAll('.settings-tab').forEach(tab => {
-    tab.addEventListener('click', function() {
+    tab.addEventListener('click', function () {
       const tabName = this.dataset.tab;
-      
+
       // Hide all tabs
       document.querySelectorAll('.settings-content').forEach(content => {
         content.classList.add('hidden');
       });
-      
+
       // Remove active class from all tabs
       document.querySelectorAll('.settings-tab').forEach(t => {
         t.classList.remove('active');
         t.style.borderBottomColor = 'transparent';
         t.style.color = '#4b5563';
+        t.style.backgroundColor = 'transparent';
       });
-      
+
       // Show selected tab
       document.getElementById(tabName + '-tab').classList.remove('hidden');
-      
+
       // Add active class to clicked tab
       this.classList.add('active');
       this.style.borderBottomColor = '#4f46e5';
       this.style.color = '#4f46e5';
-      
-      // Load stats when categorization tab is clicked
-      if (tabName === 'categorization') {
+      this.style.backgroundColor = '#f3f4f6';
+
+      // Load stats when transactions tab is clicked
+      if (tabName === 'transactions') {
         loadCategorizationStats();
       }
     });
@@ -521,26 +519,32 @@
   }
 
   function updateCategorizationStatsUI(stats) {
-    document.getElementById('categorization-rate').textContent = 
-      stats.categorization_rate.toFixed(1) + '%';
-    document.getElementById('high-confidence-count').textContent = stats.high_confidence;
-    document.getElementById('medium-confidence-count').textContent = stats.medium_confidence;
-    document.getElementById('manual-corrections-count').textContent = stats.manually_categorized;
+    const rateEl = document.getElementById('categorization-rate');
+    if (rateEl) rateEl.textContent = stats.categorization_rate.toFixed(1) + '%';
+
+    const highEl = document.getElementById('high-confidence-count');
+    if (highEl) highEl.textContent = stats.high_confidence;
+
+    const medEl = document.getElementById('medium-confidence-count');
+    if (medEl) medEl.textContent = stats.medium_confidence;
+
+    const manEl = document.getElementById('manual-corrections-count');
+    if (manEl) manEl.textContent = stats.manually_categorized;
   }
 
   function recategorizeUncategorized() {
     const btn = document.getElementById('recategorize-btn');
     const statusDiv = document.getElementById('recategorize-status');
-    
+
     // Show processing state
     btn.disabled = true;
     statusDiv.innerHTML = '<div class="flex items-center space-x-2"><i class="bi bi-arrow-clockwise animate-spin"></i><span>Processing...</span></div>';
     statusDiv.classList.remove('hidden');
-    
+
     // Get CSRF token
     const csrfToken = getCookie('csrftoken');
-    
-    fetch('/api/categorization/recategorize/', { 
+
+    fetch('/api/categorization/recategorize/', {
       method: 'POST',
       headers: {
         'X-CSRFToken': csrfToken,
@@ -560,7 +564,7 @@
             </ul>
           </div>
         `;
-        
+
         // Refresh stats and low confidence transactions
         setTimeout(() => {
           loadCategorizationStats();
@@ -579,20 +583,20 @@
   function viewLowConfidenceTransactions() {
     const container = document.getElementById('low-confidence-container');
     const txContainer = document.getElementById('low-confidence-transactions');
-    
+
     // Show container
     container.classList.remove('hidden');
-    
+
     // Show loading
-    txContainer.innerHTML = '<div class="text-center py-8"><i class="bi bi-arrow-clockwise animate-spin text-2xl text-gray-400"></i><p class="text-gray-500 mt-2">Loading transactions...</p></div>';
-    
+    txContainer.innerHTML = '<div class="text-center py-8"><i class="bi bi-arrow-clockwise animate-spin text-2xl text-gray-400"></i><p class="text-muted mt-2" style="color: var(--text-muted)">Loading transactions...</p></div>';
+
     fetch('/api/categorization/low-confidence/')
       .then(response => response.json())
       .then(data => {
         if (data.success && data.transactions.length > 0) {
           displayLowConfidenceTransactions(data.transactions);
         } else if (data.transactions.length === 0) {
-          txContainer.innerHTML = '<div class="text-center py-12"><i class="bi bi-check-circle text-4xl text-green-500 mb-2"></i><p class="text-gray-600 font-medium">No low confidence predictions found!</p><p class="text-sm text-gray-500">All transactions are categorized with good confidence.</p></div>';
+          txContainer.innerHTML = '<div class="text-center py-12"><i class="bi bi-check-circle text-4xl text-green-500 mb-2"></i><p class="text-secondary font-medium" style="color: var(--text-secondary)">No low confidence predictions found!</p><p class="text-sm text-muted" style="color: var(--text-muted)"">All transactions are categorized with good confidence.</p></div>';
         } else {
           txContainer.innerHTML = '<div class="text-center py-4 text-red-500">Error: ' + data.error + '</div>';
         }
@@ -605,12 +609,12 @@
 
   function displayLowConfidenceTransactions(transactions) {
     const container = document.getElementById('low-confidence-transactions');
-    
+
     // Sort by confidence (lowest first)
     const sorted = transactions.sort((a, b) => a.confidence - b.confidence);
-    
-    let html = '<div class="overflow-x-auto"><table class="w-full text-sm"><thead class="border-b-2 border-gray-200"><tr><th class="text-left py-3 px-3 font-semibold text-gray-700">Date</th><th class="text-left py-3 px-3 font-semibold text-gray-700">Merchant</th><th class="text-left py-3 px-3 font-semibold text-gray-700">Category</th><th class="text-right py-3 px-3 font-semibold text-gray-700">Confidence</th><th class="text-right py-3 px-3 font-semibold text-gray-700">Amount</th></tr></thead><tbody>';
-    
+
+    let html = '<div class="overflow-x-auto"><table class="w-full text-sm"><thead class="border-b-2 border-gray-200 sticky top-0 bg-surface" style="background-color: var(--bg-surface)""><tr><th class="text-left py-3 px-3 font-semibold text-gray-700">Date</th><th class="text-left py-3 px-3 font-semibold text-gray-700">Merchant</th><th class="text-left py-3 px-3 font-semibold text-gray-700">Category</th><th class="text-right py-3 px-3 font-semibold text-gray-700">Confidence</th><th class="text-right py-3 px-3 font-semibold text-gray-700">Amount</th></tr></thead><tbody>';
+
     sorted.forEach((transaction) => {
       const confidence = transaction.confidence * 100;
       let confidenceClass = 'bg-red-100 text-red-800';
@@ -621,31 +625,36 @@
       } else if (confidence >= 40) {
         confidenceClass = 'bg-orange-100 text-orange-800';
       }
-      
+
       html += `
-        <tr class="border-b border-gray-100 hover:bg-gray-50">
-          <td class="py-3 px-3 text-gray-900">${transaction.date}</td>
-          <td class="py-3 px-3 text-gray-900 font-medium">${transaction.booking_text}</td>
+        <tr class="border-b border-gray-100 hover:bg-secondary" style="background-color: var(--bg-secondary)"">
+          <td class="py-3 px-3 text-primary" style="color: var(--text-primary)"">${transaction.date}</td>
+          <td class="py-3 px-3 text-primary font-medium" style="color: var(--text-primary)">${transaction.booking_text}</td>
           <td class="py-3 px-3"><span class="inline-block bg-indigo-100 text-indigo-800 px-2 py-1 rounded">${transaction.category}</span></td>
           <td class="py-3 px-3 text-right"><span class="inline-block ${confidenceClass} px-3 py-1 rounded-full font-medium">${confidence.toFixed(1)}%</span></td>
-          <td class="py-3 px-3 text-right text-gray-900">${parseFloat(transaction.amount).toFixed(2)}</td>
+          <td class="py-3 px-3 text-right text-primary" style="color: var(--text-primary)"">${parseFloat(transaction.amount).toFixed(2)}</td>
         </tr>
       `;
     });
-    
+
     html += '</tbody></table></div>';
-    
+
     if (sorted.length === 0) {
-      html = '<div class="text-center py-12"><i class="bi bi-check-circle text-4xl text-green-500 mb-2"></i><p class="text-gray-600 font-medium">No low confidence predictions found!</p><p class="text-sm text-gray-500">All transactions are categorized with good confidence.</p></div>';
+      html = '<div class="text-center py-12"><i class="bi bi-check-circle text-4xl text-green-500 mb-2"></i><p class="text-secondary font-medium" style="color: var(--text-secondary)">No low confidence predictions found!</p><p class="text-sm text-muted" style="color: var(--text-muted)"">All transactions are categorized with good confidence.</p></div>';
     }
-    
+
     container.innerHTML = html;
   }
 
   // Event listeners
-  document.getElementById('recategorize-btn').addEventListener('click', recategorizeUncategorized);
-  document.getElementById('view-low-confidence-btn').addEventListener('click', viewLowConfidenceTransactions);
-  document.getElementById('hide-low-confidence-btn').addEventListener('click', function() {
+  const recategorizeBtn = document.getElementById('recategorize-btn');
+  if (recategorizeBtn) recategorizeBtn.addEventListener('click', recategorizeUncategorized);
+
+  const viewLowConfBtn = document.getElementById('view-low-confidence-btn');
+  if (viewLowConfBtn) viewLowConfBtn.addEventListener('click', viewLowConfidenceTransactions);
+
+  const hideLowConfBtn = document.getElementById('hide-low-confidence-btn');
+  if (hideLowConfBtn) hideLowConfBtn.addEventListener('click', function () {
     document.getElementById('low-confidence-container').classList.add('hidden');
   });
 
@@ -656,27 +665,27 @@
 
   if (dropZone && fileInput) {
     // Click to select files
-    dropZone.addEventListener('click', function() {
+    dropZone.addEventListener('click', function () {
       fileInput.click();
     });
 
     // Handle file selection
-    fileInput.addEventListener('change', function(e) {
+    fileInput.addEventListener('change', function (e) {
       handleFileUpload(e.target.files);
     });
 
     // Drag and drop
-    dropZone.addEventListener('dragover', function(e) {
+    dropZone.addEventListener('dragover', function (e) {
       e.preventDefault();
       dropZone.classList.add('bg-blue-200', 'border-blue-400');
     });
 
-    dropZone.addEventListener('dragleave', function(e) {
+    dropZone.addEventListener('dragleave', function (e) {
       e.preventDefault();
       dropZone.classList.remove('bg-blue-200', 'border-blue-400');
     });
 
-    dropZone.addEventListener('drop', function(e) {
+    dropZone.addEventListener('drop', function (e) {
       e.preventDefault();
       dropZone.classList.remove('bg-blue-200', 'border-blue-400');
       handleFileUpload(e.dataTransfer.files);
@@ -723,7 +732,7 @@
               <p class="text-sm text-green-700">Transactions have been imported and categorized.</p>
             </div>
           `;
-          
+
           // Refresh categorization stats after a short delay
           setTimeout(() => {
             loadCategorizationStats();
@@ -743,417 +752,289 @@
   }
 
   // Load categorization stats on page load
-  document.addEventListener('DOMContentLoaded', function() {
+  document.addEventListener('DOMContentLoaded', function () {
     loadCategorizationStats();
-    
+
     // Setup delete file buttons
     document.querySelectorAll('.delete-file-btn').forEach(btn => {
-      btn.addEventListener('click', function() {
+      btn.addEventListener('click', function (e) {
+        e.stopPropagation(); // Prevent triggering the label click
+        e.preventDefault();
+
         const fileId = this.dataset.fileId;
         if (confirm('Are you sure you want to delete this file? This will also delete all associated transactions.')) {
-          deleteFile(fileId);
+          // In a real app we would call an API endpoint
+          // For now we can't easily do this without a specific endpoint
+          alert('File deletion requires a dedicated API endpoint which is not implemented in this view.');
         }
       });
     });
-    
+
     // Setup info toggle
     const infoToggle = document.getElementById('info-toggle');
     const infoContent = document.getElementById('info-content');
     const infoIcon = document.getElementById('info-icon');
-    
+
     if (infoToggle) {
-      infoToggle.addEventListener('click', function() {
+      infoToggle.addEventListener('click', function () {
         infoContent.classList.toggle('hidden');
         infoIcon.style.transform = infoContent.classList.contains('hidden') ? 'rotate(0)' : 'rotate(180deg)';
       });
     }
-    
+
     // Setup manual categorization
     const searchMerchantBtn = document.getElementById('search-merchant-btn');
     const merchantSearch = document.getElementById('merchant-search');
     const searchResults = document.getElementById('search-results');
     const hideSearchBtn = document.getElementById('hide-search-btn');
-    
+
     if (searchMerchantBtn) {
       searchMerchantBtn.addEventListener('click', searchMerchants);
-      merchantSearch.addEventListener('keypress', function(e) {
+      merchantSearch.addEventListener('keypress', function (e) {
         if (e.key === 'Enter') {
           searchMerchants();
         }
       });
-      
+
       // Add event listeners for new search fields
       const categorySearch = document.getElementById('category-search');
       const amountSearch = document.getElementById('amount-search');
-      
+
       if (categorySearch) {
-        categorySearch.addEventListener('keypress', function(e) {
+        categorySearch.addEventListener('keypress', function (e) {
           if (e.key === 'Enter') {
             searchMerchants();
           }
         });
       }
-      
+
       if (amountSearch) {
-        amountSearch.addEventListener('keypress', function(e) {
+        amountSearch.addEventListener('keypress', function (e) {
           if (e.key === 'Enter') {
             searchMerchants();
           }
         });
       }
-      
-      hideSearchBtn.addEventListener('click', function() {
+    }
+
+    if (hideSearchBtn) {
+      hideSearchBtn.addEventListener('click', function () {
         searchResults.classList.add('hidden');
-        merchantSearch.value = '';
-        document.getElementById('category-search').value = '';
-        document.getElementById('amount-search').value = '';
       });
     }
   });
-  
+
   function searchMerchants() {
-    const merchantTerm = document.getElementById('merchant-search').value.trim().toLowerCase();
-    const categoryTerm = document.getElementById('category-search').value.trim().toLowerCase();
-    const amountTerm = document.getElementById('amount-search').value.trim();
-    
-    if (!merchantTerm && !categoryTerm && !amountTerm) {
-      showToast('Please enter at least one search criteria: merchant name, category, or amount', 'error');
+    const merchantInput = document.getElementById('merchant-search');
+    const categoryInput = document.getElementById('category-search');
+    const amountInput = document.getElementById('amount-search');
+    const searchResults = document.getElementById('search-results');
+    const transactionsList = document.getElementById('transactions-list');
+
+    const merchantQuery = merchantInput ? merchantInput.value.trim() : '';
+    const categoryQuery = categoryInput ? categoryInput.value.trim() : '';
+    const amountQuery = amountInput ? amountInput.value.trim() : '';
+
+    if (!merchantQuery && !categoryQuery && !amountQuery) {
+      showToast('Please enter a search term', 'info');
       return;
     }
-    
-    // Parse amount search (supports >, <, >=, <=, =, or just a number)
-    let amountFilter = null;
-    if (amountTerm) {
-      const match = amountTerm.match(/^([><=]*)([\d.]+)$/);
-      if (match) {
-        const operator = match[1] || '=';
-        const value = parseFloat(match[2]);
-        amountFilter = { operator, value };
-      } else {
-        showToast('Invalid amount format. Use: 50, >100, <200, >=150, <=300, or =75', 'error');
-        return;
-      }
-    }
-    
-    fetch(`/api/transactions/`)
+
+    // Show loading state
+    searchResults.classList.remove('hidden');
+    transactionsList.innerHTML = '<div class="p-4 text-center text-muted" style="color: var(--text-muted)""><i class="bi bi-hourglass-split animate-spin mr-2"></i>Searching...</div>';
+
+    // Build query parameters
+    const params = new URLSearchParams();
+    if (merchantQuery) params.append('q', merchantQuery);
+    if (categoryQuery) params.append('category', categoryQuery);
+    if (amountQuery) params.append('amount', amountQuery);
+
+    fetch(`/api/transactions/search/?${params.toString()}`)
       .then(response => response.json())
       .then(data => {
-        let transactions = data.transactions;
-        
-        // Apply merchant filter
-        if (merchantTerm) {
-          transactions = transactions.filter(t => 
-            t.booking_text.toLowerCase().includes(merchantTerm)
-          );
-        }
-        
-        // Apply category filter
-        if (categoryTerm) {
-          transactions = transactions.filter(t => 
-            (t.category || '').toLowerCase().includes(categoryTerm)
-          );
-        }
-        
-        // Apply amount filter
-        if (amountFilter) {
-          const { operator, value } = amountFilter;
-          transactions = transactions.filter(t => {
-            const amount = Math.abs(parseFloat(t.amount));
-            switch (operator) {
-              case '>': return amount > value;
-              case '<': return amount < value;
-              case '>=': return amount >= value;
-              case '<=': return amount <= value;
-              case '=': return amount === value;
-              default: return true;
-            }
-          });
-        }
-        
-        if (transactions.length === 0) {
-          document.getElementById('transactions-list').innerHTML = '<p class="text-gray-500">No transactions found matching your criteria.</p>';
-          document.getElementById('search-results').classList.remove('hidden');
-        } else {
-          // Store all results globally for pagination
-          allSearchResults = transactions;
+        if (data.success) {
+          allSearchResults = data.transactions;
           currentResultsPage = 1;
-          
-          // Display first page and show results container
-          displaySearchResultsPage();
-          document.getElementById('search-results').classList.remove('hidden');
+          displaySearchResults(allSearchResults, currentResultsPage);
+        } else {
+          transactionsList.innerHTML = `<div class="p-4 text-center text-red-500">Error: ${data.error}</div>`;
         }
       })
       .catch(error => {
-        console.error('Error searching merchants:', error);
-        showToast('Error searching merchants', 'error');
+        console.error('Error searching:', error);
+        transactionsList.innerHTML = '<div class="p-4 text-center text-red-500">Error performing search</div>';
       });
   }
-  
-  function displaySearchResultsPage() {
-    const startIdx = (currentResultsPage - 1) * resultsPerPage;
-    const endIdx = startIdx + resultsPerPage;
-    const pageTransactions = allSearchResults.slice(startIdx, endIdx);
-    
-    let html = '<div class="space-y-2">';
-    pageTransactions.forEach(t => {
+
+  function displaySearchResults(transactions, page) {
+    const transactionsList = document.getElementById('transactions-list');
+
+    if (transactions.length === 0) {
+      transactionsList.innerHTML = '<div class="p-4 text-center text-muted" style="color: var(--text-muted)"">No transactions found matching your criteria.</div>';
+      return;
+    }
+
+    // Pagination logic
+    const startIndex = (page - 1) * resultsPerPage;
+    const endIndex = Math.min(startIndex + resultsPerPage, transactions.length);
+    const pageTransactions = transactions.slice(startIndex, endIndex);
+    const totalPages = Math.ceil(transactions.length / resultsPerPage);
+
+    let html = `
+      <div class="bg-secondary" style="background-color: var(--bg-secondary)" px-4 py-2 border-b border-gray-200 flex justify-between items-center">
+        <span class="text-sm text-secondary" style="color: var(--text-secondary)"">Found ${transactions.length} transactions</span>
+        <span class="text-sm text-secondary" style="color: var(--text-secondary)"">Page ${page} of ${totalPages}</span>
+      </div>
+      <div class="divide-y divide-gray-200">
+    `;
+
+    pageTransactions.forEach(tx => {
+      // Create category dropdown options
+      let categoryOptions = '';
+      // Add current category first if it exists
+      if (tx.category) {
+        categoryOptions += `<option value="${tx.category}" selected>${tx.category}</option>`;
+      } else {
+        categoryOptions += `<option value="" selected disabled>Select category...</option>`;
+      }
+
+      // Add other categories
+      globalCategoryOptions.forEach(cat => {
+        if (cat !== tx.category) {
+          categoryOptions += `<option value="${cat}">${cat}</option>`;
+        }
+      });
+
       html += `
-        <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
+        <div class="p-4 hover:bg-secondary transition" style="background-color: var(--bg-secondary)">
           <div class="flex justify-between items-start mb-2">
-            <div class="flex-1">
-              <p class="font-medium text-gray-900 text-sm">${t.booking_text}</p>
-              <p class="text-xs text-gray-500">${t.date}  ${t.amount} ${t.currency}</p>
+            <div>
+              <div class="font-medium text-primary" style="color: var(--text-primary)"">${tx.booking_text}</div>
+              <div class="text-xs text-muted" style="color: var(--text-muted)"">${tx.date}  ${parseFloat(tx.amount).toFixed(2)} ${tx.currency}</div>
             </div>
-            <span class="text-xs font-semibold px-2 py-1 rounded" id="category-badge-${t.id}"></span>
+            <button class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 transition"
+                    onclick="applyCategoryToAll('${tx.booking_text.replace(/'/g, "\\'")}')">
+              Apply to all matching
+            </button>
           </div>
-          <div class="flex gap-2">
-            <select class="flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500" 
-                    data-transaction-id="${t.id}" 
-                    data-merchant="${t.booking_text}">
-              <option value="">-- Select Category --</option>
-              ${globalCategoryOptions.map(cat => `<option value="${cat}" ${t.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
+          <div class="flex items-center gap-2">
+            <select class="block w-full text-sm border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
+                    onchange="updateCategory(${tx.id}, this.value)">
+              ${categoryOptions}
             </select>
-            <button class="apply-category-btn px-3 py-1 text-sm bg-indigo-600 hover:bg-indigo-700 text-white rounded font-medium transition" 
-                    data-transaction-id="${t.id}" 
-                    data-merchant="${t.booking_text}">
-              Apply
-            </button>
           </div>
         </div>
       `;
     });
+
     html += '</div>';
-    
-    // Add pagination info and controls
-    const totalPages = Math.ceil(allSearchResults.length / resultsPerPage);
-    html += `
-      <div class="mt-4 flex items-center justify-between bg-gray-100 p-3 rounded-lg">
-        <span class="text-sm text-gray-600">Showing ${startIdx + 1}-${Math.min(endIdx, allSearchResults.length)} of ${allSearchResults.length} transactions</span>
-        <div class="flex gap-2">
-          <button class="pagination-prev px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 transition ${currentResultsPage === 1 ? 'opacity-50 cursor-not-allowed' : ''}" 
-                  onclick="previousResultsPage()" 
-                  ${currentResultsPage === 1 ? 'disabled' : ''}>
-             Previous
+
+    // Pagination controls
+    if (totalPages > 1) {
+      html += `
+        <div class="bg-secondary" style="background-color: var(--bg-secondary)" px-4 py-3 border-t border-gray-200 flex justify-between items-center">
+          <button 
+            onclick="changePage(${page - 1})" 
+            class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-surface" style="background-color: var(--bg-surface)" hover:bg-secondary" style="background-color: var(--bg-secondary)" ${page === 1 ? 'opacity-50 cursor-not-allowed' : ''}"
+            ${page === 1 ? 'disabled' : ''}
+          >
+            Previous
           </button>
-          <span class="px-3 py-1 text-sm font-medium">${currentResultsPage} / ${totalPages}</span>
-          <button class="pagination-next px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 transition ${currentResultsPage === totalPages ? 'opacity-50 cursor-not-allowed' : ''}" 
-                  onclick="nextResultsPage()" 
-                  ${currentResultsPage === totalPages ? 'disabled' : ''}>
-            Next 
+          <button 
+            onclick="changePage(${page + 1})" 
+            class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-surface" style="background-color: var(--bg-surface)" hover:bg-secondary" style="background-color: var(--bg-secondary)" ${page === totalPages ? 'opacity-50 cursor-not-allowed' : ''}"
+            ${page === totalPages ? 'disabled' : ''}
+          >
+            Next
           </button>
         </div>
-      </div>
-    `;
-    
-    document.getElementById('transactions-list').innerHTML = html;
-    
-    // Set category badge styles
-    pageTransactions.forEach(t => {
-      const badge = document.getElementById(`category-badge-${t.id}`);
-      if (badge) {
-        let badgeClass = 'bg-indigo-200 text-indigo-800';
-        if (t.category === 'Uncounted') {
-          badgeClass = 'bg-gray-300 text-gray-800';
-        } else if (t.category === 'Bank Transfer') {
-          badgeClass = 'bg-blue-200 text-blue-800';
-        }
-        badge.className = `text-xs font-semibold px-2 py-1 rounded ${badgeClass}`;
-        badge.textContent = t.category || 'Uncategorized';
-      }
-    });
-    
-    // Add event listeners to apply buttons
-    document.querySelectorAll('.apply-category-btn').forEach(btn => {
-      btn.addEventListener('click', function() {
-        const transactionId = this.dataset.transactionId;
-        const merchant = this.dataset.merchant;
-        const select = document.querySelector(`select[data-transaction-id="${transactionId}"]`);
-        const category = select.value;
-        
-        if (!category) {
-          showToast('Please select a category', 'error');
-          return;
-        }
-        
-        applyCategoryToTransaction(transactionId, category, merchant);
-      });
-    });
-  }
-  
-  function previousResultsPage() {
-    if (currentResultsPage > 1) {
-      currentResultsPage--;
-      displaySearchResultsPage();
-      // Scroll to top of results
-      document.getElementById('transactions-list').scrollIntoView({ behavior: 'smooth' });
-    }
-  }
-  
-  function nextResultsPage() {
-    const totalPages = Math.ceil(allSearchResults.length / resultsPerPage);
-    if (currentResultsPage < totalPages) {
-      currentResultsPage++;
-      displaySearchResultsPage();
-      // Scroll to top of results
-      document.getElementById('transactions-list').scrollIntoView({ behavior: 'smooth' });
+      `;
     }
+
+    transactionsList.innerHTML = html;
   }
-  
-  function applyCategoryToTransaction(transactionId, category, merchant) {
+
+  // Make these functions global so they can be called from onclick attributes
+  window.changePage = function (newPage) {
+    currentResultsPage = newPage;
+    displaySearchResults(allSearchResults, currentResultsPage);
+  };
+
+  window.updateCategory = function (transactionId, newCategory) {
     const csrfToken = getCookie('csrftoken');
-    
-    fetch(`/api/transactions/${transactionId}/update-category/`, {
+
+    fetch('/api/transactions/update-category/', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json',
-        'X-CSRFToken': csrfToken,
-        'X-Requested-With': 'XMLHttpRequest'
+        'X-CSRFToken': csrfToken
       },
       body: JSON.stringify({
-        category: category
+        transaction_id: transactionId,
+        category: newCategory
       })
     })
       .then(response => response.json())
       .then(data => {
         if (data.success) {
-          showToast(`Category "${category}" applied to all ${merchant} transactions!`, 'success');
-          // Refresh the current page without resetting pagination
-          const merchantTerm = document.getElementById('merchant-search').value.trim().toLowerCase();
-          const categoryTerm = document.getElementById('category-search').value.trim().toLowerCase();
-          const amountTerm = document.getElementById('amount-search').value.trim();
-          
-          // Re-fetch and re-filter transactions
-          fetch(`/api/transactions/`)
-            .then(response => response.json())
-            .then(data => {
-              let transactions = data.transactions;
-              
-              // Apply filters
-              if (merchantTerm) {
-                transactions = transactions.filter(t => 
-                  t.booking_text.toLowerCase().includes(merchantTerm)
-                );
-              }
-              if (categoryTerm) {
-                transactions = transactions.filter(t => 
-                  (t.category || '').toLowerCase().includes(categoryTerm)
-                );
-              }
-              if (amountTerm) {
-                const match = amountTerm.match(/^([><=]*)([\d.]+)$/);
-                if (match) {
-                  const operator = match[1] || '=';
-                  const value = parseFloat(match[2]);
-                  transactions = transactions.filter(t => {
-                    const amount = Math.abs(parseFloat(t.amount));
-                    switch (operator) {
-                      case '>': return amount > value;
-                      case '<': return amount < value;
-                      case '>=': return amount >= value;
-                      case '<=': return amount <= value;
-                      case '=': return amount === value;
-                      default: return true;
-                    }
-                  });
-                }
-              }
-              
-              // Update results while maintaining current page
-              allSearchResults = transactions;
-              displaySearchResultsPage();
-            });
-          
-          // Reload categorization stats
-          loadCategorizationStats();
+          showToast(`Category updated to ${newCategory}`, 'success');
+          // Update local data
+          const tx = allSearchResults.find(t => t.id === transactionId);
+          if (tx) tx.category = newCategory;
         } else {
-          showToast('Error updating category: ' + data.error, 'error');
+          showToast(`Error: ${data.error}`, 'error');
         }
       })
       .catch(error => {
         console.error('Error updating category:', error);
         showToast('Error updating category', 'error');
       });
-  }
+  };
 
-  function deleteFile(fileId) {
-    const btn = document.querySelector(`[data-file-id="${fileId}"]`);
-    const row = btn.closest('label');
-    
-    fetch(`/delete-file/${fileId}/`, {
+  window.applyCategoryToAll = function (merchantName) {
+    const categorySelect = event.target.closest('.p-4').querySelector('select');
+    const category = categorySelect.value;
+
+    if (!category) {
+      showToast('Please select a category first', 'error');
+      return;
+    }
+
+    if (!confirm(`Apply category "${category}" to ALL transactions matching "${merchantName}"?`)) {
+      return;
+    }
+
+    const csrfToken = getCookie('csrftoken');
+
+    fetch('/api/transactions/bulk-categorize/', {
       method: 'POST',
       headers: {
-        'X-CSRFToken': getCookie('csrftoken'),
-        'X-Requested-With': 'XMLHttpRequest'
-      }
-    })
-    .then(response => response.json())
-    .then(data => {
-      if (data.success) {
-        // Remove the row with animation
-        row.style.opacity = '0';
-        row.style.transition = 'opacity 0.3s ease';
-        setTimeout(() => {
-          row.remove();
-          // Show success message
-          const filesContainer = document.querySelector('form');
-          if (filesContainer && filesContainer.querySelectorAll('label').length === 0) {
-            filesContainer.innerHTML = '<p class="text-gray-600 text-center py-8">No files uploaded yet. Start by uploading a bank statement.</p>';
-          }
-        }, 300);
-      } else {
-        showToast('Error deleting file: ' + (data.error || 'Unknown error'), 'error');
-      }
-    })
-    .catch(error => {
-      console.error('Error deleting file:', error);
-      showToast('Error deleting file: ' + error.message, 'error');
-    });
-  }
-
-  // Handle excluded categories form submission
-  const excludedCategoriesForm = document.getElementById('excluded-categories-form');
-  if (excludedCategoriesForm) {
-    excludedCategoriesForm.addEventListener('submit', function(e) {
-      e.preventDefault();
-      
-      const csrfToken = getCookie('csrftoken');
-      const formData = new FormData(this);
-      const excludedCategories = formData.getAll('excluded_category');
-      
-      fetch('/api/excluded-categories/', {
-        method: 'POST',
-        headers: {
-          'Content-Type': 'application/json',
-          'X-CSRFToken': csrfToken,
-          'X-Requested-With': 'XMLHttpRequest'
-        },
-        body: JSON.stringify({
-          excluded_categories: excludedCategories
-        })
+        'Content-Type': 'application/json',
+        'X-CSRFToken': csrfToken
+      },
+      body: JSON.stringify({
+        merchant_pattern: merchantName,
+        category: category
       })
+    })
       .then(response => response.json())
       .then(data => {
-        const statusDiv = document.getElementById('excluded-status');
         if (data.success) {
-          statusDiv.className = 'mt-4 p-3 rounded-lg bg-green-50 border border-green-200';
-          statusDiv.innerHTML = '<i class="bi bi-check-circle text-green-600 mr-2"></i><span class="text-green-800 font-medium">Excluded categories updated successfully!</span>';
-          statusDiv.classList.remove('hidden');
-          setTimeout(() => {
-            statusDiv.classList.add('hidden');
-          }, 3000);
+          showToast(`Updated ${data.updated_count} transactions`, 'success');
+          // Refresh search results
+          searchMerchants();
+          // Refresh stats
+          loadCategorizationStats();
         } else {
-          statusDiv.className = 'mt-4 p-3 rounded-lg bg-red-50 border border-red-200';
-          statusDiv.innerHTML = '<i class="bi bi-exclamation-circle text-red-600 mr-2"></i><span class="text-red-800 font-medium">Error: ' + data.error + '</span>';
-          statusDiv.classList.remove('hidden');
+          showToast(`Error: ${data.error}`, 'error');
         }
       })
       .catch(error => {
-        console.error('Error updating excluded categories:', error);
-        const statusDiv = document.getElementById('excluded-status');
-        statusDiv.className = 'mt-4 p-3 rounded-lg bg-red-50 border border-red-200';
-        statusDiv.innerHTML = '<i class="bi bi-exclamation-circle text-red-600 mr-2"></i><span class="text-red-800 font-medium">Error: ' + error.message + '</span>';
-        statusDiv.classList.remove('hidden');
+        console.error('Error bulk updating:', error);
+        showToast('Error performing bulk update', 'error');
       });
-    });
-  }
+  };
+
 </script>
-{% endblock %}
+{% endblock %}
\ No newline at end of file
diff --git a/faster/transactions/urls.py b/faster/transactions/urls.py
index 526fd52..f9fee2c 100644
--- a/faster/transactions/urls.py
+++ b/faster/transactions/urls.py
@@ -14,6 +14,7 @@ urlpatterns = [
     path("delete-file/<int:file_id>/", views.delete_file, name="delete_file"),
     # API endpoints
     path("api/transactions/", views.api_get_transactions, name="api_get_transactions"),
+    path("api/transactions/search/", views.api_search_transactions, name="api_search_transactions"), # Search endpoint
     path(
         "api/transactions/<int:transaction_id>/update-category/",
         views.api_update_category,
diff --git a/faster/transactions/views.py b/faster/transactions/views.py
index 2cd58ce..432461d 100644
--- a/faster/transactions/views.py
+++ b/faster/transactions/views.py
@@ -281,14 +281,37 @@ def settings_view(request):
 
     # Handle settings update
     elif request.method == "POST":
-        selected_file_ids = request.POST.getlist("file")
-        selected_currencies = request.POST.getlist("currency")
-
-        # Save to session
-        request.session["selected_file_ids"] = selected_file_ids
-        request.session["selected_currencies"] = selected_currencies
-
-        success = "Settings saved successfully"
+        form_type = request.POST.get("form_type")
+        
+        if form_type == "files":
+            selected_file_ids = request.POST.getlist("file")
+            request.session["selected_file_ids"] = selected_file_ids
+            success = "File selection updated successfully"
+            
+        elif form_type == "currencies":
+            selected_currencies = request.POST.getlist("currency")
+            request.session["selected_currencies"] = selected_currencies
+            success = "Currency selection updated successfully"
+            
+        elif form_type == "excluded_categories":
+            # This is handled by a separate view usually, but if it's here:
+            excluded = request.POST.getlist("excluded_category")
+            dashboard_settings.excluded_categories = excluded
+            dashboard_settings.save()
+            success = "Excluded categories updated successfully"
+            
+        else:
+            # Fallback for backward compatibility or if form_type is missing
+            # Only update if the specific fields are present in POST data
+            if "file" in request.POST:
+                selected_file_ids = request.POST.getlist("file")
+                request.session["selected_file_ids"] = selected_file_ids
+            
+            if "currency" in request.POST:
+                selected_currencies = request.POST.getlist("currency")
+                request.session["selected_currencies"] = selected_currencies
+                
+            success = "Settings saved successfully"
 
     # Get all unique categories for the category management section
     all_categories = sorted(
@@ -427,11 +450,134 @@ def expenses_vs_income(request):
     ]
     import json
 
+    # --- Advanced Analytics Data Prep ---
+
+    # 1. Sankey Diagram Data
+    # Nodes: Income Categories -> "Budget" -> Expense Categories
+    # We need a list of labels and a list of links (source, target, value)
+    
+    sankey_labels = ["Budget"] # Node 0
+    sankey_source = []
+    sankey_target = []
+    sankey_value = []
+    sankey_color = [] # Optional: specific colors for links
+
+    # Income Nodes (Indices 1 to N)
+    income_categories = {}
+    for t in transactions:
+        if t.amount and t.amount > 0:
+            cat = t.category if t.category else "Uncategorized Income"
+            income_categories[cat] = income_categories.get(cat, 0) + t.amount
+
+    income_start_idx = 1
+    current_idx = income_start_idx
+    
+    for cat, amount in income_categories.items():
+        sankey_labels.append(cat)
+        # Link: Income Cat (current_idx) -> Budget (0)
+        sankey_source.append(current_idx)
+        sankey_target.append(0)
+        sankey_value.append(amount)
+        sankey_color.append("rgba(34, 197, 94, 0.4)") # Greenish
+        current_idx += 1
+
+    # Expense Nodes (Indices N+1 to M)
+    expense_categories = {}
+    for t in transactions:
+        if t.amount and t.amount < 0:
+            cat = t.category if t.category else "Uncategorized Expense"
+            expense_categories[cat] = expense_categories.get(cat, 0) + abs(t.amount)
+
+    for cat, amount in expense_categories.items():
+        sankey_labels.append(cat)
+        # Link: Budget (0) -> Expense Cat (current_idx)
+        sankey_source.append(0)
+        sankey_target.append(current_idx)
+        sankey_value.append(amount)
+        sankey_color.append("rgba(239, 68, 68, 0.4)") # Reddish
+        current_idx += 1
+
+    # Savings Node (if Income > Expenses)
+    total_income = sum(income_categories.values())
+    total_expenses = sum(expense_categories.values())
+    savings = total_income - total_expenses
+
+    if savings > 0:
+        sankey_labels.append("Savings")
+        # Link: Budget (0) -> Savings (current_idx)
+        sankey_source.append(0)
+        sankey_target.append(current_idx)
+        sankey_value.append(savings)
+        sankey_color.append("rgba(59, 130, 246, 0.4)") # Blueish
+
+    sankey_data = {
+        "label": sankey_labels,
+        "source": sankey_source,
+        "target": sankey_target,
+        "value": sankey_value,
+        "color": sankey_color
+    }
+
+    # 2. Heatmap Data (Daily Spending)
+    # Format: { "2023-01-01": 150.50, ... }
+    heatmap_data = defaultdict(float)
+    for t in transactions:
+        if t.amount and t.amount < 0:
+            # Ensure date is string YYYY-MM-DD
+            d_str = str(t.date)
+            # If t.date is datetime object, convert
+            if hasattr(t.date, 'strftime'):
+                d_str = t.date.strftime("%Y-%m-%d")
+            heatmap_data[d_str] += abs(t.amount)
+    
+    # Convert to list of dicts for easier JS handling or keep as dict
+    # Let's pass as dict and handle keys in JS
+    
+    # 3. Subscription Detection (Heuristic)
+    # Same description, similar amount (+- 5%), occurring > 1 time in selected period? 
+    # Or better: group by description, check count and variance.
+    
+    from collections import defaultdict
+    import statistics
+
+    tx_by_desc = defaultdict(list)
+    for t in transactions:
+        if t.amount and t.amount < 0:
+            # Normalize description: remove dates, numbers at end? 
+            # Simple normalization: lowercase, first 20 chars?
+            # Let's use full description for now to be safe
+            desc = t.booking_text.strip()
+            tx_by_desc[desc].append(abs(t.amount))
+
+    subscriptions = []
+    for desc, amounts in tx_by_desc.items():
+        if len(amounts) >= 2: # At least 2 occurrences
+            avg_amount = statistics.mean(amounts)
+            # Check if amounts are consistent (std dev low or all within % of mean)
+            is_consistent = all(0.9 * avg_amount <= x <= 1.1 * avg_amount for x in amounts)
+            
+            if is_consistent:
+                subscriptions.append({
+                    "name": desc,
+                    "avg_amount": avg_amount,
+                    "count": len(amounts),
+                    "total": sum(amounts),
+                    "latest_date": "N/A" # Could find latest date if needed
+                })
+    
+    # Sort subscriptions by total cost
+    subscriptions.sort(key=lambda x: x["total"], reverse=True)
+
+    import json
+
     return render(
         request,
         "dashboard/expenses_vs_income.html",
         {
             "chart_data": json.dumps(chart_data),
+            "sankey_data": json.dumps(sankey_data),
+            "heatmap_data": json.dumps(heatmap_data),
+            "subscriptions": subscriptions,
             "transactions": tx_data,
             "files": files,
             "selected_file_ids": selected_file_ids,
@@ -1298,6 +1444,55 @@ def api_get_transactions(request):
     )
 
 
+def api_search_transactions(request):
+    """API endpoint to search transactions"""
+    from django.http import JsonResponse
+    from .models import Transaction
+
+    query = request.GET.get("q", "").strip()
+    category = request.GET.get("category", "").strip()
+    amount = request.GET.get("amount", "").strip()
+
+    qs = Transaction.objects.all().order_by("-date", "-id")
+
+    # Apply session filters
+    selected_file_ids = request.session.get("selected_file_ids", [])
+    if selected_file_ids:
+        qs = qs.filter(uploaded_file_id__in=selected_file_ids)
+    
+    selected_currencies = request.session.get("selected_currencies", [])
+    if selected_currencies:
+        qs = qs.filter(currency__in=selected_currencies)
+
+    if query:
+        qs = qs.filter(booking_text__icontains=query)
+    
+    if category:
+        qs = qs.filter(category__iexact=category)
+        
+    if amount:
+        try:
+            amount_val = float(amount)
+            # Search for exact amount match (approximate for float)
+            qs = qs.filter(amount__range=(amount_val - 0.05, amount_val + 0.05))
+        except ValueError:
+            pass
+
+    transactions = [
+        {
+            "id": t.id,
+            "date": t.date,
+            "booking_text": t.booking_text,
+            "category": t.category if t.category else "Uncounted",
+            "amount": float(t.amount) if t.amount else 0.0,
+            "currency": t.currency if t.currency else "",
+        }
+        for t in qs[:100]  # Limit results
+    ]
+
+    return JsonResponse({"success": True, "transactions": transactions})
+
+
 @csrf_exempt
 @require_http_methods(["POST"])
 def api_update_category(request, transaction_id):
